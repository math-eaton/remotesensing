var Vo=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);import{R as Qo,P as Ko,E as Xo,V,M as Pe,T as Re,Q as Sa,S as Qs,a as te,b as Yo,G as Mt,C as Jo,c as wt,L as th,d as He,B as zt,e as Oe,f as eh,O as ah,F as ih,W as sh,D as ee,g as xe,h as Ks,i as Xs,j as nh,k as be,l as Zi,I as Ys,m as rh,n as oh,o as hh,p as Js,q as lh,r as ch,s as uh,t as fh}from"./three-h4xrzdNO.js";import{M as mh,E as dh,F as he,n as We,s as tn,c as en,T as an,a as sn,V as Mh,L as yh,C as vh,R as gh,B as ph,b as xh,A as bh,G as nn,g as Et,S as Ph,N as _h,D as wh}from"./tone-qs0l8JK-.js";var rd=Vo(gt=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function a(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=a(s);fetch(s.href,n)}})();const rn={type:"change"},Vi={type:"start"},on={type:"end"},ri=new Qo,hn=new Ko,Eh=Math.cos(70*Yo.DEG2RAD);class Ah extends Xo{constructor(e,a){super(),this.object=e,this.domElement=a,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new V,this.cursor=new V,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Pe.ROTATE,MIDDLE:Pe.DOLLY,RIGHT:Pe.PAN},this.touches={ONE:Re.ROTATE,TWO:Re.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return r.phi},this.getAzimuthalAngle=function(){return r.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(y){y.addEventListener("keydown",va),this._domElementKeyEvents=y},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",va),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(rn),i.update(),n=s.NONE},this.update=function(){const y=new V,L=new Sa().setFromUnitVectors(e.up,new V(0,1,0)),K=L.clone().invert(),at=new V,Pt=new Sa,ie=new V,Ft=2*Math.PI;return function(Li=null){const Be=i.object.position;y.copy(Be).sub(i.target),y.applyQuaternion(L),r.setFromVector3(y),i.autoRotate&&n===s.NONE&&z(H(Li)),i.enableDamping?(r.theta+=h.theta*i.dampingFactor,r.phi+=h.phi*i.dampingFactor):(r.theta+=h.theta,r.phi+=h.phi);let Kt=i.minAzimuthAngle,Ht=i.maxAzimuthAngle;isFinite(Kt)&&isFinite(Ht)&&(Kt<-Math.PI?Kt+=Ft:Kt>Math.PI&&(Kt-=Ft),Ht<-Math.PI?Ht+=Ft:Ht>Math.PI&&(Ht-=Ft),Kt<=Ht?r.theta=Math.max(Kt,Math.min(Ht,r.theta)):r.theta=r.theta>(Kt+Ht)/2?Math.max(Kt,r.theta):Math.min(Ht,r.theta)),r.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,r.phi)),r.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(d,i.dampingFactor):i.target.add(d),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor);let ve=!1;if(i.zoomToCursor&&j||i.object.isOrthographicCamera)r.radius=de(r.radius);else{const Xt=r.radius;r.radius=de(r.radius*c),ve=Xt!=r.radius}if(y.setFromSpherical(r),y.applyQuaternion(K),Be.copy(i.target).add(y),i.object.lookAt(i.target),i.enableDamping===!0?(h.theta*=1-i.dampingFactor,h.phi*=1-i.dampingFactor,d.multiplyScalar(1-i.dampingFactor)):(h.set(0,0,0),d.set(0,0,0)),i.zoomToCursor&&j){let Xt=null;if(i.object.isPerspectiveCamera){const Ue=y.length();Xt=de(Ue*c);const Ce=Ue-Xt;i.object.position.addScaledVector(I,Ce),i.object.updateMatrixWorld(),ve=!!Ce}else if(i.object.isOrthographicCamera){const Ue=new V(F.x,F.y,0);Ue.unproject(i.object);const Ce=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),i.object.updateProjectionMatrix(),ve=Ce!==i.object.zoom;const Ya=new V(F.x,F.y,0);Ya.unproject(i.object),i.object.position.sub(Ya).add(Ue),i.object.updateMatrixWorld(),Xt=y.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;Xt!==null&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(Xt).add(i.object.position):(ri.origin.copy(i.object.position),ri.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(ri.direction))<Eh?e.lookAt(i.target):(hn.setFromNormalAndCoplanarPoint(i.object.up,i.target),ri.intersectPlane(hn,i.target))))}else if(i.object.isOrthographicCamera){const Xt=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),Xt!==i.object.zoom&&(i.object.updateProjectionMatrix(),ve=!0)}return c=1,j=!1,ve||at.distanceToSquared(i.object.position)>o||8*(1-Pt.dot(i.object.quaternion))>o||ie.distanceToSquared(i.target)>o?(i.dispatchEvent(rn),at.copy(i.object.position),Pt.copy(i.object.quaternion),ie.copy(i.target),!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",Qa),i.domElement.removeEventListener("pointerdown",Ge),i.domElement.removeEventListener("pointercancel",ye),i.domElement.removeEventListener("wheel",Ae),i.domElement.removeEventListener("pointermove",Qt),i.domElement.removeEventListener("pointerup",ye),i.domElement.getRootNode().removeEventListener("keydown",Ma,{capture:!0}),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",va),i._domElementKeyEvents=null)};const i=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let n=s.NONE;const o=1e-6,r=new Qs,h=new Qs;let c=1;const d=new V,u=new te,m=new te,v=new te,p=new te,b=new te,w=new te,A=new te,C=new te,S=new te,I=new V,F=new te;let j=!1;const $=[],B={};let O=!1;function H(y){return y!==null?2*Math.PI/60*i.autoRotateSpeed*y:2*Math.PI/60/60*i.autoRotateSpeed}function G(y){const L=Math.abs(y*.01);return Math.pow(.95,i.zoomSpeed*L)}function z(y){h.theta-=y}function nt(y){h.phi-=y}const yt=function(){const y=new V;return function(K,at){y.setFromMatrixColumn(at,0),y.multiplyScalar(-K),d.add(y)}}(),Ct=function(){const y=new V;return function(K,at){i.screenSpacePanning===!0?y.setFromMatrixColumn(at,1):(y.setFromMatrixColumn(at,0),y.crossVectors(i.object.up,y)),y.multiplyScalar(K),d.add(y)}}(),X=function(){const y=new V;return function(K,at){const Pt=i.domElement;if(i.object.isPerspectiveCamera){const ie=i.object.position;y.copy(ie).sub(i.target);let Ft=y.length();Ft*=Math.tan(i.object.fov/2*Math.PI/180),yt(2*K*Ft/Pt.clientHeight,i.object.matrix),Ct(2*at*Ft/Pt.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(yt(K*(i.object.right-i.object.left)/i.object.zoom/Pt.clientWidth,i.object.matrix),Ct(at*(i.object.top-i.object.bottom)/i.object.zoom/Pt.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function J(y){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c/=y:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function Ut(y){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c*=y:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function xt(y,L){if(!i.zoomToCursor)return;j=!0;const K=i.domElement.getBoundingClientRect(),at=y-K.left,Pt=L-K.top,ie=K.width,Ft=K.height;F.x=at/ie*2-1,F.y=-(Pt/Ft)*2+1,I.set(F.x,F.y,1).unproject(i.object).sub(i.object.position).normalize()}function de(y){return Math.max(i.minDistance,Math.min(i.maxDistance,y))}function Xe(y){u.set(y.clientX,y.clientY)}function Ci(y){xt(y.clientX,y.clientX),A.set(y.clientX,y.clientY)}function Za(y){p.set(y.clientX,y.clientY)}function Ee(y){m.set(y.clientX,y.clientY),v.subVectors(m,u).multiplyScalar(i.rotateSpeed);const L=i.domElement;z(2*Math.PI*v.x/L.clientHeight),nt(2*Math.PI*v.y/L.clientHeight),u.copy(m),i.update()}function Ti(y){C.set(y.clientX,y.clientY),S.subVectors(C,A),S.y>0?J(G(S.y)):S.y<0&&Ut(G(S.y)),A.copy(C),i.update()}function Ii(y){b.set(y.clientX,y.clientY),w.subVectors(b,p).multiplyScalar(i.panSpeed),X(w.x,w.y),p.copy(b),i.update()}function Va(y){xt(y.clientX,y.clientY),y.deltaY<0?Ut(G(y.deltaY)):y.deltaY>0&&J(G(y.deltaY)),i.update()}function Oi(y){let L=!1;switch(y.code){case i.keys.UP:y.ctrlKey||y.metaKey||y.shiftKey?nt(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):X(0,i.keyPanSpeed),L=!0;break;case i.keys.BOTTOM:y.ctrlKey||y.metaKey||y.shiftKey?nt(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):X(0,-i.keyPanSpeed),L=!0;break;case i.keys.LEFT:y.ctrlKey||y.metaKey||y.shiftKey?z(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):X(i.keyPanSpeed,0),L=!0;break;case i.keys.RIGHT:y.ctrlKey||y.metaKey||y.shiftKey?z(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):X(-i.keyPanSpeed,0),L=!0;break}L&&(y.preventDefault(),i.update())}function rt(y){if($.length===1)u.set(y.pageX,y.pageY);else{const L=Ne(y),K=.5*(y.pageX+L.x),at=.5*(y.pageY+L.y);u.set(K,at)}}function Me(y){if($.length===1)p.set(y.pageX,y.pageY);else{const L=Ne(y),K=.5*(y.pageX+L.x),at=.5*(y.pageY+L.y);p.set(K,at)}}function $t(y){const L=Ne(y),K=y.pageX-L.x,at=y.pageY-L.y,Pt=Math.sqrt(K*K+at*at);A.set(0,Pt)}function ma(y){i.enableZoom&&$t(y),i.enablePan&&Me(y)}function je(y){i.enableZoom&&$t(y),i.enableRotate&&rt(y)}function Dt(y){if($.length==1)m.set(y.pageX,y.pageY);else{const K=Ne(y),at=.5*(y.pageX+K.x),Pt=.5*(y.pageY+K.y);m.set(at,Pt)}v.subVectors(m,u).multiplyScalar(i.rotateSpeed);const L=i.domElement;z(2*Math.PI*v.x/L.clientHeight),nt(2*Math.PI*v.y/L.clientHeight),u.copy(m)}function ut(y){if($.length===1)b.set(y.pageX,y.pageY);else{const L=Ne(y),K=.5*(y.pageX+L.x),at=.5*(y.pageY+L.y);b.set(K,at)}w.subVectors(b,p).multiplyScalar(i.panSpeed),X(w.x,w.y),p.copy(b)}function ze(y){const L=Ne(y),K=y.pageX-L.x,at=y.pageY-L.y,Pt=Math.sqrt(K*K+at*at);C.set(0,Pt),S.set(0,Math.pow(C.y/A.y,i.zoomSpeed)),J(S.y),A.copy(C);const ie=(y.pageX+L.x)*.5,Ft=(y.pageY+L.y)*.5;xt(ie,Ft)}function da(y){i.enableZoom&&ze(y),i.enablePan&&ut(y)}function qe(y){i.enableZoom&&ze(y),i.enableRotate&&Dt(y)}function Ge(y){i.enabled!==!1&&($.length===0&&(i.domElement.setPointerCapture(y.pointerId),i.domElement.addEventListener("pointermove",Qt),i.domElement.addEventListener("pointerup",ye)),!Se(y)&&(pa(y),y.pointerType==="touch"?ga(y):$e(y)))}function Qt(y){i.enabled!==!1&&(y.pointerType==="touch"?Ri(y):Bt(y))}function ye(y){switch(Ka(y),$.length){case 0:i.domElement.releasePointerCapture(y.pointerId),i.domElement.removeEventListener("pointermove",Qt),i.domElement.removeEventListener("pointerup",ye),i.dispatchEvent(on),n=s.NONE;break;case 1:const L=$[0],K=B[L];ga({pointerId:L,pageX:K.x,pageY:K.y});break}}function $e(y){let L;switch(y.button){case 0:L=i.mouseButtons.LEFT;break;case 1:L=i.mouseButtons.MIDDLE;break;case 2:L=i.mouseButtons.RIGHT;break;default:L=-1}switch(L){case Pe.DOLLY:if(i.enableZoom===!1)return;Ci(y),n=s.DOLLY;break;case Pe.ROTATE:if(y.ctrlKey||y.metaKey||y.shiftKey){if(i.enablePan===!1)return;Za(y),n=s.PAN}else{if(i.enableRotate===!1)return;Xe(y),n=s.ROTATE}break;case Pe.PAN:if(y.ctrlKey||y.metaKey||y.shiftKey){if(i.enableRotate===!1)return;Xe(y),n=s.ROTATE}else{if(i.enablePan===!1)return;Za(y),n=s.PAN}break;default:n=s.NONE}n!==s.NONE&&i.dispatchEvent(Vi)}function Bt(y){switch(n){case s.ROTATE:if(i.enableRotate===!1)return;Ee(y);break;case s.DOLLY:if(i.enableZoom===!1)return;Ti(y);break;case s.PAN:if(i.enablePan===!1)return;Ii(y);break}}function Ae(y){i.enabled===!1||i.enableZoom===!1||n!==s.NONE||(y.preventDefault(),i.dispatchEvent(Vi),Va(Ye(y)),i.dispatchEvent(on))}function Ye(y){const L=y.deltaMode,K={clientX:y.clientX,clientY:y.clientY,deltaY:y.deltaY};switch(L){case 1:K.deltaY*=16;break;case 2:K.deltaY*=100;break}return y.ctrlKey&&!O&&(K.deltaY*=10),K}function Ma(y){y.key==="Control"&&(O=!0,i.domElement.getRootNode().addEventListener("keyup",ya,{passive:!0,capture:!0}))}function ya(y){y.key==="Control"&&(O=!1,i.domElement.getRootNode().removeEventListener("keyup",ya,{passive:!0,capture:!0}))}function va(y){i.enabled===!1||i.enablePan===!1||Oi(y)}function ga(y){switch(Xa(y),$.length){case 1:switch(i.touches.ONE){case Re.ROTATE:if(i.enableRotate===!1)return;rt(y),n=s.TOUCH_ROTATE;break;case Re.PAN:if(i.enablePan===!1)return;Me(y),n=s.TOUCH_PAN;break;default:n=s.NONE}break;case 2:switch(i.touches.TWO){case Re.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;ma(y),n=s.TOUCH_DOLLY_PAN;break;case Re.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;je(y),n=s.TOUCH_DOLLY_ROTATE;break;default:n=s.NONE}break;default:n=s.NONE}n!==s.NONE&&i.dispatchEvent(Vi)}function Ri(y){switch(Xa(y),n){case s.TOUCH_ROTATE:if(i.enableRotate===!1)return;Dt(y),i.update();break;case s.TOUCH_PAN:if(i.enablePan===!1)return;ut(y),i.update();break;case s.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;da(y),i.update();break;case s.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;qe(y),i.update();break;default:n=s.NONE}}function Qa(y){i.enabled!==!1&&y.preventDefault()}function pa(y){$.push(y.pointerId)}function Ka(y){delete B[y.pointerId];for(let L=0;L<$.length;L++)if($[L]==y.pointerId){$.splice(L,1);return}}function Se(y){for(let L=0;L<$.length;L++)if($[L]==y.pointerId)return!0;return!1}function Xa(y){let L=B[y.pointerId];L===void 0&&(L=new te,B[y.pointerId]=L),L.set(y.pageX,y.pageY)}function Ne(y){const L=y.pointerId===$[0]?$[1]:$[0];return B[L]}i.domElement.addEventListener("contextmenu",Qa),i.domElement.addEventListener("pointerdown",Ge),i.domElement.addEventListener("pointercancel",ye),i.domElement.addEventListener("wheel",Ae,{passive:!1}),i.domElement.getRootNode().addEventListener("keydown",Ma,{passive:!0,capture:!0}),this.update()}}class Sh extends Ah{constructor(e,a){super(e,a),this.screenSpacePanning=!1,this.mouseButtons={LEFT:Pe.PAN,MIDDLE:Pe.DOLLY,RIGHT:Pe.ROTATE},this.touches={ONE:Re.PAN,TWO:Re.DOLLY_ROTATE}}}function Nh(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}var Ze=1,Ve=2,ha=3,Ch=4,ts=5,ln=6378137,Th=6356752314e-3,cn=.0066943799901413165,Na=484813681109536e-20,T=Math.PI/2,Ih=.16666666666666666,Oh=.04722222222222222,Rh=.022156084656084655,R=1e-10,At=.017453292519943295,ce=57.29577951308232,it=Math.PI/4,La=Math.PI*2,vt=3.14159265359,Gt={};Gt.greenwich=0;Gt.lisbon=-9.131906111111;Gt.paris=2.337229166667;Gt.bogota=-74.080916666667;Gt.madrid=-3.687938888889;Gt.rome=12.452333333333;Gt.bern=7.439583333333;Gt.jakarta=106.807719444444;Gt.ferro=-17.666666666667;Gt.brussels=4.367975;Gt.stockholm=18.058277777778;Gt.athens=23.7163375;Gt.oslo=10.722916666667;const Lh={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var un=/[\s_\-\/\(\)]/g;function ke(t,e){if(t[e])return t[e];for(var a=Object.keys(t),i=e.toLowerCase().replace(un,""),s=-1,n,o;++s<a.length;)if(n=a[s],o=n.toLowerCase().replace(un,""),o===i)return t[n]}function es(t){var e={},a=t.split("+").map(function(r){return r.trim()}).filter(function(r){return r}).reduce(function(r,h){var c=h.split("=");return c.push(!0),r[c[0].toLowerCase()]=c[1],r},{}),i,s,n,o={proj:"projName",datum:"datumCode",rf:function(r){e.rf=parseFloat(r)},lat_0:function(r){e.lat0=r*At},lat_1:function(r){e.lat1=r*At},lat_2:function(r){e.lat2=r*At},lat_ts:function(r){e.lat_ts=r*At},lon_0:function(r){e.long0=r*At},lon_1:function(r){e.long1=r*At},lon_2:function(r){e.long2=r*At},alpha:function(r){e.alpha=parseFloat(r)*At},gamma:function(r){e.rectified_grid_angle=parseFloat(r)},lonc:function(r){e.longc=r*At},x_0:function(r){e.x0=parseFloat(r)},y_0:function(r){e.y0=parseFloat(r)},k_0:function(r){e.k0=parseFloat(r)},k:function(r){e.k0=parseFloat(r)},a:function(r){e.a=parseFloat(r)},b:function(r){e.b=parseFloat(r)},r:function(r){e.a=e.b=parseFloat(r)},r_a:function(){e.R_A=!0},zone:function(r){e.zone=parseInt(r,10)},south:function(){e.utmSouth=!0},towgs84:function(r){e.datum_params=r.split(",").map(function(h){return parseFloat(h)})},to_meter:function(r){e.to_meter=parseFloat(r)},units:function(r){e.units=r;var h=ke(Lh,r);h&&(e.to_meter=h.to_meter)},from_greenwich:function(r){e.from_greenwich=r*At},pm:function(r){var h=ke(Gt,r);e.from_greenwich=(h||parseFloat(r))*At},nadgrids:function(r){r==="@null"?e.datumCode="none":e.nadgrids=r},axis:function(r){var h="ewnsud";r.length===3&&h.indexOf(r.substr(0,1))!==-1&&h.indexOf(r.substr(1,1))!==-1&&h.indexOf(r.substr(2,1))!==-1&&(e.axis=r)},approx:function(){e.approx=!0}};for(i in a)s=a[i],i in o?(n=o[i],typeof n=="function"?n(s):e[n]=s):e[i]=s;return typeof e.datumCode=="string"&&e.datumCode!=="WGS84"&&(e.datumCode=e.datumCode.toLowerCase()),e}var ka=1,Gn=2,$n=3,vi=4,Bn=5,hs=-1,kh=/\s/,Dh=/[A-Za-z]/,Fh=/[A-Za-z84_]/,Ai=/[,\]]/,Un=/[\d\.E\-\+]/;function we(t){if(typeof t!="string")throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=ka}we.prototype.readCharicter=function(){var t=this.text[this.place++];if(this.state!==vi)for(;kh.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case ka:return this.neutral(t);case Gn:return this.keyword(t);case vi:return this.quoted(t);case Bn:return this.afterquote(t);case $n:return this.number(t);case hs:return}};we.prototype.afterquote=function(t){if(t==='"'){this.word+='"',this.state=vi;return}if(Ai.test(t)){this.word=this.word.trim(),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in afterquote yet, index '+this.place)};we.prototype.afterItem=function(t){if(t===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=ka;return}if(t==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=ka,this.currentObject=this.stack.pop(),this.currentObject||(this.state=hs);return}};we.prototype.number=function(t){if(Un.test(t)){this.word+=t;return}if(Ai.test(t)){this.word=parseFloat(this.word),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in number yet, index '+this.place)};we.prototype.quoted=function(t){if(t==='"'){this.state=Bn;return}this.word+=t};we.prototype.keyword=function(t){if(Fh.test(t)){this.word+=t;return}if(t==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=ka;return}if(Ai.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in keyword yet, index '+this.place)};we.prototype.neutral=function(t){if(Dh.test(t)){this.word=t,this.state=Gn;return}if(t==='"'){this.word="",this.state=vi;return}if(Un.test(t)){this.word=t,this.state=$n;return}if(Ai.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in neutral yet, index '+this.place)};we.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===hs)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function jh(t){var e=new we(t);return e.output()}function fn(t,e,a){Array.isArray(e)&&(a.unshift(e),e=null);var i=e?{}:t,s=a.reduce(function(n,o){return aa(o,n),n},i);e&&(t[e]=s)}function aa(t,e){if(!Array.isArray(t)){e[t]=!0;return}var a=t.shift();if(a==="PARAMETER"&&(a=t.shift()),t.length===1){if(Array.isArray(t[0])){e[a]={},aa(t[0],e[a]);return}e[a]=t[0];return}if(!t.length){e[a]=!0;return}if(a==="TOWGS84"){e[a]=t;return}if(a==="AXIS"){a in e||(e[a]=[]),e[a].push(t);return}Array.isArray(a)||(e[a]={});var i;switch(a){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[a]={name:t[0].toLowerCase(),convert:t[1]},t.length===3&&aa(t[2],e[a]);return;case"SPHEROID":case"ELLIPSOID":e[a]={name:t[0],a:t[1],rf:t[2]},t.length===4&&aa(t[3],e[a]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":t[0]=["name",t[0]],fn(e,a,t);return;default:for(i=-1;++i<t.length;)if(!Array.isArray(t[i]))return aa(t,e[a]);return fn(e,a,t)}}var zh=.017453292519943295;function qh(t,e){var a=e[0],i=e[1];!(a in t)&&i in t&&(t[a]=t[i],e.length===3&&(t[a]=e[2](t[a])))}function le(t){return t*zh}function Gh(t){if(t.type==="GEOGCS"?t.projName="longlat":t.type==="LOCAL_CS"?(t.projName="identity",t.local=!0):typeof t.PROJECTION=="object"?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",a=0,i=t.AXIS.length;a<i;++a){var s=[t.AXIS[a][0].toLowerCase(),t.AXIS[a][1].toLowerCase()];s[0].indexOf("north")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="north"?e+="n":s[0].indexOf("south")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="south"?e+="s":s[0].indexOf("east")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="east"?e+="e":(s[0].indexOf("west")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="west")&&(e+="w")}e.length===2&&(e+="u"),e.length===3&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.UNIT.convert&&(t.type==="GEOGCS"?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var n=t.GEOGCS;t.type==="GEOGCS"&&(n=t),n&&(n.DATUM?t.datumCode=n.DATUM.name.toLowerCase():t.datumCode=n.name.toLowerCase(),t.datumCode.slice(0,2)==="d_"&&(t.datumCode=t.datumCode.slice(2)),(t.datumCode==="new_zealand_geodetic_datum_1949"||t.datumCode==="new_zealand_1949")&&(t.datumCode="nzgd49"),(t.datumCode==="wgs_1984"||t.datumCode==="world_geodetic_system_1984")&&(t.PROJECTION==="Mercator_Auxiliary_Sphere"&&(t.sphere=!0),t.datumCode="wgs84"),t.datumCode.slice(-6)==="_ferro"&&(t.datumCode=t.datumCode.slice(0,-6)),t.datumCode.slice(-8)==="_jakarta"&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),n.DATUM&&n.DATUM.SPHEROID&&(t.ellps=n.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),t.ellps.toLowerCase().slice(0,13)==="international"&&(t.ellps="intl"),t.a=n.DATUM.SPHEROID.a,t.rf=parseFloat(n.DATUM.SPHEROID.rf,10)),n.DATUM&&n.DATUM.TOWGS84&&(t.datum_params=n.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),t.datumCode==="ch1903+"&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a);function o(c){var d=t.to_meter||1;return c*d}var r=function(c){return qh(t,c)},h=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",le],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",le],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",le],["lat0","latitude_of_origin",le],["lat0","standard_parallel_1",le],["lat1","standard_parallel_1",le],["lat2","standard_parallel_2",le],["azimuth","Azimuth"],["alpha","azimuth",le],["srsCode","name"]];h.forEach(r),!t.long0&&t.longc&&(t.projName==="Albers_Conic_Equal_Area"||t.projName==="Lambert_Azimuthal_Equal_Area")&&(t.long0=t.longc),!t.lat_ts&&t.lat1&&(t.projName==="Stereographic_South_Pole"||t.projName==="Polar Stereographic (variant B)")?(t.lat0=le(t.lat1>0?90:-90),t.lat_ts=t.lat1):!t.lat_ts&&t.lat0&&t.projName==="Polar_Stereographic"&&(t.lat_ts=t.lat0,t.lat0=le(t.lat0>0?90:-90))}function Hn(t){var e=jh(t),a=e.shift(),i=e.shift();e.unshift(["name",i]),e.unshift(["type",a]);var s={};return aa(e,s),Gh(s),s}function Lt(t){var e=this;if(arguments.length===2){var a=arguments[1];typeof a=="string"?a.charAt(0)==="+"?Lt[t]=es(arguments[1]):Lt[t]=Hn(arguments[1]):Lt[t]=a}else if(arguments.length===1){if(Array.isArray(t))return t.map(function(i){Array.isArray(i)?Lt.apply(e,i):Lt(i)});if(typeof t=="string"){if(t in Lt)return Lt[t]}else"EPSG"in t?Lt["EPSG:"+t.EPSG]=t:"ESRI"in t?Lt["ESRI:"+t.ESRI]=t:"IAU2000"in t?Lt["IAU2000:"+t.IAU2000]=t:console.log(t);return}}Nh(Lt);function $h(t){return typeof t=="string"}function Bh(t){return t in Lt}var Uh=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function Hh(t){return Uh.some(function(e){return t.indexOf(e)>-1})}var Wh=["3857","900913","3785","102113"];function Zh(t){var e=ke(t,"authority");if(e){var a=ke(e,"epsg");return a&&Wh.indexOf(a)>-1}}function Vh(t){var e=ke(t,"extension");if(e)return ke(e,"proj4")}function Qh(t){return t[0]==="+"}function Kh(t){if($h(t)){if(Bh(t))return Lt[t];if(Hh(t)){var e=Hn(t);if(Zh(e))return Lt["EPSG:3857"];var a=Vh(e);return a?es(a):e}if(Qh(t))return es(t)}else return t}function mn(t,e){t=t||{};var a,i;if(!e)return t;for(i in e)a=e[i],a!==void 0&&(t[i]=a);return t}function fe(t,e,a){var i=t*e;return a/Math.sqrt(1-i*i)}function qa(t){return t<0?-1:1}function k(t){return Math.abs(t)<=vt?t:t-qa(t)*La}function ae(t,e,a){var i=t*a,s=.5*t;return i=Math.pow((1-i)/(1+i),s),Math.tan(.5*(T-e))/i}function Da(t,e){for(var a=.5*t,i,s,n=T-2*Math.atan(e),o=0;o<=15;o++)if(i=t*Math.sin(n),s=T-2*Math.atan(e*Math.pow((1-i)/(1+i),a))-n,n+=s,Math.abs(s)<=1e-10)return n;return-9999}function Xh(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=fe(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function Yh(t){var e=t.x,a=t.y;if(a*ce>90&&a*ce<-90&&e*ce>180&&e*ce<-180)return null;var i,s;if(Math.abs(Math.abs(a)-T)<=R)return null;if(this.sphere)i=this.x0+this.a*this.k0*k(e-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(it+.5*a));else{var n=Math.sin(a),o=ae(this.e,a,n);i=this.x0+this.a*this.k0*k(e-this.long0),s=this.y0-this.a*this.k0*Math.log(o)}return t.x=i,t.y=s,t}function Jh(t){var e=t.x-this.x0,a=t.y-this.y0,i,s;if(this.sphere)s=T-2*Math.atan(Math.exp(-a/(this.a*this.k0)));else{var n=Math.exp(-a/(this.a*this.k0));if(s=Da(this.e,n),s===-9999)return null}return i=k(this.long0+e/(this.a*this.k0)),t.x=i,t.y=s,t}var tl=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const el={init:Xh,forward:Yh,inverse:Jh,names:tl};function al(){}function dn(t){return t}var il=["longlat","identity"];const sl={init:al,forward:dn,inverse:dn,names:il};var nl=[el,sl],mi={},gi=[];function Wn(t,e){var a=gi.length;return t.names?(gi[a]=t,t.names.forEach(function(i){mi[i.toLowerCase()]=a}),this):(console.log(e),!0)}function rl(t){if(!t)return!1;var e=t.toLowerCase();if(typeof mi[e]<"u"&&gi[mi[e]])return gi[mi[e]]}function ol(){nl.forEach(Wn)}const hl={start:ol,add:Wn,get:rl};var Z={};Z.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};Z.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};Z.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};Z.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};Z.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};Z.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};Z.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};Z.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};Z.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};Z.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};Z.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};Z.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};Z.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};Z.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};Z.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};Z.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};Z.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};Z.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};Z.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};Z.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};Z.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};Z.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};Z.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};Z.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};Z.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};Z.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};Z.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};Z.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};Z.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};Z.hough={a:6378270,rf:297,ellipseName:"Hough"};Z.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};Z.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};Z.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};Z.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};Z.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};Z.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};Z.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};Z.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};Z.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};Z.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};Z.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};Z.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var ll=Z.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Z.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function cl(t,e,a,i){var s=t*t,n=e*e,o=(s-n)/s,r=0;i?(t*=1-o*(Ih+o*(Oh+o*Rh)),s=t*t,o=0):r=Math.sqrt(o);var h=(s-n)/n;return{es:o,e:r,ep2:h}}function ul(t,e,a,i,s){if(!t){var n=ke(Z,i);n||(n=ll),t=n.a,e=n.b,a=n.rf}return a&&!e&&(e=(1-1/a)*t),(a===0||Math.abs(t-e)<R)&&(s=!0,e=t),{a:t,b:e,rf:a,sphere:s}}var gt={};gt.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};gt.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};gt.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};gt.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};gt.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};gt.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};gt.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};gt.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};gt.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};gt.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};gt.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};gt.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};gt.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};gt.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};gt.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};gt.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};gt.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};gt.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function fl(t,e,a,i,s,n,o){var r={};return t===void 0||t==="none"?r.datum_type=ts:r.datum_type=Ch,e&&(r.datum_params=e.map(parseFloat),(r.datum_params[0]!==0||r.datum_params[1]!==0||r.datum_params[2]!==0)&&(r.datum_type=Ze),r.datum_params.length>3&&(r.datum_params[3]!==0||r.datum_params[4]!==0||r.datum_params[5]!==0||r.datum_params[6]!==0)&&(r.datum_type=Ve,r.datum_params[3]*=Na,r.datum_params[4]*=Na,r.datum_params[5]*=Na,r.datum_params[6]=r.datum_params[6]/1e6+1)),o&&(r.datum_type=ha,r.grids=o),r.a=a,r.b=i,r.es=s,r.ep2=n,r}var Zn={};function ml(t,e){var a=new DataView(e),i=yl(a),s=vl(a,i),n=gl(a,s,i),o={header:s,subgrids:n};return Zn[t]=o,o}function dl(t){if(t===void 0)return null;var e=t.split(",");return e.map(Ml)}function Ml(t){if(t.length===0)return null;var e=t[0]==="@";return e&&(t=t.slice(1)),t==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:Zn[t]||null,isNull:!1}}function ia(t){return t/3600*Math.PI/180}function yl(t){var e=t.getInt32(8,!1);return e===11?!1:(e=t.getInt32(8,!0),e!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function vl(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:as(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}function as(t,e,a){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,a)))}function gl(t,e,a){for(var i=176,s=[],n=0;n<e.nSubgrids;n++){var o=xl(t,i,a),r=bl(t,i,o,a),h=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),c=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);s.push({ll:[ia(o.lowerLongitude),ia(o.lowerLatitude)],del:[ia(o.longitudeInterval),ia(o.latitudeInterval)],lim:[h,c],count:o.gridNodeCount,cvs:pl(r)}),i+=176+o.gridNodeCount*16}return s}function pl(t){return t.map(function(e){return[ia(e.longitudeShift),ia(e.latitudeShift)]})}function xl(t,e,a){return{name:as(t,e+8,e+16).trim(),parent:as(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,a),upperLatitude:t.getFloat64(e+88,a),lowerLongitude:t.getFloat64(e+104,a),upperLongitude:t.getFloat64(e+120,a),latitudeInterval:t.getFloat64(e+136,a),longitudeInterval:t.getFloat64(e+152,a),gridNodeCount:t.getInt32(e+168,a)}}function bl(t,e,a,i){for(var s=e+176,n=16,o=[],r=0;r<a.gridNodeCount;r++){var h={latitudeShift:t.getFloat32(s+r*n,i),longitudeShift:t.getFloat32(s+r*n+4,i),latitudeAccuracy:t.getFloat32(s+r*n+8,i),longitudeAccuracy:t.getFloat32(s+r*n+12,i)};o.push(h)}return o}function ue(t,e){if(!(this instanceof ue))return new ue(t);e=e||function(c){if(c)throw c};var a=Kh(t);if(typeof a!="object"){e(t);return}var i=ue.projections.get(a.projName);if(!i){e(t);return}if(a.datumCode&&a.datumCode!=="none"){var s=ke(gt,a.datumCode);s&&(a.datum_params=a.datum_params||(s.towgs84?s.towgs84.split(","):null),a.ellps=s.ellipse,a.datumName=s.datumName?s.datumName:a.datumCode)}a.k0=a.k0||1,a.axis=a.axis||"enu",a.ellps=a.ellps||"wgs84",a.lat1=a.lat1||a.lat0;var n=ul(a.a,a.b,a.rf,a.ellps,a.sphere),o=cl(n.a,n.b,n.rf,a.R_A),r=dl(a.nadgrids),h=a.datum||fl(a.datumCode,a.datum_params,n.a,n.b,o.es,o.ep2,r);mn(this,a),mn(this,i),this.a=n.a,this.b=n.b,this.rf=n.rf,this.sphere=n.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=h,this.init(),e(null,this)}ue.projections=hl;ue.projections.start();function Pl(t,e){return t.datum_type!==e.datum_type||t.a!==e.a||Math.abs(t.es-e.es)>5e-11?!1:t.datum_type===Ze?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type===Ve?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6]:!0}function Vn(t,e,a){var i=t.x,s=t.y,n=t.z?t.z:0,o,r,h,c;if(s<-T&&s>-1.001*T)s=-T;else if(s>T&&s<1.001*T)s=T;else{if(s<-T)return{x:-1/0,y:-1/0,z:t.z};if(s>T)return{x:1/0,y:1/0,z:t.z}}return i>Math.PI&&(i-=2*Math.PI),r=Math.sin(s),c=Math.cos(s),h=r*r,o=a/Math.sqrt(1-e*h),{x:(o+n)*c*Math.cos(i),y:(o+n)*c*Math.sin(i),z:(o*(1-e)+n)*r}}function Qn(t,e,a,i){var s=1e-12,n=s*s,o=30,r,h,c,d,u,m,v,p,b,w,A,C,S,I=t.x,F=t.y,j=t.z?t.z:0,$,B,O;if(r=Math.sqrt(I*I+F*F),h=Math.sqrt(I*I+F*F+j*j),r/a<s){if($=0,h/a<s)return B=T,O=-i,{x:t.x,y:t.y,z:t.z}}else $=Math.atan2(F,I);c=j/h,d=r/h,u=1/Math.sqrt(1-e*(2-e)*d*d),p=d*(1-e)*u,b=c*u,S=0;do S++,v=a/Math.sqrt(1-e*b*b),O=r*p+j*b-v*(1-e*b*b),m=e*v/(v+O),u=1/Math.sqrt(1-m*(2-m)*d*d),w=d*(1-m)*u,A=c*u,C=A*p-w*b,p=w,b=A;while(C*C>n&&S<o);return B=Math.atan(A/Math.abs(w)),{x:$,y:B,z:O}}function _l(t,e,a){if(e===Ze)return{x:t.x+a[0],y:t.y+a[1],z:t.z+a[2]};if(e===Ve){var i=a[0],s=a[1],n=a[2],o=a[3],r=a[4],h=a[5],c=a[6];return{x:c*(t.x-h*t.y+r*t.z)+i,y:c*(h*t.x+t.y-o*t.z)+s,z:c*(-r*t.x+o*t.y+t.z)+n}}}function wl(t,e,a){if(e===Ze)return{x:t.x-a[0],y:t.y-a[1],z:t.z-a[2]};if(e===Ve){var i=a[0],s=a[1],n=a[2],o=a[3],r=a[4],h=a[5],c=a[6],d=(t.x-i)/c,u=(t.y-s)/c,m=(t.z-n)/c;return{x:d+h*u-r*m,y:-h*d+u+o*m,z:r*d-o*u+m}}}function oi(t){return t===Ze||t===Ve}function El(t,e,a){if(Pl(t,e)||t.datum_type===ts||e.datum_type===ts)return a;var i=t.a,s=t.es;if(t.datum_type===ha){var n=Mn(t,!1,a);if(n!==0)return;i=ln,s=cn}var o=e.a,r=e.b,h=e.es;if(e.datum_type===ha&&(o=ln,r=Th,h=cn),s===h&&i===o&&!oi(t.datum_type)&&!oi(e.datum_type))return a;if(a=Vn(a,s,i),oi(t.datum_type)&&(a=_l(a,t.datum_type,t.datum_params)),oi(e.datum_type)&&(a=wl(a,e.datum_type,e.datum_params)),a=Qn(a,h,o,r),e.datum_type===ha){var c=Mn(e,!0,a);if(c!==0)return}return a}function Mn(t,e,a){if(t.grids===null||t.grids.length===0)return console.log("Grid shift grids not found"),-1;var i={x:-a.x,y:a.y},s={x:Number.NaN,y:Number.NaN},n=[];t:for(var o=0;o<t.grids.length;o++){var r=t.grids[o];if(n.push(r.name),r.isNull){s=i;break}if(r.mandatory,r.grid===null){if(r.mandatory)return console.log("Unable to find mandatory grid '"+r.name+"'"),-1;continue}for(var h=r.grid.subgrids,c=0,d=h.length;c<d;c++){var u=h[c],m=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,v=u.ll[0]-m,p=u.ll[1]-m,b=u.ll[0]+(u.lim[0]-1)*u.del[0]+m,w=u.ll[1]+(u.lim[1]-1)*u.del[1]+m;if(!(p>i.y||v>i.x||w<i.y||b<i.x)&&(s=Al(i,e,u),!isNaN(s.x)))break t}}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*ce+" "+i.y*ce+" tried: '"+n+"'"),-1):(a.x=-s.x,a.y=s.y,0)}function Al(t,e,a){var i={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return i;var s={x:t.x,y:t.y};s.x-=a.ll[0],s.y-=a.ll[1],s.x=k(s.x-Math.PI)+Math.PI;var n=yn(s,a);if(e){if(isNaN(n.x))return i;n.x=s.x-n.x,n.y=s.y-n.y;var o=9,r=1e-12,h,c;do{if(c=yn(n,a),isNaN(c.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}h={x:s.x-(c.x+n.x),y:s.y-(c.y+n.y)},n.x+=h.x,n.y+=h.y}while(o--&&Math.abs(h.x)>r&&Math.abs(h.y)>r);if(o<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=k(n.x+a.ll[0]),i.y=n.y+a.ll[1]}else isNaN(n.x)||(i.x=t.x+n.x,i.y=t.y+n.y);return i}function yn(t,e){var a={x:t.x/e.del[0],y:t.y/e.del[1]},i={x:Math.floor(a.x),y:Math.floor(a.y)},s={x:a.x-1*i.x,y:a.y-1*i.y},n={x:Number.NaN,y:Number.NaN},o;if(i.x<0||i.x>=e.lim[0]||i.y<0||i.y>=e.lim[1])return n;o=i.y*e.lim[0]+i.x;var r={x:e.cvs[o][0],y:e.cvs[o][1]};o++;var h={x:e.cvs[o][0],y:e.cvs[o][1]};o+=e.lim[0];var c={x:e.cvs[o][0],y:e.cvs[o][1]};o--;var d={x:e.cvs[o][0],y:e.cvs[o][1]},u=s.x*s.y,m=s.x*(1-s.y),v=(1-s.x)*(1-s.y),p=(1-s.x)*s.y;return n.x=v*r.x+m*h.x+p*d.x+u*c.x,n.y=v*r.y+m*h.y+p*d.y+u*c.y,n}function vn(t,e,a){var i=a.x,s=a.y,n=a.z||0,o,r,h,c={};for(h=0;h<3;h++)if(!(e&&h===2&&a.z===void 0))switch(h===0?(o=i,"ew".indexOf(t.axis[h])!==-1?r="x":r="y"):h===1?(o=s,"ns".indexOf(t.axis[h])!==-1?r="y":r="x"):(o=n,r="z"),t.axis[h]){case"e":c[r]=o;break;case"w":c[r]=-o;break;case"n":c[r]=o;break;case"s":c[r]=-o;break;case"u":a[r]!==void 0&&(c.z=o);break;case"d":a[r]!==void 0&&(c.z=-o);break;default:return null}return c}function Kn(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function Sl(t){gn(t.x),gn(t.y)}function gn(t){if(typeof Number.isFinite=="function"){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if(typeof t!="number"||t!==t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function Nl(t,e){return(t.datum.datum_type===Ze||t.datum.datum_type===Ve||t.datum.datum_type===ha)&&e.datumCode!=="WGS84"||(e.datum.datum_type===Ze||e.datum.datum_type===Ve||e.datum.datum_type===ha)&&t.datumCode!=="WGS84"}function pi(t,e,a,i){var s;Array.isArray(a)?a=Kn(a):a={x:a.x,y:a.y,z:a.z,m:a.m};var n=a.z!==void 0;if(Sl(a),t.datum&&e.datum&&Nl(t,e)&&(s=new ue("WGS84"),a=pi(t,s,a,i),t=s),i&&t.axis!=="enu"&&(a=vn(t,!1,a)),t.projName==="longlat")a={x:a.x*At,y:a.y*At,z:a.z||0};else if(t.to_meter&&(a={x:a.x*t.to_meter,y:a.y*t.to_meter,z:a.z||0}),a=t.inverse(a),!a)return;if(t.from_greenwich&&(a.x+=t.from_greenwich),a=El(t.datum,e.datum,a),!!a)return e.from_greenwich&&(a={x:a.x-e.from_greenwich,y:a.y,z:a.z||0}),e.projName==="longlat"?a={x:a.x*ce,y:a.y*ce,z:a.z||0}:(a=e.forward(a),e.to_meter&&(a={x:a.x/e.to_meter,y:a.y/e.to_meter,z:a.z||0})),i&&e.axis!=="enu"?vn(e,!0,a):(a&&!n&&delete a.z,a)}var pn=ue("WGS84");function Qi(t,e,a,i){var s,n,o;return Array.isArray(a)?(s=pi(t,e,a,i)||{x:NaN,y:NaN},a.length>2?typeof t.name<"u"&&t.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof s.z=="number"?[s.x,s.y,s.z].concat(a.splice(3)):[s.x,s.y,a[2]].concat(a.splice(3)):[s.x,s.y].concat(a.splice(2)):[s.x,s.y]):(n=pi(t,e,a,i),o=Object.keys(a),o.length===2||o.forEach(function(r){if(typeof t.name<"u"&&t.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(r==="x"||r==="y"||r==="z")return}else if(r==="x"||r==="y")return;n[r]=a[r]}),n)}function xn(t){return t instanceof ue?t:t.oProj?t.oProj:ue(t)}function St(t,e,a){t=xn(t);var i=!1,s;return typeof e>"u"?(e=t,t=pn,i=!0):(typeof e.x<"u"||Array.isArray(e))&&(a=e,e=t,t=pn,i=!0),e=xn(e),a?Qi(t,e,a):(s={forward:function(n,o){return Qi(t,e,n,o)},inverse:function(n,o){return Qi(e,t,n,o)}},i&&(s.oProj=e),s)}var bn=6,Xn="AJSAJS",Yn="AFAFAF",sa=65,qt=73,Zt=79,wa=86,Ea=90;const Cl={forward:Jn,inverse:Tl,toPoint:tr};function Jn(t,e){return e=e||5,Rl(Il({lat:t[1],lon:t[0]}),e)}function Tl(t){var e=ls(ar(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function tr(t){var e=ls(ar(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function Ki(t){return t*(Math.PI/180)}function Pn(t){return 180*(t/Math.PI)}function Il(t){var e=t.lat,a=t.lon,i=6378137,s=.00669438,n=.9996,o,r,h,c,d,u,m,v=Ki(e),p=Ki(a),b,w;w=Math.floor((a+180)/6)+1,a===180&&(w=60),e>=56&&e<64&&a>=3&&a<12&&(w=32),e>=72&&e<84&&(a>=0&&a<9?w=31:a>=9&&a<21?w=33:a>=21&&a<33?w=35:a>=33&&a<42&&(w=37)),o=(w-1)*6-180+3,b=Ki(o),r=s/(1-s),h=i/Math.sqrt(1-s*Math.sin(v)*Math.sin(v)),c=Math.tan(v)*Math.tan(v),d=r*Math.cos(v)*Math.cos(v),u=Math.cos(v)*(p-b),m=i*((1-s/4-3*s*s/64-5*s*s*s/256)*v-(3*s/8+3*s*s/32+45*s*s*s/1024)*Math.sin(2*v)+(15*s*s/256+45*s*s*s/1024)*Math.sin(4*v)-35*s*s*s/3072*Math.sin(6*v));var A=n*h*(u+(1-c+d)*u*u*u/6+(5-18*c+c*c+72*d-58*r)*u*u*u*u*u/120)+5e5,C=n*(m+h*Math.tan(v)*(u*u/2+(5-c+9*d+4*d*d)*u*u*u*u/24+(61-58*c+c*c+600*d-330*r)*u*u*u*u*u*u/720));return e<0&&(C+=1e7),{northing:Math.round(C),easting:Math.round(A),zoneNumber:w,zoneLetter:Ol(e)}}function ls(t){var e=t.northing,a=t.easting,i=t.zoneLetter,s=t.zoneNumber;if(s<0||s>60)return null;var n=.9996,o=6378137,r=.00669438,h,c=(1-Math.sqrt(1-r))/(1+Math.sqrt(1-r)),d,u,m,v,p,b,w,A,C,S=a-5e5,I=e;i<"N"&&(I-=1e7),w=(s-1)*6-180+3,h=r/(1-r),b=I/n,A=b/(o*(1-r/4-3*r*r/64-5*r*r*r/256)),C=A+(3*c/2-27*c*c*c/32)*Math.sin(2*A)+(21*c*c/16-55*c*c*c*c/32)*Math.sin(4*A)+151*c*c*c/96*Math.sin(6*A),d=o/Math.sqrt(1-r*Math.sin(C)*Math.sin(C)),u=Math.tan(C)*Math.tan(C),m=h*Math.cos(C)*Math.cos(C),v=o*(1-r)/Math.pow(1-r*Math.sin(C)*Math.sin(C),1.5),p=S/(d*n);var F=C-d*Math.tan(C)/v*(p*p/2-(5+3*u+10*m-4*m*m-9*h)*p*p*p*p/24+(61+90*u+298*m+45*u*u-252*h-3*m*m)*p*p*p*p*p*p/720);F=Pn(F);var j=(p-(1+2*u+m)*p*p*p/6+(5-2*m+28*u-3*m*m+8*h+24*u*u)*p*p*p*p*p/120)/Math.cos(C);j=w+Pn(j);var $;if(t.accuracy){var B=ls({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});$={top:B.lat,right:B.lon,bottom:F,left:j}}else $={lat:F,lon:j};return $}function Ol(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function Rl(t,e){var a="00000"+t.easting,i="00000"+t.northing;return t.zoneNumber+t.zoneLetter+Ll(t.easting,t.northing,t.zoneNumber)+a.substr(a.length-5,e)+i.substr(i.length-5,e)}function Ll(t,e,a){var i=er(a),s=Math.floor(t/1e5),n=Math.floor(e/1e5)%20;return kl(s,n,i)}function er(t){var e=t%bn;return e===0&&(e=bn),e}function kl(t,e,a){var i=a-1,s=Xn.charCodeAt(i),n=Yn.charCodeAt(i),o=s+t-1,r=n+e,h=!1;o>Ea&&(o=o-Ea+sa-1,h=!0),(o===qt||s<qt&&o>qt||(o>qt||s<qt)&&h)&&o++,(o===Zt||s<Zt&&o>Zt||(o>Zt||s<Zt)&&h)&&(o++,o===qt&&o++),o>Ea&&(o=o-Ea+sa-1),r>wa?(r=r-wa+sa-1,h=!0):h=!1,(r===qt||n<qt&&r>qt||(r>qt||n<qt)&&h)&&r++,(r===Zt||n<Zt&&r>Zt||(r>Zt||n<Zt)&&h)&&(r++,r===qt&&r++),r>wa&&(r=r-wa+sa-1);var c=String.fromCharCode(o)+String.fromCharCode(r);return c}function ar(t){if(t&&t.length===0)throw"MGRSPoint coverting from nothing";for(var e=t.length,a=null,i="",s,n=0;!/[A-Z]/.test(s=t.charAt(n));){if(n>=2)throw"MGRSPoint bad conversion from: "+t;i+=s,n++}var o=parseInt(i,10);if(n===0||n+3>e)throw"MGRSPoint bad conversion from: "+t;var r=t.charAt(n++);if(r<="A"||r==="B"||r==="Y"||r>="Z"||r==="I"||r==="O")throw"MGRSPoint zone letter "+r+" not handled: "+t;a=t.substring(n,n+=2);for(var h=er(o),c=Dl(a.charAt(0),h),d=Fl(a.charAt(1),h);d<jl(r);)d+=2e6;var u=e-n;if(u%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+t;var m=u/2,v=0,p=0,b,w,A,C,S;return m>0&&(b=1e5/Math.pow(10,m),w=t.substring(n,n+m),v=parseFloat(w)*b,A=t.substring(n+m),p=parseFloat(A)*b),C=v+c,S=p+d,{easting:C,northing:S,zoneLetter:r,zoneNumber:o,accuracy:b}}function Dl(t,e){for(var a=Xn.charCodeAt(e-1),i=1e5,s=!1;a!==t.charCodeAt(0);){if(a++,a===qt&&a++,a===Zt&&a++,a>Ea){if(s)throw"Bad character: "+t;a=sa,s=!0}i+=1e5}return i}function Fl(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var a=Yn.charCodeAt(e-1),i=0,s=!1;a!==t.charCodeAt(0);){if(a++,a===qt&&a++,a===Zt&&a++,a>wa){if(s)throw"Bad character: "+t;a=sa,s=!0}i+=1e5}return i}function jl(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function ca(t,e,a){if(!(this instanceof ca))return new ca(t,e,a);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if(typeof t=="object")this.x=t.x,this.y=t.y,this.z=t.z||0;else if(typeof t=="string"&&typeof e>"u"){var i=t.split(",");this.x=parseFloat(i[0],10),this.y=parseFloat(i[1],10),this.z=parseFloat(i[2],10)||0}else this.x=t,this.y=e,this.z=a||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}ca.fromMGRS=function(t){return new ca(tr(t))};ca.prototype.toMGRS=function(t){return Jn([this.x,this.y],t)};var zl=1,ql=.25,_n=.046875,wn=.01953125,En=.01068115234375,Gl=.75,$l=.46875,Bl=.013020833333333334,Ul=.007120768229166667,Hl=.3645833333333333,Wl=.005696614583333333,Zl=.3076171875;function ir(t){var e=[];e[0]=zl-t*(ql+t*(_n+t*(wn+t*En))),e[1]=t*(Gl-t*(_n+t*(wn+t*En)));var a=t*t;return e[2]=a*($l-t*(Bl+t*Ul)),a*=t,e[3]=a*(Hl-t*Wl),e[4]=a*t*Zl,e}function Si(t,e,a,i){return a*=e,e*=e,i[0]*t-a*(i[1]+e*(i[2]+e*(i[3]+e*i[4])))}var Vl=20;function sr(t,e,a){for(var i=1/(1-e),s=t,n=Vl;n;--n){var o=Math.sin(s),r=1-e*o*o;if(r=(Si(s,o,Math.cos(s),a)-t)*(r*Math.sqrt(r))*i,s-=r,Math.abs(r)<R)return s}return s}function Ql(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=ir(this.es),this.ml0=Si(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function Kl(t){var e=t.x,a=t.y,i=k(e-this.long0),s,n,o,r=Math.sin(a),h=Math.cos(a);if(this.es){var d=h*i,u=Math.pow(d,2),m=this.ep2*Math.pow(h,2),v=Math.pow(m,2),p=Math.abs(h)>R?Math.tan(a):0,b=Math.pow(p,2),w=Math.pow(b,2);s=1-this.es*Math.pow(r,2),d=d/Math.sqrt(s);var A=Si(a,r,h,this.en);n=this.a*(this.k0*d*(1+u/6*(1-b+m+u/20*(5-18*b+w+14*m-58*b*m+u/42*(61+179*w-w*b-479*b)))))+this.x0,o=this.a*(this.k0*(A-this.ml0+r*i*d/2*(1+u/12*(5-b+9*m+4*v+u/30*(61+w-58*b+270*m-330*b*m+u/56*(1385+543*w-w*b-3111*b))))))+this.y0}else{var c=h*Math.sin(i);if(Math.abs(Math.abs(c)-1)<R)return 93;if(n=.5*this.a*this.k0*Math.log((1+c)/(1-c))+this.x0,o=h*Math.cos(i)/Math.sqrt(1-Math.pow(c,2)),c=Math.abs(o),c>=1){if(c-1>R)return 93;o=0}else o=Math.acos(o);a<0&&(o=-o),o=this.a*this.k0*(o-this.lat0)+this.y0}return t.x=n,t.y=o,t}function Xl(t){var e,a,i,s,n=(t.x-this.x0)*(1/this.a),o=(t.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+o/this.k0,a=sr(e,this.es,this.en),Math.abs(a)<T){var u=Math.sin(a),m=Math.cos(a),v=Math.abs(m)>R?Math.tan(a):0,p=this.ep2*Math.pow(m,2),b=Math.pow(p,2),w=Math.pow(v,2),A=Math.pow(w,2);e=1-this.es*Math.pow(u,2);var C=n*Math.sqrt(e)/this.k0,S=Math.pow(C,2);e=e*v,i=a-e*S/(1-this.es)*.5*(1-S/12*(5+3*w-9*p*w+p-4*b-S/30*(61+90*w-252*p*w+45*A+46*p-S/56*(1385+3633*w+4095*A+1574*A*w)))),s=k(this.long0+C*(1-S/6*(1+2*w+p-S/20*(5+28*w+24*A+8*p*w+6*p-S/42*(61+662*w+1320*A+720*A*w))))/m)}else i=T*qa(o),s=0;else{var r=Math.exp(n/this.k0),h=.5*(r-1/r),c=this.lat0+o/this.k0,d=Math.cos(c);e=Math.sqrt((1-Math.pow(d,2))/(1+Math.pow(h,2))),i=Math.asin(e),o<0&&(i=-i),h===0&&d===0?s=0:s=k(Math.atan2(h,d)+this.long0)}return t.x=s,t.y=i,t}var Yl=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const di={init:Ql,forward:Kl,inverse:Xl,names:Yl};function nr(t){var e=Math.exp(t);return e=(e-1/e)/2,e}function Vt(t,e){t=Math.abs(t),e=Math.abs(e);var a=Math.max(t,e),i=Math.min(t,e)/(a||1);return a*Math.sqrt(1+Math.pow(i,2))}function Jl(t){var e=1+t,a=e-1;return a===0?t:t*Math.log(e)/a}function tc(t){var e=Math.abs(t);return e=Jl(e*(1+e/(Vt(1,e)+1))),t<0?-e:e}function cs(t,e){for(var a=2*Math.cos(2*e),i=t.length-1,s=t[i],n=0,o;--i>=0;)o=-n+a*s+t[i],n=s,s=o;return e+o*Math.sin(2*e)}function ec(t,e){for(var a=2*Math.cos(e),i=t.length-1,s=t[i],n=0,o;--i>=0;)o=-n+a*s+t[i],n=s,s=o;return Math.sin(e)*o}function ac(t){var e=Math.exp(t);return e=(e+1/e)/2,e}function rr(t,e,a){for(var i=Math.sin(e),s=Math.cos(e),n=nr(a),o=ac(a),r=2*s*o,h=-2*i*n,c=t.length-1,d=t[c],u=0,m=0,v=0,p,b;--c>=0;)p=m,b=u,m=d,u=v,d=-p+r*m-h*u+t[c],v=-b+h*m+r*u;return r=i*o,h=s*n,[r*d-h*v,r*v+h*d]}function ic(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(di.init.apply(this),this.forward=di.forward,this.inverse=di.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),a=e;this.cgb[0]=e*(2+e*(-2/3+e*(-2+e*(116/45+e*(26/45+e*(-2854/675)))))),this.cbg[0]=e*(-2+e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))),a=a*e,this.cgb[1]=a*(7/3+e*(-8/5+e*(-227/45+e*(2704/315+e*(2323/945))))),this.cbg[1]=a*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),a=a*e,this.cgb[2]=a*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=a*(-26/15+e*(34/21+e*(8/5+e*(-12686/2835)))),a=a*e,this.cgb[3]=a*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=a*(1237/630+e*(-12/5+e*(-24832/14175))),a=a*e,this.cgb[4]=a*(4174/315+e*(-144838/6237)),this.cbg[4]=a*(-734/315+e*(109598/31185)),a=a*e,this.cgb[5]=a*(601676/22275),this.cbg[5]=a*(444337/155925),a=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+a*(1/4+a*(1/64+a/256))),this.utg[0]=e*(-.5+e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=a*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=a*(13/48+e*(-3/5+e*(557/1440+e*(281/630+e*(-1983433/1935360))))),a=a*e,this.utg[2]=a*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=a*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),a=a*e,this.utg[3]=a*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=a*(49561/161280+e*(-179/168+e*(6601661/7257600))),a=a*e,this.utg[4]=a*(-4583/161280+e*(108847/3991680)),this.gtu[4]=a*(34729/80640+e*(-3418889/1995840)),a=a*e,this.utg[5]=a*(-20648693/638668800),this.gtu[5]=a*(212378941/319334400);var i=cs(this.cbg,this.lat0);this.Zb=-this.Qn*(i+ec(this.gtu,2*i))}function sc(t){var e=k(t.x-this.long0),a=t.y;a=cs(this.cbg,a);var i=Math.sin(a),s=Math.cos(a),n=Math.sin(e),o=Math.cos(e);a=Math.atan2(i,o*s),e=Math.atan2(n*s,Vt(i,s*o)),e=tc(Math.tan(e));var r=rr(this.gtu,2*a,2*e);a=a+r[0],e=e+r[1];var h,c;return Math.abs(e)<=2.623395162778?(h=this.a*(this.Qn*e)+this.x0,c=this.a*(this.Qn*a+this.Zb)+this.y0):(h=1/0,c=1/0),t.x=h,t.y=c,t}function nc(t){var e=(t.x-this.x0)*(1/this.a),a=(t.y-this.y0)*(1/this.a);a=(a-this.Zb)/this.Qn,e=e/this.Qn;var i,s;if(Math.abs(e)<=2.623395162778){var n=rr(this.utg,2*a,2*e);a=a+n[0],e=e+n[1],e=Math.atan(nr(e));var o=Math.sin(a),r=Math.cos(a),h=Math.sin(e),c=Math.cos(e);a=Math.atan2(o*c,Vt(h,c*r)),e=Math.atan2(h,c*r),i=k(e+this.long0),s=cs(this.cgb,a)}else i=1/0,s=1/0;return t.x=i,t.y=s,t}var rc=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Mi={init:ic,forward:sc,inverse:nc,names:rc};function oc(t,e){if(t===void 0){if(t=Math.floor((k(e)+Math.PI)*30/Math.PI)+1,t<0)return 0;if(t>60)return 60}return t}var hc="etmerc";function lc(){var t=oc(this.zone,this.long0);if(t===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*At,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Mi.init.apply(this),this.forward=Mi.forward,this.inverse=Mi.inverse}var cc=["Universal Transverse Mercator System","utm"];const uc={init:lc,names:cc,dependsOn:hc};function us(t,e){return Math.pow((1-t)/(1+t),e)}var fc=20;function mc(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+it)/(Math.pow(Math.tan(.5*this.lat0+it),this.C)*us(this.e*t,this.ratexp))}function dc(t){var e=t.x,a=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*a+it),this.C)*us(this.e*Math.sin(a),this.ratexp))-T,t.x=this.C*e,t}function Mc(t){for(var e=1e-14,a=t.x/this.C,i=t.y,s=Math.pow(Math.tan(.5*i+it)/this.K,1/this.C),n=fc;n>0&&(i=2*Math.atan(s*us(this.e*Math.sin(t.y),-.5*this.e))-T,!(Math.abs(i-t.y)<e));--n)t.y=i;return n?(t.x=a,t.y=i,t):null}var yc=["gauss"];const fs={init:mc,forward:dc,inverse:Mc,names:yc};function vc(){fs.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function gc(t){var e,a,i,s;return t.x=k(t.x-this.long0),fs.forward.apply(this,[t]),e=Math.sin(t.y),a=Math.cos(t.y),i=Math.cos(t.x),s=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*a*i),t.x=s*a*Math.sin(t.x),t.y=s*(this.cosc0*e-this.sinc0*a*i),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function pc(t){var e,a,i,s,n;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,n=Vt(t.x,t.y)){var o=2*Math.atan2(n,this.R2);e=Math.sin(o),a=Math.cos(o),s=Math.asin(a*this.sinc0+t.y*e*this.cosc0/n),i=Math.atan2(t.x*e,n*this.cosc0*a-t.y*this.sinc0*e)}else s=this.phic0,i=0;return t.x=i,t.y=s,fs.inverse.apply(this,[t]),t.x=k(t.x+this.long0),t}var xc=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const bc={init:vc,forward:gc,inverse:pc,names:xc};function Pc(t,e,a){return e*=a,Math.tan(.5*(T+t))*Math.pow((1-e)/(1+e),.5*a)}function _c(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=R&&(this.k0=.5*(1+qa(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=R&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=R&&Math.abs(Math.cos(this.lat_ts))>R&&(this.k0=.5*this.cons*fe(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/ae(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=fe(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-T,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function wc(t){var e=t.x,a=t.y,i=Math.sin(a),s=Math.cos(a),n,o,r,h,c,d,u=k(e-this.long0);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=R&&Math.abs(a+this.lat0)<=R?(t.x=NaN,t.y=NaN,t):this.sphere?(n=2*this.k0/(1+this.sinlat0*i+this.coslat0*s*Math.cos(u)),t.x=this.a*n*s*Math.sin(u)+this.x0,t.y=this.a*n*(this.coslat0*i-this.sinlat0*s*Math.cos(u))+this.y0,t):(o=2*Math.atan(this.ssfn_(a,i,this.e))-T,h=Math.cos(o),r=Math.sin(o),Math.abs(this.coslat0)<=R?(c=ae(this.e,a*this.con,this.con*i),d=2*this.a*this.k0*c/this.cons,t.x=this.x0+d*Math.sin(e-this.long0),t.y=this.y0-this.con*d*Math.cos(e-this.long0),t):(Math.abs(this.sinlat0)<R?(n=2*this.a*this.k0/(1+h*Math.cos(u)),t.y=n*r):(n=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*r+this.cosX0*h*Math.cos(u))),t.y=n*(this.cosX0*r-this.sinX0*h*Math.cos(u))+this.y0),t.x=n*h*Math.sin(u)+this.x0,t))}function Ec(t){t.x-=this.x0,t.y-=this.y0;var e,a,i,s,n,o=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var r=2*Math.atan(o/(2*this.a*this.k0));return e=this.long0,a=this.lat0,o<=R?(t.x=e,t.y=a,t):(a=Math.asin(Math.cos(r)*this.sinlat0+t.y*Math.sin(r)*this.coslat0/o),Math.abs(this.coslat0)<R?this.lat0>0?e=k(this.long0+Math.atan2(t.x,-1*t.y)):e=k(this.long0+Math.atan2(t.x,t.y)):e=k(this.long0+Math.atan2(t.x*Math.sin(r),o*this.coslat0*Math.cos(r)-t.y*this.sinlat0*Math.sin(r))),t.x=e,t.y=a,t)}else if(Math.abs(this.coslat0)<=R){if(o<=R)return a=this.lat0,e=this.long0,t.x=e,t.y=a,t;t.x*=this.con,t.y*=this.con,i=o*this.cons/(2*this.a*this.k0),a=this.con*Da(this.e,i),e=this.con*k(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else s=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,o<=R?n=this.X0:(n=Math.asin(Math.cos(s)*this.sinX0+t.y*Math.sin(s)*this.cosX0/o),e=k(this.long0+Math.atan2(t.x*Math.sin(s),o*this.cosX0*Math.cos(s)-t.y*this.sinX0*Math.sin(s)))),a=-1*Da(this.e,Math.tan(.5*(T+n)));return t.x=e,t.y=a,t}var Ac=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const Sc={init:_c,forward:wc,inverse:Ec,names:Ac,ssfn_:Pc};function Nc(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),a=this.a,i=this.rf,s=1/i,n=2*s-Math.pow(s,2),o=this.e=Math.sqrt(n);this.R=this.k0*a*Math.sqrt(1-n)/(1-n*Math.pow(e,2)),this.alpha=Math.sqrt(1+n/(1-n)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var r=Math.log(Math.tan(Math.PI/4+this.b0/2)),h=Math.log(Math.tan(Math.PI/4+t/2)),c=Math.log((1+o*e)/(1-o*e));this.K=r-this.alpha*h+this.alpha*o/2*c}function Cc(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),a=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),i=-this.alpha*(e+a)+this.K,s=2*(Math.atan(Math.exp(i))-Math.PI/4),n=this.alpha*(t.x-this.lambda0),o=Math.atan(Math.sin(n)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(n))),r=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(n));return t.y=this.R/2*Math.log((1+Math.sin(r))/(1-Math.sin(r)))+this.y0,t.x=this.R*o+this.x0,t}function Tc(t){for(var e=t.x-this.x0,a=t.y-this.y0,i=e/this.R,s=2*(Math.atan(Math.exp(a/this.R))-Math.PI/4),n=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(i)),o=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(s))),r=this.lambda0+o/this.alpha,h=0,c=n,d=-1e3,u=0;Math.abs(c-d)>1e-7;){if(++u>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+n/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),d=c,c=2*Math.atan(Math.exp(h))-Math.PI/2}return t.x=r,t.y=c,t}var Ic=["somerc"];const Oc={init:Nc,forward:Cc,inverse:Tc,names:Ic};var ea=1e-7;function Rc(t){var e=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],a=typeof t.PROJECTION=="object"?Object.keys(t.PROJECTION)[0]:t.PROJECTION;return"no_uoff"in t||"no_off"in t||e.indexOf(a)!==-1}function Lc(){var t,e,a,i,s,n,o,r,h,c,d=0,u,m=0,v=0,p=0,b=0,w=0,A=0;this.no_off=Rc(this),this.no_rot="no_rot"in this;var C=!1;"alpha"in this&&(C=!0);var S=!1;if("rectified_grid_angle"in this&&(S=!0),C&&(A=this.alpha),S&&(d=this.rectified_grid_angle*At),C||S)m=this.longc;else if(v=this.long1,b=this.lat1,p=this.long2,w=this.lat2,Math.abs(b-w)<=ea||(t=Math.abs(b))<=ea||Math.abs(t-T)<=ea||Math.abs(Math.abs(this.lat0)-T)<=ea||Math.abs(Math.abs(w)-T)<=ea)throw new Error;var I=1-this.es;e=Math.sqrt(I),Math.abs(this.lat0)>R?(r=Math.sin(this.lat0),a=Math.cos(this.lat0),t=1-this.es*r*r,this.B=a*a,this.B=Math.sqrt(1+this.es*this.B*this.B/I),this.A=this.B*this.k0*e/t,i=this.B*e/(a*Math.sqrt(t)),s=i*i-1,s<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=i,this.E*=Math.pow(ae(this.e,this.lat0,r),this.B)):(this.B=1/e,this.A=this.k0,this.E=i=s=1),C||S?(C?(u=Math.asin(Math.sin(A)/i),S||(d=A)):(u=d,A=Math.asin(i*Math.sin(u))),this.lam0=m-Math.asin(.5*(s-1/s)*Math.tan(u))/this.B):(n=Math.pow(ae(this.e,b,Math.sin(b)),this.B),o=Math.pow(ae(this.e,w,Math.sin(w)),this.B),s=this.E/n,h=(o-n)/(o+n),c=this.E*this.E,c=(c-o*n)/(c+o*n),t=v-p,t<-Math.pi?p-=La:t>Math.pi&&(p+=La),this.lam0=k(.5*(v+p)-Math.atan(c*Math.tan(.5*this.B*(v-p))/h)/this.B),u=Math.atan(2*Math.sin(this.B*k(v-this.lam0))/(s-1/s)),d=A=Math.asin(i*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(d),this.cosrot=Math.cos(d),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(A))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(it-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(it+s))}function kc(t){var e={},a,i,s,n,o,r,h,c;if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-T)>R){if(o=this.E/Math.pow(ae(this.e,t.y,Math.sin(t.y)),this.B),r=1/o,a=.5*(o-r),i=.5*(o+r),n=Math.sin(this.B*t.x),s=(a*this.singam-n*this.cosgam)/i,Math.abs(Math.abs(s)-1)<R)throw new Error;c=.5*this.ArB*Math.log((1-s)/(1+s)),r=Math.cos(this.B*t.x),Math.abs(r)<ea?h=this.A*t.x:h=this.ArB*Math.atan2(a*this.cosgam+n*this.singam,r)}else c=t.y>0?this.v_pole_n:this.v_pole_s,h=this.ArB*t.y;return this.no_rot?(e.x=h,e.y=c):(h-=this.u_0,e.x=c*this.cosrot+h*this.sinrot,e.y=h*this.cosrot-c*this.sinrot),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function Dc(t){var e,a,i,s,n,o,r,h={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(a=t.y,e=t.x):(a=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),i=Math.exp(-this.BrA*a),s=.5*(i-1/i),n=.5*(i+1/i),o=Math.sin(this.BrA*e),r=(o*this.cosgam+s*this.singam)/n,Math.abs(Math.abs(r)-1)<R)h.x=0,h.y=r<0?-T:T;else{if(h.y=this.E/Math.sqrt((1+r)/(1-r)),h.y=Da(this.e,Math.pow(h.y,1/this.B)),h.y===1/0)throw new Error;h.x=-this.rB*Math.atan2(s*this.cosgam-o*this.singam,Math.cos(this.BrA*e))}return h.x+=this.lam0,h}var Fc=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const jc={init:Lc,forward:kc,inverse:Dc,names:Fc};function zc(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<R)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),a=Math.cos(this.lat1),i=fe(this.e,e,a),s=ae(this.e,this.lat1,e),n=Math.sin(this.lat2),o=Math.cos(this.lat2),r=fe(this.e,n,o),h=ae(this.e,this.lat2,n),c=ae(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>R?this.ns=Math.log(i/r)/Math.log(s/h):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=i/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(c,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function qc(t){var e=t.x,a=t.y;Math.abs(2*Math.abs(a)-Math.PI)<=R&&(a=qa(a)*(T-2*R));var i=Math.abs(Math.abs(a)-T),s,n;if(i>R)s=ae(this.e,a,Math.sin(a)),n=this.a*this.f0*Math.pow(s,this.ns);else{if(i=a*this.ns,i<=0)return null;n=0}var o=this.ns*k(e-this.long0);return t.x=this.k0*(n*Math.sin(o))+this.x0,t.y=this.k0*(this.rh-n*Math.cos(o))+this.y0,t}function Gc(t){var e,a,i,s,n,o=(t.x-this.x0)/this.k0,r=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(o*o+r*r),a=1):(e=-Math.sqrt(o*o+r*r),a=-1);var h=0;if(e!==0&&(h=Math.atan2(a*o,a*r)),e!==0||this.ns>0){if(a=1/this.ns,i=Math.pow(e/(this.a*this.f0),a),s=Da(this.e,i),s===-9999)return null}else s=-T;return n=k(h/this.ns+this.long0),t.x=n,t.y=s,t}var $c=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const Bc={init:zc,forward:qc,inverse:Gc,names:$c};function Uc(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function Hc(t){var e,a,i,s,n,o,r,h=t.x,c=t.y,d=k(h-this.long0);return e=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),a=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/e)-this.s45),i=-d*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(a)+Math.sin(this.ad)*Math.cos(a)*Math.cos(i)),n=Math.asin(Math.cos(a)*Math.sin(i)/Math.cos(s)),o=this.n*n,r=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),t.y=r*Math.cos(o)/1,t.x=r*Math.sin(o)/1,this.czech||(t.y*=-1,t.x*=-1),t}function Wc(t){var e,a,i,s,n,o,r,h,c=t.x;t.x=t.y,t.y=c,this.czech||(t.y*=-1,t.x*=-1),o=Math.sqrt(t.x*t.x+t.y*t.y),n=Math.atan2(t.y,t.x),s=n/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(s)),a=Math.asin(Math.cos(i)*Math.sin(s)/Math.cos(e)),t.x=this.long0-a/this.alfa,r=e,h=0;var d=0;do t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(r))/(1-this.e*Math.sin(r)),this.e/2))-this.s45),Math.abs(r-t.y)<1e-10&&(h=1),r=t.y,d+=1;while(h===0&&d<15);return d>=15?null:t}var Zc=["Krovak","krovak"];const Vc={init:Uc,forward:Hc,inverse:Wc,names:Zc};function kt(t,e,a,i,s){return t*s-e*Math.sin(2*s)+a*Math.sin(4*s)-i*Math.sin(6*s)}function Ga(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function $a(t){return .375*t*(1+.25*t*(1+.46875*t))}function Ba(t){return .05859375*t*t*(1+.75*t)}function Ua(t){return t*t*t*(35/3072)}function ua(t,e,a){var i=e*a;return t/Math.sqrt(1-i*i)}function fa(t){return Math.abs(t)<T?t:t-qa(t)*Math.PI}function xi(t,e,a,i,s){var n,o;n=t/e;for(var r=0;r<15;r++)if(o=(t-(e*n-a*Math.sin(2*n)+i*Math.sin(4*n)-s*Math.sin(6*n)))/(e-2*a*Math.cos(2*n)+4*i*Math.cos(4*n)-6*s*Math.cos(6*n)),n+=o,Math.abs(o)<=1e-10)return n;return NaN}function Qc(){this.sphere||(this.e0=Ga(this.es),this.e1=$a(this.es),this.e2=Ba(this.es),this.e3=Ua(this.es),this.ml0=this.a*kt(this.e0,this.e1,this.e2,this.e3,this.lat0))}function Kc(t){var e,a,i=t.x,s=t.y;if(i=k(i-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(s)*Math.sin(i)),a=this.a*(Math.atan2(Math.tan(s),Math.cos(i))-this.lat0);else{var n=Math.sin(s),o=Math.cos(s),r=ua(this.a,this.e,n),h=Math.tan(s)*Math.tan(s),c=i*Math.cos(s),d=c*c,u=this.es*o*o/(1-this.es),m=this.a*kt(this.e0,this.e1,this.e2,this.e3,s);e=r*c*(1-d*h*(1/6-(8-h+8*u)*d/120)),a=m-this.ml0+r*n/o*d*(.5+(5-h+6*u)*d/24)}return t.x=e+this.x0,t.y=a+this.y0,t}function Xc(t){t.x-=this.x0,t.y-=this.y0;var e=t.x/this.a,a=t.y/this.a,i,s;if(this.sphere){var n=a+this.lat0;i=Math.asin(Math.sin(n)*Math.cos(e)),s=Math.atan2(Math.tan(e),Math.cos(n))}else{var o=this.ml0/this.a+a,r=xi(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(r)-T)<=R)return t.x=this.long0,t.y=T,a<0&&(t.y*=-1),t;var h=ua(this.a,this.e,Math.sin(r)),c=h*h*h/this.a/this.a*(1-this.es),d=Math.pow(Math.tan(r),2),u=e*this.a/h,m=u*u;i=r-h*Math.tan(r)/c*u*u*(.5-(1+3*d)*u*u/24),s=u*(1-m*(d/3+(1+3*d)*d*m/15))/Math.cos(r)}return t.x=k(s+this.long0),t.y=fa(i),t}var Yc=["Cassini","Cassini_Soldner","cass"];const Jc={init:Qc,forward:Kc,inverse:Xc,names:Yc};function Le(t,e){var a;return t>1e-7?(a=t*e,(1-t*t)*(e/(1-a*a)-.5/t*Math.log((1-a)/(1+a)))):2*e}var t0=1,e0=2,a0=3,i0=4;function s0(){var t=Math.abs(this.lat0);if(Math.abs(t-T)<R?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<R?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=Le(this.e,1),this.mmf=.5/(1-this.es),this.apa=m0(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=Le(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function n0(t){var e,a,i,s,n,o,r,h,c,d,u=t.x,m=t.y;if(u=k(u-this.long0),this.sphere){if(n=Math.sin(m),d=Math.cos(m),i=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(a=this.mode===this.EQUIT?1+d*i:1+this.sinph0*n+this.cosph0*d*i,a<=R)return null;a=Math.sqrt(2/a),e=a*d*Math.sin(u),a*=this.mode===this.EQUIT?n:this.cosph0*n-this.sinph0*d*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(m+this.lat0)<R)return null;a=it-m*.5,a=2*(this.mode===this.S_POLE?Math.cos(a):Math.sin(a)),e=a*Math.sin(u),a*=i}}else{switch(r=0,h=0,c=0,i=Math.cos(u),s=Math.sin(u),n=Math.sin(m),o=Le(this.e,n),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(r=o/this.qp,h=Math.sqrt(1-r*r)),this.mode){case this.OBLIQ:c=1+this.sinb1*r+this.cosb1*h*i;break;case this.EQUIT:c=1+h*i;break;case this.N_POLE:c=T+m,o=this.qp-o;break;case this.S_POLE:c=m-T,o=this.qp+o;break}if(Math.abs(c)<R)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),this.mode===this.OBLIQ?a=this.ymf*c*(this.cosb1*r-this.sinb1*h*i):a=(c=Math.sqrt(2/(1+h*i)))*r*this.ymf,e=this.xmf*c*h*s;break;case this.N_POLE:case this.S_POLE:o>=0?(e=(c=Math.sqrt(o))*s,a=i*(this.mode===this.S_POLE?c:-c)):e=a=0;break}}return t.x=this.a*e+this.x0,t.y=this.a*a+this.y0,t}function r0(t){t.x-=this.x0,t.y-=this.y0;var e=t.x/this.a,a=t.y/this.a,i,s,n,o,r,h,c;if(this.sphere){var d=0,u,m=0;if(u=Math.sqrt(e*e+a*a),s=u*.5,s>1)return null;switch(s=2*Math.asin(s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(m=Math.sin(s),d=Math.cos(s)),this.mode){case this.EQUIT:s=Math.abs(u)<=R?0:Math.asin(a*m/u),e*=m,a=d*u;break;case this.OBLIQ:s=Math.abs(u)<=R?this.lat0:Math.asin(d*this.sinph0+a*m*this.cosph0/u),e*=m*this.cosph0,a=(d-Math.sin(s)*this.sinph0)*u;break;case this.N_POLE:a=-a,s=T-s;break;case this.S_POLE:s-=T;break}i=a===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(e,a)}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e/=this.dd,a*=this.dd,h=Math.sqrt(e*e+a*a),h<R)return t.x=this.long0,t.y=this.lat0,t;o=2*Math.asin(.5*h/this.rq),n=Math.cos(o),e*=o=Math.sin(o),this.mode===this.OBLIQ?(c=n*this.sinb1+a*o*this.cosb1/h,r=this.qp*c,a=h*this.cosb1*n-a*this.sinb1*o):(c=a*o/h,r=this.qp*c,a=h*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(a=-a),r=e*e+a*a,!r)return t.x=this.long0,t.y=this.lat0,t;c=1-r/this.qp,this.mode===this.S_POLE&&(c=-c)}i=Math.atan2(e,a),s=d0(Math.asin(c),this.apa)}return t.x=k(this.long0+i),t.y=s,t}var o0=.3333333333333333,h0=.17222222222222222,l0=.10257936507936508,c0=.06388888888888888,u0=.0664021164021164,f0=.016415012942191543;function m0(t){var e,a=[];return a[0]=t*o0,e=t*t,a[0]+=e*h0,a[1]=e*c0,e*=t,a[0]+=e*l0,a[1]+=e*u0,a[2]=e*f0,a}function d0(t,e){var a=t+t;return t+e[0]*Math.sin(a)+e[1]*Math.sin(a+a)+e[2]*Math.sin(a+a+a)}var M0=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const y0={init:s0,forward:n0,inverse:r0,names:M0,S_POLE:t0,N_POLE:e0,EQUIT:a0,OBLIQ:i0};function De(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}function v0(){Math.abs(this.lat1+this.lat2)<R||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=fe(this.e3,this.sin_po,this.cos_po),this.qs1=Le(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=fe(this.e3,this.sin_po,this.cos_po),this.qs2=Le(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Le(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>R?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function g0(t){var e=t.x,a=t.y;this.sin_phi=Math.sin(a),this.cos_phi=Math.cos(a);var i=Le(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,n=this.ns0*k(e-this.long0),o=s*Math.sin(n)+this.x0,r=this.rh-s*Math.cos(n)+this.y0;return t.x=o,t.y=r,t}function p0(t){var e,a,i,s,n,o;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),i=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),i=-1),s=0,e!==0&&(s=Math.atan2(i*t.x,i*t.y)),i=e*this.ns0/this.a,this.sphere?o=Math.asin((this.c-i*i)/(2*this.ns0)):(a=(this.c-i*i)/this.ns0,o=this.phi1z(this.e3,a)),n=k(s/this.ns0+this.long0),t.x=n,t.y=o,t}function x0(t,e){var a,i,s,n,o,r=De(.5*e);if(t<R)return r;for(var h=t*t,c=1;c<=25;c++)if(a=Math.sin(r),i=Math.cos(r),s=t*a,n=1-s*s,o=.5*n*n/i*(e/(1-h)-a/n+.5/t*Math.log((1-s)/(1+s))),r=r+o,Math.abs(o)<=1e-7)return r;return null}var b0=["Albers_Conic_Equal_Area","Albers","aea"];const P0={init:v0,forward:g0,inverse:p0,names:b0,phi1z:x0};function _0(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function w0(t){var e,a,i,s,n,o,r,h,c=t.x,d=t.y;return i=k(c-this.long0),e=Math.sin(d),a=Math.cos(d),s=Math.cos(i),o=this.sin_p14*e+this.cos_p14*a*s,n=1,o>0||Math.abs(o)<=R?(r=this.x0+this.a*n*a*Math.sin(i)/o,h=this.y0+this.a*n*(this.cos_p14*e-this.sin_p14*a*s)/o):(r=this.x0+this.infinity_dist*a*Math.sin(i),h=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*a*s)),t.x=r,t.y=h,t}function E0(t){var e,a,i,s,n,o;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(s=Math.atan2(e,this.rc),a=Math.sin(s),i=Math.cos(s),o=De(i*this.sin_p14+t.y*a*this.cos_p14/e),n=Math.atan2(t.x*a,e*this.cos_p14*i-t.y*this.sin_p14*a),n=k(this.long0+n)):(o=this.phic0,n=0),t.x=n,t.y=o,t}var A0=["gnom"];const S0={init:_0,forward:w0,inverse:E0,names:A0};function N0(t,e){var a=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-a)<1e-6)return e<0?-1*T:T;for(var i=Math.asin(.5*e),s,n,o,r,h=0;h<30;h++)if(n=Math.sin(i),o=Math.cos(i),r=t*n,s=Math.pow(1-r*r,2)/(2*o)*(e/(1-t*t)-n/(1-r*r)+.5/t*Math.log((1-r)/(1+r))),i+=s,Math.abs(s)<=1e-10)return i;return NaN}function C0(){this.sphere||(this.k0=fe(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function T0(t){var e=t.x,a=t.y,i,s,n=k(e-this.long0);if(this.sphere)i=this.x0+this.a*n*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(a)/Math.cos(this.lat_ts);else{var o=Le(this.e,Math.sin(a));i=this.x0+this.a*this.k0*n,s=this.y0+this.a*o*.5/this.k0}return t.x=i,t.y=s,t}function I0(t){t.x-=this.x0,t.y-=this.y0;var e,a;return this.sphere?(e=k(this.long0+t.x/this.a/Math.cos(this.lat_ts)),a=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(a=N0(this.e,2*t.y*this.k0/this.a),e=k(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=a,t}var O0=["cea"];const R0={init:C0,forward:T0,inverse:I0,names:O0};function L0(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function k0(t){var e=t.x,a=t.y,i=k(e-this.long0),s=fa(a-this.lat0);return t.x=this.x0+this.a*i*this.rc,t.y=this.y0+this.a*s,t}function D0(t){var e=t.x,a=t.y;return t.x=k(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=fa(this.lat0+(a-this.y0)/this.a),t}var F0=["Equirectangular","Equidistant_Cylindrical","eqc"];const j0={init:L0,forward:k0,inverse:D0,names:F0};var An=20;function z0(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ga(this.es),this.e1=$a(this.es),this.e2=Ba(this.es),this.e3=Ua(this.es),this.ml0=this.a*kt(this.e0,this.e1,this.e2,this.e3,this.lat0)}function q0(t){var e=t.x,a=t.y,i,s,n,o=k(e-this.long0);if(n=o*Math.sin(a),this.sphere)Math.abs(a)<=R?(i=this.a*o,s=-1*this.a*this.lat0):(i=this.a*Math.sin(n)/Math.tan(a),s=this.a*(fa(a-this.lat0)+(1-Math.cos(n))/Math.tan(a)));else if(Math.abs(a)<=R)i=this.a*o,s=-1*this.ml0;else{var r=ua(this.a,this.e,Math.sin(a))/Math.tan(a);i=r*Math.sin(n),s=this.a*kt(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+r*(1-Math.cos(n))}return t.x=i+this.x0,t.y=s+this.y0,t}function G0(t){var e,a,i,s,n,o,r,h,c;if(i=t.x-this.x0,s=t.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=R)e=k(i/this.a+this.long0),a=0;else{o=this.lat0+s/this.a,r=i*i/this.a/this.a+o*o,h=o;var d;for(n=An;n;--n)if(d=Math.tan(h),c=-1*(o*(h*d+1)-h-.5*(h*h+r)*d)/((h-o)/d-1),h+=c,Math.abs(c)<=R){a=h;break}e=k(this.long0+Math.asin(i*Math.tan(h)/this.a)/Math.sin(a))}else if(Math.abs(s+this.ml0)<=R)a=0,e=k(this.long0+i/this.a);else{o=(this.ml0+s)/this.a,r=i*i/this.a/this.a+o*o,h=o;var u,m,v,p,b;for(n=An;n;--n)if(b=this.e*Math.sin(h),u=Math.sqrt(1-b*b)*Math.tan(h),m=this.a*kt(this.e0,this.e1,this.e2,this.e3,h),v=this.e0-2*this.e1*Math.cos(2*h)+4*this.e2*Math.cos(4*h)-6*this.e3*Math.cos(6*h),p=m/this.a,c=(o*(u*p+1)-p-.5*u*(p*p+r))/(this.es*Math.sin(2*h)*(p*p+r-2*o*p)/(4*u)+(o-p)*(u*v-2/Math.sin(2*h))-v),h-=c,Math.abs(c)<=R){a=h;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(a),2))*Math.tan(a),e=k(this.long0+Math.asin(i*u/this.a)/Math.sin(a))}return t.x=e,t.y=a,t}var $0=["Polyconic","poly"];const B0={init:z0,forward:q0,inverse:G0,names:$0};function U0(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function H0(t){var e,a=t.x,i=t.y,s=i-this.lat0,n=a-this.long0,o=s/Na*1e-5,r=n,h=1,c=0;for(e=1;e<=10;e++)h=h*o,c=c+this.A[e]*h;var d=c,u=r,m=1,v=0,p,b,w=0,A=0;for(e=1;e<=6;e++)p=m*d-v*u,b=v*d+m*u,m=p,v=b,w=w+this.B_re[e]*m-this.B_im[e]*v,A=A+this.B_im[e]*m+this.B_re[e]*v;return t.x=A*this.a+this.x0,t.y=w*this.a+this.y0,t}function W0(t){var e,a=t.x,i=t.y,s=a-this.x0,n=i-this.y0,o=n/this.a,r=s/this.a,h=1,c=0,d,u,m=0,v=0;for(e=1;e<=6;e++)d=h*o-c*r,u=c*o+h*r,h=d,c=u,m=m+this.C_re[e]*h-this.C_im[e]*c,v=v+this.C_im[e]*h+this.C_re[e]*c;for(var p=0;p<this.iterations;p++){var b=m,w=v,A,C,S=o,I=r;for(e=2;e<=6;e++)A=b*m-w*v,C=w*m+b*v,b=A,w=C,S=S+(e-1)*(this.B_re[e]*b-this.B_im[e]*w),I=I+(e-1)*(this.B_im[e]*b+this.B_re[e]*w);b=1,w=0;var F=this.B_re[1],j=this.B_im[1];for(e=2;e<=6;e++)A=b*m-w*v,C=w*m+b*v,b=A,w=C,F=F+e*(this.B_re[e]*b-this.B_im[e]*w),j=j+e*(this.B_im[e]*b+this.B_re[e]*w);var $=F*F+j*j;m=(S*F+I*j)/$,v=(I*F-S*j)/$}var B=m,O=v,H=1,G=0;for(e=1;e<=9;e++)H=H*B,G=G+this.D[e]*H;var z=this.lat0+G*Na*1e5,nt=this.long0+O;return t.x=nt,t.y=z,t}var Z0=["New_Zealand_Map_Grid","nzmg"];const V0={init:U0,forward:H0,inverse:W0,names:Z0};function Q0(){}function K0(t){var e=t.x,a=t.y,i=k(e-this.long0),s=this.x0+this.a*i,n=this.y0+this.a*Math.log(Math.tan(Math.PI/4+a/2.5))*1.25;return t.x=s,t.y=n,t}function X0(t){t.x-=this.x0,t.y-=this.y0;var e=k(this.long0+t.x/this.a),a=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=a,t}var Y0=["Miller_Cylindrical","mill"];const J0={init:Q0,forward:K0,inverse:X0,names:Y0};var tu=20;function eu(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=ir(this.es)}function au(t){var e,a,i=t.x,s=t.y;if(i=k(i-this.long0),this.sphere){if(!this.m)s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;else for(var n=this.n*Math.sin(s),o=tu;o;--o){var r=(this.m*s+Math.sin(s)-n)/(this.m+Math.cos(s));if(s-=r,Math.abs(r)<R)break}e=this.a*this.C_x*i*(this.m+Math.cos(s)),a=this.a*this.C_y*s}else{var h=Math.sin(s),c=Math.cos(s);a=this.a*Si(s,h,c,this.en),e=this.a*i*c/Math.sqrt(1-this.es*h*h)}return t.x=e,t.y=a,t}function iu(t){var e,a,i,s;return t.x-=this.x0,i=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,i=i/(this.C_x*(this.m+Math.cos(e))),this.m?e=De((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=De(Math.sin(e)/this.n)),i=k(i+this.long0),e=fa(e)):(e=sr(t.y/this.a,this.es,this.en),s=Math.abs(e),s<T?(s=Math.sin(e),a=this.long0+t.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(e)),i=k(a)):s-R<T&&(i=this.long0)),t.x=i,t.y=e,t}var su=["Sinusoidal","sinu"];const nu={init:eu,forward:au,inverse:iu,names:su};function ru(){}function ou(t){for(var e=t.x,a=t.y,i=k(e-this.long0),s=a,n=Math.PI*Math.sin(a);;){var o=-(s+Math.sin(s)-n)/(1+Math.cos(s));if(s+=o,Math.abs(o)<R)break}s/=2,Math.PI/2-Math.abs(a)<R&&(i=0);var r=.900316316158*this.a*i*Math.cos(s)+this.x0,h=1.4142135623731*this.a*Math.sin(s)+this.y0;return t.x=r,t.y=h,t}function hu(t){var e,a;t.x-=this.x0,t.y-=this.y0,a=t.y/(1.4142135623731*this.a),Math.abs(a)>.999999999999&&(a=.999999999999),e=Math.asin(a);var i=k(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),a=(2*e+Math.sin(2*e))/Math.PI,Math.abs(a)>1&&(a=1);var s=Math.asin(a);return t.x=i,t.y=s,t}var lu=["Mollweide","moll"];const cu={init:ru,forward:ou,inverse:hu,names:lu};function uu(){Math.abs(this.lat1+this.lat2)<R||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ga(this.es),this.e1=$a(this.es),this.e2=Ba(this.es),this.e3=Ua(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=fe(this.e,this.sinphi,this.cosphi),this.ml1=kt(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<R?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=fe(this.e,this.sinphi,this.cosphi),this.ml2=kt(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=kt(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function fu(t){var e=t.x,a=t.y,i;if(this.sphere)i=this.a*(this.g-a);else{var s=kt(this.e0,this.e1,this.e2,this.e3,a);i=this.a*(this.g-s)}var n=this.ns*k(e-this.long0),o=this.x0+i*Math.sin(n),r=this.y0+this.rh-i*Math.cos(n);return t.x=o,t.y=r,t}function mu(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var e,a,i,s;this.ns>=0?(a=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(a=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var n=0;if(a!==0&&(n=Math.atan2(e*t.x,e*t.y)),this.sphere)return s=k(this.long0+n/this.ns),i=fa(this.g-a/this.a),t.x=s,t.y=i,t;var o=this.g-a/this.a;return i=xi(o,this.e0,this.e1,this.e2,this.e3),s=k(this.long0+n/this.ns),t.x=s,t.y=i,t}var du=["Equidistant_Conic","eqdc"];const Mu={init:uu,forward:fu,inverse:mu,names:du};function yu(){this.R=this.a}function vu(t){var e=t.x,a=t.y,i=k(e-this.long0),s,n;Math.abs(a)<=R&&(s=this.x0+this.R*i,n=this.y0);var o=De(2*Math.abs(a/Math.PI));(Math.abs(i)<=R||Math.abs(Math.abs(a)-T)<=R)&&(s=this.x0,a>=0?n=this.y0+Math.PI*this.R*Math.tan(.5*o):n=this.y0+Math.PI*this.R*-Math.tan(.5*o));var r=.5*Math.abs(Math.PI/i-i/Math.PI),h=r*r,c=Math.sin(o),d=Math.cos(o),u=d/(c+d-1),m=u*u,v=u*(2/c-1),p=v*v,b=Math.PI*this.R*(r*(u-p)+Math.sqrt(h*(u-p)*(u-p)-(p+h)*(m-p)))/(p+h);i<0&&(b=-b),s=this.x0+b;var w=h+u;return b=Math.PI*this.R*(v*w-r*Math.sqrt((p+h)*(h+1)-w*w))/(p+h),a>=0?n=this.y0+b:n=this.y0-b,t.x=s,t.y=n,t}function gu(t){var e,a,i,s,n,o,r,h,c,d,u,m,v;return t.x-=this.x0,t.y-=this.y0,u=Math.PI*this.R,i=t.x/u,s=t.y/u,n=i*i+s*s,o=-Math.abs(s)*(1+n),r=o-2*s*s+i*i,h=-2*o+1+2*s*s+n*n,v=s*s/h+(2*r*r*r/h/h/h-9*o*r/h/h)/27,c=(o-r*r/3/h)/h,d=2*Math.sqrt(-c/3),u=3*v/c/d,Math.abs(u)>1&&(u>=0?u=1:u=-1),m=Math.acos(u)/3,t.y>=0?a=(-d*Math.cos(m+Math.PI/3)-r/3/h)*Math.PI:a=-(-d*Math.cos(m+Math.PI/3)-r/3/h)*Math.PI,Math.abs(i)<R?e=this.long0:e=k(this.long0+Math.PI*(n-1+Math.sqrt(1+2*(i*i-s*s)+n*n))/2/i),t.x=e,t.y=a,t}var pu=["Van_der_Grinten_I","VanDerGrinten","vandg"];const xu={init:yu,forward:vu,inverse:gu,names:pu};function bu(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function Pu(t){var e=t.x,a=t.y,i=Math.sin(t.y),s=Math.cos(t.y),n=k(e-this.long0),o,r,h,c,d,u,m,v,p,b,w,A,C,S,I,F,j,$,B,O,H,G,z;return this.sphere?Math.abs(this.sin_p12-1)<=R?(t.x=this.x0+this.a*(T-a)*Math.sin(n),t.y=this.y0-this.a*(T-a)*Math.cos(n),t):Math.abs(this.sin_p12+1)<=R?(t.x=this.x0+this.a*(T+a)*Math.sin(n),t.y=this.y0+this.a*(T+a)*Math.cos(n),t):($=this.sin_p12*i+this.cos_p12*s*Math.cos(n),F=Math.acos($),j=F?F/Math.sin(F):1,t.x=this.x0+this.a*j*s*Math.sin(n),t.y=this.y0+this.a*j*(this.cos_p12*i-this.sin_p12*s*Math.cos(n)),t):(o=Ga(this.es),r=$a(this.es),h=Ba(this.es),c=Ua(this.es),Math.abs(this.sin_p12-1)<=R?(d=this.a*kt(o,r,h,c,T),u=this.a*kt(o,r,h,c,a),t.x=this.x0+(d-u)*Math.sin(n),t.y=this.y0-(d-u)*Math.cos(n),t):Math.abs(this.sin_p12+1)<=R?(d=this.a*kt(o,r,h,c,T),u=this.a*kt(o,r,h,c,a),t.x=this.x0+(d+u)*Math.sin(n),t.y=this.y0+(d+u)*Math.cos(n),t):(m=i/s,v=ua(this.a,this.e,this.sin_p12),p=ua(this.a,this.e,i),b=Math.atan((1-this.es)*m+this.es*v*this.sin_p12/(p*s)),w=Math.atan2(Math.sin(n),this.cos_p12*Math.tan(b)-this.sin_p12*Math.cos(n)),w===0?B=Math.asin(this.cos_p12*Math.sin(b)-this.sin_p12*Math.cos(b)):Math.abs(Math.abs(w)-Math.PI)<=R?B=-Math.asin(this.cos_p12*Math.sin(b)-this.sin_p12*Math.cos(b)):B=Math.asin(Math.sin(n)*Math.cos(b)/Math.sin(w)),A=this.e*this.sin_p12/Math.sqrt(1-this.es),C=this.e*this.cos_p12*Math.cos(w)/Math.sqrt(1-this.es),S=A*C,I=C*C,O=B*B,H=O*B,G=H*B,z=G*B,F=v*B*(1-O*I*(1-I)/6+H/8*S*(1-2*I)+G/120*(I*(4-7*I)-3*A*A*(1-7*I))-z/48*S),t.x=this.x0+F*Math.sin(w),t.y=this.y0+F*Math.cos(w),t))}function _u(t){t.x-=this.x0,t.y-=this.y0;var e,a,i,s,n,o,r,h,c,d,u,m,v,p,b,w,A,C,S,I,F,j,$,B;return this.sphere?(e=Math.sqrt(t.x*t.x+t.y*t.y),e>2*T*this.a?void 0:(a=e/this.a,i=Math.sin(a),s=Math.cos(a),n=this.long0,Math.abs(e)<=R?o=this.lat0:(o=De(s*this.sin_p12+t.y*i*this.cos_p12/e),r=Math.abs(this.lat0)-T,Math.abs(r)<=R?this.lat0>=0?n=k(this.long0+Math.atan2(t.x,-t.y)):n=k(this.long0-Math.atan2(-t.x,t.y)):n=k(this.long0+Math.atan2(t.x*i,e*this.cos_p12*s-t.y*this.sin_p12*i))),t.x=n,t.y=o,t)):(h=Ga(this.es),c=$a(this.es),d=Ba(this.es),u=Ua(this.es),Math.abs(this.sin_p12-1)<=R?(m=this.a*kt(h,c,d,u,T),e=Math.sqrt(t.x*t.x+t.y*t.y),v=m-e,o=xi(v/this.a,h,c,d,u),n=k(this.long0+Math.atan2(t.x,-1*t.y)),t.x=n,t.y=o,t):Math.abs(this.sin_p12+1)<=R?(m=this.a*kt(h,c,d,u,T),e=Math.sqrt(t.x*t.x+t.y*t.y),v=e-m,o=xi(v/this.a,h,c,d,u),n=k(this.long0+Math.atan2(t.x,t.y)),t.x=n,t.y=o,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),w=Math.atan2(t.x,t.y),p=ua(this.a,this.e,this.sin_p12),A=Math.cos(w),C=this.e*this.cos_p12*A,S=-C*C/(1-this.es),I=3*this.es*(1-S)*this.sin_p12*this.cos_p12*A/(1-this.es),F=e/p,j=F-S*(1+S)*Math.pow(F,3)/6-I*(1+3*S)*Math.pow(F,4)/24,$=1-S*j*j/2-F*j*j*j/6,b=Math.asin(this.sin_p12*Math.cos(j)+this.cos_p12*Math.sin(j)*A),n=k(this.long0+Math.asin(Math.sin(w)*Math.sin(j)/Math.cos(b))),B=Math.sin(b),o=Math.atan2((B-this.es*$*this.sin_p12)*Math.tan(b),B*(1-this.es)),t.x=n,t.y=o,t))}var wu=["Azimuthal_Equidistant","aeqd"];const Eu={init:bu,forward:Pu,inverse:_u,names:wu};function Au(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function Su(t){var e,a,i,s,n,o,r,h,c=t.x,d=t.y;return i=k(c-this.long0),e=Math.sin(d),a=Math.cos(d),s=Math.cos(i),o=this.sin_p14*e+this.cos_p14*a*s,n=1,(o>0||Math.abs(o)<=R)&&(r=this.a*n*a*Math.sin(i),h=this.y0+this.a*n*(this.cos_p14*e-this.sin_p14*a*s)),t.x=r,t.y=h,t}function Nu(t){var e,a,i,s,n,o,r;return t.x-=this.x0,t.y-=this.y0,e=Math.sqrt(t.x*t.x+t.y*t.y),a=De(e/this.a),i=Math.sin(a),s=Math.cos(a),o=this.long0,Math.abs(e)<=R?(r=this.lat0,t.x=o,t.y=r,t):(r=De(s*this.sin_p14+t.y*i*this.cos_p14/e),n=Math.abs(this.lat0)-T,Math.abs(n)<=R?(this.lat0>=0?o=k(this.long0+Math.atan2(t.x,-t.y)):o=k(this.long0-Math.atan2(-t.x,t.y)),t.x=o,t.y=r,t):(o=k(this.long0+Math.atan2(t.x*i,e*this.cos_p14*s-t.y*this.sin_p14*i)),t.x=o,t.y=r,t))}var Cu=["ortho"];const Tu={init:Au,forward:Su,inverse:Nu,names:Cu};var ft={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},st={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Iu(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=T-it/2?this.face=ft.TOP:this.lat0<=-(T-it/2)?this.face=ft.BOTTOM:Math.abs(this.long0)<=it?this.face=ft.FRONT:Math.abs(this.long0)<=T+it?this.face=this.long0>0?ft.RIGHT:ft.LEFT:this.face=ft.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function Ou(t){var e={x:0,y:0},a,i,s,n,o,r,h={value:0};if(t.x-=this.long0,this.es!==0?a=Math.atan(this.one_minus_f_squared*Math.tan(t.y)):a=t.y,i=t.x,this.face===ft.TOP)n=T-a,i>=it&&i<=T+it?(h.value=st.AREA_0,s=i-T):i>T+it||i<=-(T+it)?(h.value=st.AREA_1,s=i>0?i-vt:i+vt):i>-(T+it)&&i<=-it?(h.value=st.AREA_2,s=i+T):(h.value=st.AREA_3,s=i);else if(this.face===ft.BOTTOM)n=T+a,i>=it&&i<=T+it?(h.value=st.AREA_0,s=-i+T):i<it&&i>=-it?(h.value=st.AREA_1,s=-i):i<-it&&i>=-(T+it)?(h.value=st.AREA_2,s=-i-T):(h.value=st.AREA_3,s=i>0?-i+vt:-i-vt);else{var c,d,u,m,v,p,b;this.face===ft.RIGHT?i=la(i,+T):this.face===ft.BACK?i=la(i,+vt):this.face===ft.LEFT&&(i=la(i,-T)),m=Math.sin(a),v=Math.cos(a),p=Math.sin(i),b=Math.cos(i),c=v*b,d=v*p,u=m,this.face===ft.FRONT?(n=Math.acos(c),s=hi(n,u,d,h)):this.face===ft.RIGHT?(n=Math.acos(d),s=hi(n,u,-c,h)):this.face===ft.BACK?(n=Math.acos(-c),s=hi(n,u,-d,h)):this.face===ft.LEFT?(n=Math.acos(-d),s=hi(n,u,c,h)):(n=s=0,h.value=st.AREA_0)}return r=Math.atan(12/vt*(s+Math.acos(Math.sin(s)*Math.cos(it))-T)),o=Math.sqrt((1-Math.cos(n))/(Math.cos(r)*Math.cos(r))/(1-Math.cos(Math.atan(1/Math.cos(s))))),h.value===st.AREA_1?r+=T:h.value===st.AREA_2?r+=vt:h.value===st.AREA_3&&(r+=1.5*vt),e.x=o*Math.cos(r),e.y=o*Math.sin(r),e.x=e.x*this.a+this.x0,e.y=e.y*this.a+this.y0,t.x=e.x,t.y=e.y,t}function Ru(t){var e={lam:0,phi:0},a,i,s,n,o,r,h,c,d,u={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,i=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),a=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?u.value=st.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(u.value=st.AREA_1,a-=T):t.x<0&&-t.x>=Math.abs(t.y)?(u.value=st.AREA_2,a=a<0?a+vt:a-vt):(u.value=st.AREA_3,a+=T),d=vt/12*Math.tan(a),o=Math.sin(d)/(Math.cos(d)-1/Math.sqrt(2)),r=Math.atan(o),s=Math.cos(a),n=Math.tan(i),h=1-s*s*n*n*(1-Math.cos(Math.atan(1/Math.cos(r)))),h<-1?h=-1:h>1&&(h=1),this.face===ft.TOP)c=Math.acos(h),e.phi=T-c,u.value===st.AREA_0?e.lam=r+T:u.value===st.AREA_1?e.lam=r<0?r+vt:r-vt:u.value===st.AREA_2?e.lam=r-T:e.lam=r;else if(this.face===ft.BOTTOM)c=Math.acos(h),e.phi=c-T,u.value===st.AREA_0?e.lam=-r+T:u.value===st.AREA_1?e.lam=-r:u.value===st.AREA_2?e.lam=-r-T:e.lam=r<0?-r-vt:-r+vt;else{var m,v,p;m=h,d=m*m,d>=1?p=0:p=Math.sqrt(1-d)*Math.sin(r),d+=p*p,d>=1?v=0:v=Math.sqrt(1-d),u.value===st.AREA_1?(d=v,v=-p,p=d):u.value===st.AREA_2?(v=-v,p=-p):u.value===st.AREA_3&&(d=v,v=p,p=-d),this.face===ft.RIGHT?(d=m,m=-v,v=d):this.face===ft.BACK?(m=-m,v=-v):this.face===ft.LEFT&&(d=m,m=v,v=-d),e.phi=Math.acos(-p)-T,e.lam=Math.atan2(v,m),this.face===ft.RIGHT?e.lam=la(e.lam,-T):this.face===ft.BACK?e.lam=la(e.lam,-vt):this.face===ft.LEFT&&(e.lam=la(e.lam,+T))}if(this.es!==0){var b,w,A;b=e.phi<0?1:0,w=Math.tan(e.phi),A=this.b/Math.sqrt(w*w+this.one_minus_f_squared),e.phi=Math.atan(Math.sqrt(this.a*this.a-A*A)/(this.one_minus_f*A)),b&&(e.phi=-e.phi)}return e.lam+=this.long0,t.x=e.lam,t.y=e.phi,t}function hi(t,e,a,i){var s;return t<R?(i.value=st.AREA_0,s=0):(s=Math.atan2(e,a),Math.abs(s)<=it?i.value=st.AREA_0:s>it&&s<=T+it?(i.value=st.AREA_1,s-=T):s>T+it||s<=-(T+it)?(i.value=st.AREA_2,s=s>=0?s-vt:s+vt):(i.value=st.AREA_3,s+=T)),s}function la(t,e){var a=t+e;return a<-vt?a+=La:a>+vt&&(a-=La),a}var Lu=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const ku={init:Iu,forward:Ou,inverse:Ru,names:Lu};var is=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Aa=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],or=.8487,hr=1.3523,lr=ce/5,Du=1/lr,na=18,bi=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))},Fu=function(t,e){return t[1]+e*(2*t[2]+e*3*t[3])};function ju(t,e,a,i){for(var s=e;i;--i){var n=t(s);if(s-=n,Math.abs(n)<a)break}return s}function zu(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function qu(t){var e=k(t.x-this.long0),a=Math.abs(t.y),i=Math.floor(a*lr);i<0?i=0:i>=na&&(i=na-1),a=ce*(a-Du*i);var s={x:bi(is[i],a)*e,y:bi(Aa[i],a)};return t.y<0&&(s.y=-s.y),s.x=s.x*this.a*or+this.x0,s.y=s.y*this.a*hr+this.y0,s}function Gu(t){var e={x:(t.x-this.x0)/(this.a*or),y:Math.abs(t.y-this.y0)/(this.a*hr)};if(e.y>=1)e.x/=is[na][0],e.y=t.y<0?-T:T;else{var a=Math.floor(e.y*na);for(a<0?a=0:a>=na&&(a=na-1);;)if(Aa[a][0]>e.y)--a;else if(Aa[a+1][0]<=e.y)++a;else break;var i=Aa[a],s=5*(e.y-i[0])/(Aa[a+1][0]-i[0]);s=ju(function(n){return(bi(i,n)-e.y)/Fu(i,n)},s,R,100),e.x/=bi(is[a],s),e.y=(5*a+s)*At,t.y<0&&(e.y=-e.y)}return e.x=k(e.x+this.long0),e}var $u=["Robinson","robin"];const Bu={init:zu,forward:qu,inverse:Gu,names:$u};function Uu(){this.name="geocent"}function Hu(t){var e=Vn(t,this.es,this.a);return e}function Wu(t){var e=Qn(t,this.es,this.a,this.b);return e}var Zu=["Geocentric","geocentric","geocent","Geocent"];const Vu={init:Uu,forward:Hu,inverse:Wu,names:Zu};var It={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Pa={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function Qu(){if(Object.keys(Pa).forEach((function(a){if(typeof this[a]>"u")this[a]=Pa[a].def;else{if(Pa[a].num&&isNaN(this[a]))throw new Error("Invalid parameter value, must be numeric "+a+" = "+this[a]);Pa[a].num&&(this[a]=parseFloat(this[a]))}Pa[a].degrees&&(this[a]=this[a]*At)}).bind(this)),Math.abs(Math.abs(this.lat0)-T)<R?this.mode=this.lat0<0?It.S_POLE:It.N_POLE:Math.abs(this.lat0)<R?this.mode=It.EQUIT:(this.mode=It.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)}function Ku(t){t.x-=this.long0;var e=Math.sin(t.y),a=Math.cos(t.y),i=Math.cos(t.x),s,n;switch(this.mode){case It.OBLIQ:n=this.sinph0*e+this.cosph0*a*i;break;case It.EQUIT:n=a*i;break;case It.S_POLE:n=-e;break;case It.N_POLE:n=e;break}switch(n=this.pn1/(this.p-n),s=n*a*Math.sin(t.x),this.mode){case It.OBLIQ:n*=this.cosph0*e-this.sinph0*a*i;break;case It.EQUIT:n*=e;break;case It.N_POLE:n*=-(a*i);break;case It.S_POLE:n*=a*i;break}var o,r;return o=n*this.cg+s*this.sg,r=1/(o*this.sw*this.h1+this.cw),s=(s*this.cg-n*this.sg)*this.cw*r,n=o*r,t.x=s*this.a,t.y=n*this.a,t}function Xu(t){t.x/=this.a,t.y/=this.a;var e={x:t.x,y:t.y},a,i,s;s=1/(this.pn1-t.y*this.sw),a=this.pn1*t.x*s,i=this.pn1*t.y*this.cw*s,t.x=a*this.cg+i*this.sg,t.y=i*this.cg-a*this.sg;var n=Vt(t.x,t.y);if(Math.abs(n)<R)e.x=0,e.y=t.y;else{var o,r;switch(r=1-n*n*this.pfact,r=(this.p-Math.sqrt(r))/(this.pn1/n+n/this.pn1),o=Math.sqrt(1-r*r),this.mode){case It.OBLIQ:e.y=Math.asin(o*this.sinph0+t.y*r*this.cosph0/n),t.y=(o-this.sinph0*Math.sin(e.y))*n,t.x*=r*this.cosph0;break;case It.EQUIT:e.y=Math.asin(t.y*r/n),t.y=o*n,t.x*=r;break;case It.N_POLE:e.y=Math.asin(o),t.y=-t.y;break;case It.S_POLE:e.y=-Math.asin(o);break}e.x=Math.atan2(t.x,t.y)}return t.x=e.x+this.long0,t.y=e.y,t}var Yu=["Tilted_Perspective","tpers"];const Ju={init:Qu,forward:Ku,inverse:Xu,names:Yu};function tf(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var t=1-this.es,e=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function ef(t){var e=t.x,a=t.y,i,s,n,o;if(e=e-this.long0,this.shape==="ellipse"){a=Math.atan(this.radius_p2*Math.tan(a));var r=this.radius_p/Vt(this.radius_p*Math.cos(a),Math.sin(a));if(s=r*Math.cos(e)*Math.cos(a),n=r*Math.sin(e)*Math.cos(a),o=r*Math.sin(a),(this.radius_g-s)*s-n*n-o*o*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=this.radius_g-s,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/Vt(o,i)),t.y=this.radius_g_1*Math.atan(o/i)):(t.x=this.radius_g_1*Math.atan(n/i),t.y=this.radius_g_1*Math.atan(o/Vt(n,i)))}else this.shape==="sphere"&&(i=Math.cos(a),s=Math.cos(e)*i,n=Math.sin(e)*i,o=Math.sin(a),i=this.radius_g-s,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/Vt(o,i)),t.y=this.radius_g_1*Math.atan(o/i)):(t.x=this.radius_g_1*Math.atan(n/i),t.y=this.radius_g_1*Math.atan(o/Vt(n,i))));return t.x=t.x*this.a,t.y=t.y*this.a,t}function af(t){var e=-1,a=0,i=0,s,n,o,r;if(t.x=t.x/this.a,t.y=t.y/this.a,this.shape==="ellipse"){this.flip_axis?(i=Math.tan(t.y/this.radius_g_1),a=Math.tan(t.x/this.radius_g_1)*Vt(1,i)):(a=Math.tan(t.x/this.radius_g_1),i=Math.tan(t.y/this.radius_g_1)*Vt(1,a));var h=i/this.radius_p;if(s=a*a+h*h+e*e,n=2*this.radius_g*e,o=n*n-4*s*this.C,o<0)return t.x=Number.NaN,t.y=Number.NaN,t;r=(-n-Math.sqrt(o))/(2*s),e=this.radius_g+r*e,a*=r,i*=r,t.x=Math.atan2(a,e),t.y=Math.atan(i*Math.cos(t.x)/e),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if(this.shape==="sphere"){if(this.flip_axis?(i=Math.tan(t.y/this.radius_g_1),a=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+i*i)):(a=Math.tan(t.x/this.radius_g_1),i=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+a*a)),s=a*a+i*i+e*e,n=2*this.radius_g*e,o=n*n-4*s*this.C,o<0)return t.x=Number.NaN,t.y=Number.NaN,t;r=(-n-Math.sqrt(o))/(2*s),e=this.radius_g+r*e,a*=r,i*=r,t.x=Math.atan2(a,e),t.y=Math.atan(i*Math.cos(t.x)/e)}return t.x=t.x+this.long0,t}var sf=["Geostationary Satellite View","Geostationary_Satellite","geos"];const nf={init:tf,forward:ef,inverse:af,names:sf};var Ca=1.340264,Ta=-.081106,Ia=893e-6,Oa=.003796,Pi=Math.sqrt(3)/2;function rf(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function of(t){var e=k(t.x-this.long0),a=t.y,i=Math.asin(Pi*Math.sin(a)),s=i*i,n=s*s*s;return t.x=e*Math.cos(i)/(Pi*(Ca+3*Ta*s+n*(7*Ia+9*Oa*s))),t.y=i*(Ca+Ta*s+n*(Ia+Oa*s)),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function hf(t){t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a;var e=1e-9,a=12,i=t.y,s,n,o,r,h,c;for(c=0;c<a&&(s=i*i,n=s*s*s,o=i*(Ca+Ta*s+n*(Ia+Oa*s))-t.y,r=Ca+3*Ta*s+n*(7*Ia+9*Oa*s),i-=h=o/r,!(Math.abs(h)<e));++c);return s=i*i,n=s*s*s,t.x=Pi*t.x*(Ca+3*Ta*s+n*(7*Ia+9*Oa*s))/Math.cos(i),t.y=Math.asin(Math.sin(i)/Pi),t.x=k(t.x+this.long0),t}var lf=["eqearth","Equal Earth","Equal_Earth"];const cf={init:rf,forward:of,inverse:hf,names:lf};function uf(t){t.Proj.projections.add(di),t.Proj.projections.add(Mi),t.Proj.projections.add(uc),t.Proj.projections.add(bc),t.Proj.projections.add(Sc),t.Proj.projections.add(Oc),t.Proj.projections.add(jc),t.Proj.projections.add(Bc),t.Proj.projections.add(Vc),t.Proj.projections.add(Jc),t.Proj.projections.add(y0),t.Proj.projections.add(P0),t.Proj.projections.add(S0),t.Proj.projections.add(R0),t.Proj.projections.add(j0),t.Proj.projections.add(B0),t.Proj.projections.add(V0),t.Proj.projections.add(J0),t.Proj.projections.add(nu),t.Proj.projections.add(cu),t.Proj.projections.add(Mu),t.Proj.projections.add(xu),t.Proj.projections.add(Eu),t.Proj.projections.add(Tu),t.Proj.projections.add(ku),t.Proj.projections.add(Bu),t.Proj.projections.add(Vu),t.Proj.projections.add(Ju),t.Proj.projections.add(nf),t.Proj.projections.add(cf)}St.defaultDatum="WGS84";St.Proj=ue;St.WGS84=new St.Proj("WGS84");St.Point=ca;St.toPoint=Kn;St.defs=Lt;St.nadgrid=ml;St.transform=pi;St.mgrs=Cl;St.version="__VERSION__";uf(St);const _e=11102230246251565e-32,Tt=134217729,ff=(3+8*_e)*_e;function Xi(t,e,a,i,s){let n,o,r,h,c=e[0],d=i[0],u=0,m=0;d>c==d>-c?(n=c,c=e[++u]):(n=d,d=i[++m]);let v=0;if(u<t&&m<a)for(d>c==d>-c?(o=c+n,r=n-(o-c),c=e[++u]):(o=d+n,r=n-(o-d),d=i[++m]),n=o,r!==0&&(s[v++]=r);u<t&&m<a;)d>c==d>-c?(o=n+c,h=o-n,r=n-(o-h)+(c-h),c=e[++u]):(o=n+d,h=o-n,r=n-(o-h)+(d-h),d=i[++m]),n=o,r!==0&&(s[v++]=r);for(;u<t;)o=n+c,h=o-n,r=n-(o-h)+(c-h),c=e[++u],n=o,r!==0&&(s[v++]=r);for(;m<a;)o=n+d,h=o-n,r=n-(o-h)+(d-h),d=i[++m],n=o,r!==0&&(s[v++]=r);return(n!==0||v===0)&&(s[v++]=n),v}function mf(t,e){let a=e[0];for(let i=1;i<t;i++)a+=e[i];return a}function Ha(t){return new Float64Array(t)}const df=(3+16*_e)*_e,Mf=(2+12*_e)*_e,yf=(9+64*_e)*_e*_e,ta=Ha(4),Sn=Ha(8),Nn=Ha(12),Cn=Ha(16),Rt=Ha(4);function vf(t,e,a,i,s,n,o){let r,h,c,d,u,m,v,p,b,w,A,C,S,I,F,j,$,B;const O=t-s,H=a-s,G=e-n,z=i-n;I=O*z,m=Tt*O,v=m-(m-O),p=O-v,m=Tt*z,b=m-(m-z),w=z-b,F=p*w-(I-v*b-p*b-v*w),j=G*H,m=Tt*G,v=m-(m-G),p=G-v,m=Tt*H,b=m-(m-H),w=H-b,$=p*w-(j-v*b-p*b-v*w),A=F-$,u=F-A,ta[0]=F-(A+u)+(u-$),C=I+A,u=C-I,S=I-(C-u)+(A-u),A=S-j,u=S-A,ta[1]=S-(A+u)+(u-j),B=C+A,u=B-C,ta[2]=C-(B-u)+(A-u),ta[3]=B;let nt=mf(4,ta),yt=Mf*o;if(nt>=yt||-nt>=yt||(u=t-O,r=t-(O+u)+(u-s),u=a-H,c=a-(H+u)+(u-s),u=e-G,h=e-(G+u)+(u-n),u=i-z,d=i-(z+u)+(u-n),r===0&&h===0&&c===0&&d===0)||(yt=yf*o+ff*Math.abs(nt),nt+=O*d+z*r-(G*c+H*h),nt>=yt||-nt>=yt))return nt;I=r*z,m=Tt*r,v=m-(m-r),p=r-v,m=Tt*z,b=m-(m-z),w=z-b,F=p*w-(I-v*b-p*b-v*w),j=h*H,m=Tt*h,v=m-(m-h),p=h-v,m=Tt*H,b=m-(m-H),w=H-b,$=p*w-(j-v*b-p*b-v*w),A=F-$,u=F-A,Rt[0]=F-(A+u)+(u-$),C=I+A,u=C-I,S=I-(C-u)+(A-u),A=S-j,u=S-A,Rt[1]=S-(A+u)+(u-j),B=C+A,u=B-C,Rt[2]=C-(B-u)+(A-u),Rt[3]=B;const Ct=Xi(4,ta,4,Rt,Sn);I=O*d,m=Tt*O,v=m-(m-O),p=O-v,m=Tt*d,b=m-(m-d),w=d-b,F=p*w-(I-v*b-p*b-v*w),j=G*c,m=Tt*G,v=m-(m-G),p=G-v,m=Tt*c,b=m-(m-c),w=c-b,$=p*w-(j-v*b-p*b-v*w),A=F-$,u=F-A,Rt[0]=F-(A+u)+(u-$),C=I+A,u=C-I,S=I-(C-u)+(A-u),A=S-j,u=S-A,Rt[1]=S-(A+u)+(u-j),B=C+A,u=B-C,Rt[2]=C-(B-u)+(A-u),Rt[3]=B;const X=Xi(Ct,Sn,4,Rt,Nn);I=r*d,m=Tt*r,v=m-(m-r),p=r-v,m=Tt*d,b=m-(m-d),w=d-b,F=p*w-(I-v*b-p*b-v*w),j=h*c,m=Tt*h,v=m-(m-h),p=h-v,m=Tt*c,b=m-(m-c),w=c-b,$=p*w-(j-v*b-p*b-v*w),A=F-$,u=F-A,Rt[0]=F-(A+u)+(u-$),C=I+A,u=C-I,S=I-(C-u)+(A-u),A=S-j,u=S-A,Rt[1]=S-(A+u)+(u-j),B=C+A,u=B-C,Rt[2]=C-(B-u)+(A-u),Rt[3]=B;const J=Xi(X,Nn,4,Rt,Cn);return Cn[J-1]}function li(t,e,a,i,s,n){const o=(e-n)*(a-s),r=(t-s)*(i-n),h=o-r,c=Math.abs(o+r);return Math.abs(h)>=df*c?h:-vf(t,e,a,i,s,n,c)}const Tn=Math.pow(2,-52),ci=new Uint32Array(512);class _i{static from(e,a=Pf,i=_f){const s=e.length,n=new Float64Array(s*2);for(let o=0;o<s;o++){const r=e[o];n[2*o]=a(r),n[2*o+1]=i(r)}return new _i(n)}constructor(e){const a=e.length>>1;if(a>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const i=Math.max(2*a-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(a)),this._hullPrev=new Uint32Array(a),this._hullNext=new Uint32Array(a),this._hullTri=new Uint32Array(a),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(a),this._dists=new Float64Array(a),this.update()}update(){const{coords:e,_hullPrev:a,_hullNext:i,_hullTri:s,_hullHash:n}=this,o=e.length>>1;let r=1/0,h=1/0,c=-1/0,d=-1/0;for(let O=0;O<o;O++){const H=e[2*O],G=e[2*O+1];H<r&&(r=H),G<h&&(h=G),H>c&&(c=H),G>d&&(d=G),this._ids[O]=O}const u=(r+c)/2,m=(h+d)/2;let v,p,b;for(let O=0,H=1/0;O<o;O++){const G=Yi(u,m,e[2*O],e[2*O+1]);G<H&&(v=O,H=G)}const w=e[2*v],A=e[2*v+1];for(let O=0,H=1/0;O<o;O++){if(O===v)continue;const G=Yi(w,A,e[2*O],e[2*O+1]);G<H&&G>0&&(p=O,H=G)}let C=e[2*p],S=e[2*p+1],I=1/0;for(let O=0;O<o;O++){if(O===v||O===p)continue;const H=xf(w,A,C,S,e[2*O],e[2*O+1]);H<I&&(b=O,I=H)}let F=e[2*b],j=e[2*b+1];if(I===1/0){for(let G=0;G<o;G++)this._dists[G]=e[2*G]-e[0]||e[2*G+1]-e[1];ra(this._ids,this._dists,0,o-1);const O=new Uint32Array(o);let H=0;for(let G=0,z=-1/0;G<o;G++){const nt=this._ids[G],yt=this._dists[nt];yt>z&&(O[H++]=nt,z=yt)}this.hull=O.subarray(0,H),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(li(w,A,C,S,F,j)<0){const O=p,H=C,G=S;p=b,C=F,S=j,b=O,F=H,j=G}const $=bf(w,A,C,S,F,j);this._cx=$.x,this._cy=$.y;for(let O=0;O<o;O++)this._dists[O]=Yi(e[2*O],e[2*O+1],$.x,$.y);ra(this._ids,this._dists,0,o-1),this._hullStart=v;let B=3;i[v]=a[b]=p,i[p]=a[v]=b,i[b]=a[p]=v,s[v]=0,s[p]=1,s[b]=2,n.fill(-1),n[this._hashKey(w,A)]=v,n[this._hashKey(C,S)]=p,n[this._hashKey(F,j)]=b,this.trianglesLen=0,this._addTriangle(v,p,b,-1,-1,-1);for(let O=0,H,G;O<this._ids.length;O++){const z=this._ids[O],nt=e[2*z],yt=e[2*z+1];if(O>0&&Math.abs(nt-H)<=Tn&&Math.abs(yt-G)<=Tn||(H=nt,G=yt,z===v||z===p||z===b))continue;let Ct=0;for(let de=0,Xe=this._hashKey(nt,yt);de<this._hashSize&&(Ct=n[(Xe+de)%this._hashSize],!(Ct!==-1&&Ct!==i[Ct]));de++);Ct=a[Ct];let X=Ct,J;for(;J=i[X],li(nt,yt,e[2*X],e[2*X+1],e[2*J],e[2*J+1])>=0;)if(X=J,X===Ct){X=-1;break}if(X===-1)continue;let Ut=this._addTriangle(X,z,i[X],-1,-1,s[X]);s[z]=this._legalize(Ut+2),s[X]=Ut,B++;let xt=i[X];for(;J=i[xt],li(nt,yt,e[2*xt],e[2*xt+1],e[2*J],e[2*J+1])<0;)Ut=this._addTriangle(xt,z,J,s[z],-1,s[xt]),s[z]=this._legalize(Ut+2),i[xt]=xt,B--,xt=J;if(X===Ct)for(;J=a[X],li(nt,yt,e[2*J],e[2*J+1],e[2*X],e[2*X+1])<0;)Ut=this._addTriangle(J,z,X,-1,s[X],s[J]),this._legalize(Ut+2),s[J]=Ut,i[X]=X,B--,X=J;this._hullStart=a[z]=X,i[X]=a[xt]=z,i[z]=xt,n[this._hashKey(nt,yt)]=z,n[this._hashKey(e[2*X],e[2*X+1])]=X}this.hull=new Uint32Array(B);for(let O=0,H=this._hullStart;O<B;O++)this.hull[O]=H,H=i[H];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,a){return Math.floor(gf(e-this._cx,a-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:a,_halfedges:i,coords:s}=this;let n=0,o=0;for(;;){const r=i[e],h=e-e%3;if(o=h+(e+2)%3,r===-1){if(n===0)break;e=ci[--n];continue}const c=r-r%3,d=h+(e+1)%3,u=c+(r+2)%3,m=a[o],v=a[e],p=a[d],b=a[u];if(pf(s[2*m],s[2*m+1],s[2*v],s[2*v+1],s[2*p],s[2*p+1],s[2*b],s[2*b+1])){a[e]=b,a[r]=m;const A=i[u];if(A===-1){let S=this._hullStart;do{if(this._hullTri[S]===u){this._hullTri[S]=e;break}S=this._hullPrev[S]}while(S!==this._hullStart)}this._link(e,A),this._link(r,i[o]),this._link(o,u);const C=c+(r+1)%3;n<ci.length&&(ci[n++]=C)}else{if(n===0)break;e=ci[--n]}}return o}_link(e,a){this._halfedges[e]=a,a!==-1&&(this._halfedges[a]=e)}_addTriangle(e,a,i,s,n,o){const r=this.trianglesLen;return this._triangles[r]=e,this._triangles[r+1]=a,this._triangles[r+2]=i,this._link(r,s),this._link(r+1,n),this._link(r+2,o),this.trianglesLen+=3,r}}function gf(t,e){const a=t/(Math.abs(t)+Math.abs(e));return(e>0?3-a:1+a)/4}function Yi(t,e,a,i){const s=t-a,n=e-i;return s*s+n*n}function pf(t,e,a,i,s,n,o,r){const h=t-o,c=e-r,d=a-o,u=i-r,m=s-o,v=n-r,p=h*h+c*c,b=d*d+u*u,w=m*m+v*v;return h*(u*w-b*v)-c*(d*w-b*m)+p*(d*v-u*m)<0}function xf(t,e,a,i,s,n){const o=a-t,r=i-e,h=s-t,c=n-e,d=o*o+r*r,u=h*h+c*c,m=.5/(o*c-r*h),v=(c*d-r*u)*m,p=(o*u-h*d)*m;return v*v+p*p}function bf(t,e,a,i,s,n){const o=a-t,r=i-e,h=s-t,c=n-e,d=o*o+r*r,u=h*h+c*c,m=.5/(o*c-r*h),v=t+(c*d-r*u)*m,p=e+(o*u-h*d)*m;return{x:v,y:p}}function ra(t,e,a,i){if(i-a<=20)for(let s=a+1;s<=i;s++){const n=t[s],o=e[n];let r=s-1;for(;r>=a&&e[t[r]]>o;)t[r+1]=t[r--];t[r+1]=n}else{const s=a+i>>1;let n=a+1,o=i;_a(t,s,n),e[t[a]]>e[t[i]]&&_a(t,a,i),e[t[n]]>e[t[i]]&&_a(t,n,i),e[t[a]]>e[t[n]]&&_a(t,a,n);const r=t[n],h=e[r];for(;;){do n++;while(e[t[n]]<h);do o--;while(e[t[o]]>h);if(o<n)break;_a(t,n,o)}t[a+1]=t[o],t[o]=r,i-n+1>=o-a?(ra(t,e,n,i),ra(t,e,a,o-1)):(ra(t,e,a,o-1),ra(t,e,n,i))}}function _a(t,e,a){const i=t[e];t[e]=t[a],t[a]=i}function Pf(t){return t[0]}function _f(t){return t[1]}const wf={triangulate:function(t,e,a=2){const i=e&&e.length,s=i?e[0]*a:t.length;let n=cr(t,0,s,a,!0);const o=[];if(!n||n.next===n.prev)return o;let r,h,c,d,u,m,v;if(i&&(n=Cf(t,e,n,a)),t.length>80*a){r=c=t[0],h=d=t[1];for(let p=a;p<s;p+=a)u=t[p],m=t[p+1],u<r&&(r=u),m<h&&(h=m),u>c&&(c=u),m>d&&(d=m);v=Math.max(c-r,d-h),v=v!==0?32767/v:0}return Fa(n,o,a,r,h,v,0),o}};function cr(t,e,a,i,s){let n,o;if(s===qf(t,e,a,i)>0)for(n=e;n<a;n+=i)o=In(n,t[n],t[n+1],o);else for(n=a-i;n>=e;n-=i)o=In(n,t[n],t[n+1],o);return o&&Ni(o,o.next)&&(za(o),o=o.next),o}function Qe(t,e){if(!t)return t;e||(e=t);let a=t,i;do if(i=!1,!a.steiner&&(Ni(a,a.next)||mt(a.prev,a,a.next)===0)){if(za(a),a=e=a.prev,a===a.next)break;i=!0}else a=a.next;while(i||a!==e);return e}function Fa(t,e,a,i,s,n,o){if(!t)return;!o&&n&&Lf(t,i,s,n);let r=t,h,c;for(;t.prev!==t.next;){if(h=t.prev,c=t.next,n?Af(t,i,s,n):Ef(t)){e.push(h.i/a|0),e.push(t.i/a|0),e.push(c.i/a|0),za(t),t=c.next,r=c.next;continue}if(t=c,t===r){o?o===1?(t=Sf(Qe(t),e,a),Fa(t,e,a,i,s,n,2)):o===2&&Nf(t,e,a,i,s,n):Fa(Qe(t),e,a,i,s,n,1);break}}}function Ef(t){const e=t.prev,a=t,i=t.next;if(mt(e,a,i)>=0)return!1;const s=e.x,n=a.x,o=i.x,r=e.y,h=a.y,c=i.y,d=s<n?s<o?s:o:n<o?n:o,u=r<h?r<c?r:c:h<c?h:c,m=s>n?s>o?s:o:n>o?n:o,v=r>h?r>c?r:c:h>c?h:c;let p=i.next;for(;p!==e;){if(p.x>=d&&p.x<=m&&p.y>=u&&p.y<=v&&oa(s,r,n,h,o,c,p.x,p.y)&&mt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Af(t,e,a,i){const s=t.prev,n=t,o=t.next;if(mt(s,n,o)>=0)return!1;const r=s.x,h=n.x,c=o.x,d=s.y,u=n.y,m=o.y,v=r<h?r<c?r:c:h<c?h:c,p=d<u?d<m?d:m:u<m?u:m,b=r>h?r>c?r:c:h>c?h:c,w=d>u?d>m?d:m:u>m?u:m,A=ss(v,p,e,a,i),C=ss(b,w,e,a,i);let S=t.prevZ,I=t.nextZ;for(;S&&S.z>=A&&I&&I.z<=C;){if(S.x>=v&&S.x<=b&&S.y>=p&&S.y<=w&&S!==s&&S!==o&&oa(r,d,h,u,c,m,S.x,S.y)&&mt(S.prev,S,S.next)>=0||(S=S.prevZ,I.x>=v&&I.x<=b&&I.y>=p&&I.y<=w&&I!==s&&I!==o&&oa(r,d,h,u,c,m,I.x,I.y)&&mt(I.prev,I,I.next)>=0))return!1;I=I.nextZ}for(;S&&S.z>=A;){if(S.x>=v&&S.x<=b&&S.y>=p&&S.y<=w&&S!==s&&S!==o&&oa(r,d,h,u,c,m,S.x,S.y)&&mt(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;I&&I.z<=C;){if(I.x>=v&&I.x<=b&&I.y>=p&&I.y<=w&&I!==s&&I!==o&&oa(r,d,h,u,c,m,I.x,I.y)&&mt(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function Sf(t,e,a){let i=t;do{const s=i.prev,n=i.next.next;!Ni(s,n)&&ur(s,i,i.next,n)&&ja(s,n)&&ja(n,s)&&(e.push(s.i/a|0),e.push(i.i/a|0),e.push(n.i/a|0),za(i),za(i.next),i=t=n),i=i.next}while(i!==t);return Qe(i)}function Nf(t,e,a,i,s,n){let o=t;do{let r=o.next.next;for(;r!==o.prev;){if(o.i!==r.i&&Ff(o,r)){let h=fr(o,r);o=Qe(o,o.next),h=Qe(h,h.next),Fa(o,e,a,i,s,n,0),Fa(h,e,a,i,s,n,0);return}r=r.next}o=o.next}while(o!==t)}function Cf(t,e,a,i){const s=[];let n,o,r,h,c;for(n=0,o=e.length;n<o;n++)r=e[n]*i,h=n<o-1?e[n+1]*i:t.length,c=cr(t,r,h,i,!1),c===c.next&&(c.steiner=!0),s.push(Df(c));for(s.sort(Tf),n=0;n<s.length;n++)a=If(s[n],a);return a}function Tf(t,e){return t.x-e.x}function If(t,e){const a=Of(t,e);if(!a)return e;const i=fr(a,t);return Qe(i,i.next),Qe(a,a.next)}function Of(t,e){let a=e,i=-1/0,s;const n=t.x,o=t.y;do{if(o<=a.y&&o>=a.next.y&&a.next.y!==a.y){const m=a.x+(o-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(m<=n&&m>i&&(i=m,s=a.x<a.next.x?a:a.next,m===n))return s}a=a.next}while(a!==e);if(!s)return null;const r=s,h=s.x,c=s.y;let d=1/0,u;a=s;do n>=a.x&&a.x>=h&&n!==a.x&&oa(o<c?n:i,o,h,c,o<c?i:n,o,a.x,a.y)&&(u=Math.abs(o-a.y)/(n-a.x),ja(a,t)&&(u<d||u===d&&(a.x>s.x||a.x===s.x&&Rf(s,a)))&&(s=a,d=u)),a=a.next;while(a!==r);return s}function Rf(t,e){return mt(t.prev,t,e.prev)<0&&mt(e.next,t,t.next)<0}function Lf(t,e,a,i){let s=t;do s.z===0&&(s.z=ss(s.x,s.y,e,a,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,kf(s)}function kf(t){let e,a,i,s,n,o,r,h,c=1;do{for(a=t,t=null,n=null,o=0;a;){for(o++,i=a,r=0,e=0;e<c&&(r++,i=i.nextZ,!!i);e++);for(h=c;r>0||h>0&&i;)r!==0&&(h===0||!i||a.z<=i.z)?(s=a,a=a.nextZ,r--):(s=i,i=i.nextZ,h--),n?n.nextZ=s:t=s,s.prevZ=n,n=s;a=i}n.nextZ=null,c*=2}while(o>1);return t}function ss(t,e,a,i,s){return t=(t-a)*s|0,e=(e-i)*s|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Df(t){let e=t,a=t;do(e.x<a.x||e.x===a.x&&e.y<a.y)&&(a=e),e=e.next;while(e!==t);return a}function oa(t,e,a,i,s,n,o,r){return(s-o)*(e-r)>=(t-o)*(n-r)&&(t-o)*(i-r)>=(a-o)*(e-r)&&(a-o)*(n-r)>=(s-o)*(i-r)}function Ff(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!jf(t,e)&&(ja(t,e)&&ja(e,t)&&zf(t,e)&&(mt(t.prev,t,e.prev)||mt(t,e.prev,e))||Ni(t,e)&&mt(t.prev,t,t.next)>0&&mt(e.prev,e,e.next)>0)}function mt(t,e,a){return(e.y-t.y)*(a.x-e.x)-(e.x-t.x)*(a.y-e.y)}function Ni(t,e){return t.x===e.x&&t.y===e.y}function ur(t,e,a,i){const s=fi(mt(t,e,a)),n=fi(mt(t,e,i)),o=fi(mt(a,i,t)),r=fi(mt(a,i,e));return!!(s!==n&&o!==r||s===0&&ui(t,a,e)||n===0&&ui(t,i,e)||o===0&&ui(a,t,i)||r===0&&ui(a,e,i))}function ui(t,e,a){return e.x<=Math.max(t.x,a.x)&&e.x>=Math.min(t.x,a.x)&&e.y<=Math.max(t.y,a.y)&&e.y>=Math.min(t.y,a.y)}function fi(t){return t>0?1:t<0?-1:0}function jf(t,e){let a=t;do{if(a.i!==t.i&&a.next.i!==t.i&&a.i!==e.i&&a.next.i!==e.i&&ur(a,a.next,t,e))return!0;a=a.next}while(a!==t);return!1}function ja(t,e){return mt(t.prev,t,t.next)<0?mt(t,e,t.next)>=0&&mt(t,t.prev,e)>=0:mt(t,e,t.prev)<0||mt(t,t.next,e)<0}function zf(t,e){let a=t,i=!1;const s=(t.x+e.x)/2,n=(t.y+e.y)/2;do a.y>n!=a.next.y>n&&a.next.y!==a.y&&s<(a.next.x-a.x)*(n-a.y)/(a.next.y-a.y)+a.x&&(i=!i),a=a.next;while(a!==t);return i}function fr(t,e){const a=new ns(t.i,t.x,t.y),i=new ns(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,a.next=s,s.prev=a,i.next=a,a.prev=i,n.next=i,i.prev=n,i}function In(t,e,a,i){const s=new ns(t,e,a);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function za(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ns(t,e,a){this.i=t,this.x=e,this.y=a,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qf(t,e,a,i){let s=0;for(let n=e,o=a-i;n<a;n+=i)s+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return s}function mr(t){return t!==null&&typeof t=="object"&&"name"in t&&typeof t.name=="string"}function dr(t){return t!==null&&typeof t=="object"&&"step"in t&&typeof t.step=="number"&&"alt"in t&&typeof t.alt=="number"&&!isNaN(t.step)&&!isNaN(t.alt)}var Mr=[0,2,4,-1,1,3,5],yr=Mr.map(t=>Math.floor(t*7/12));function vr(t){const{step:e,alt:a,oct:i,dir:s=1}=t,n=Mr[e]+7*a;if(i===void 0)return[s*n];const o=i-yr[e]-4*a;return[s*n,s*o]}var Gf=[3,0,4,1,5,2,6];function $f(t){const[e,a,i]=t,s=Gf[Bf(e)],n=Math.floor((e+1)/7);if(a===void 0)return{step:s,alt:n,dir:i};const o=a+4*n+yr[s];return{step:s,alt:n,oct:o,dir:i}}function Bf(t){const e=(t+1)%7;return e<0?7+e:e}var On=(t,e)=>Array(Math.abs(e)+1).join(t),rs=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),Uf="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",Hf="(AA|A|P|M|m|d|dd)([-+]?\\d+)",Wf=new RegExp("^"+Uf+"|"+Hf+"$");function Zf(t){const e=Wf.exec(`${t}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var Rn={};function wi(t){return typeof t=="string"?Rn[t]||(Rn[t]=Vf(t)):dr(t)?wi(Kf(t)):mr(t)?wi(t.name):rs}var Ln=[0,2,4,5,7,9,11],gr="PMMPPMM";function Vf(t){const e=Zf(t);if(e[0]==="")return rs;const a=+e[0],i=e[1],s=(Math.abs(a)-1)%7,n=gr[s];if(n==="M"&&i==="P")return rs;const o=n==="M"?"majorable":"perfectable",r=""+a+i,h=a<0?-1:1,c=a===8||a===-8?a:h*(s+1),d=Qf(o,i),u=Math.floor((Math.abs(a)-1)/7),m=h*(Ln[s]+d+12*u),v=(h*(Ln[s]+d)%12+12)%12,p=vr({step:s,alt:d,oct:u,dir:h});return{empty:!1,name:r,num:a,q:i,step:s,alt:d,dir:h,type:o,simple:c,semitones:m,chroma:v,coord:p,oct:u}}function Qf(t,e){return e==="M"&&t==="majorable"||e==="P"&&t==="perfectable"?0:e==="m"&&t==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(t==="perfectable"?e.length:e.length+1):0}function Kf(t){const{step:e,alt:a,oct:i=0,dir:s}=t;if(!s)return"";const n=e+1+7*i,o=n===0?e+1:n,r=s<0?"-":"",h=gr[e]==="M"?"majorable":"perfectable";return r+o+Xf(h,a)}function Xf(t,e){return e===0?t==="majorable"?"M":"P":e===-1&&t==="majorable"?"m":e>0?On("A",e):On("d",t==="perfectable"?e:e+1)}var kn=(t,e)=>Array(Math.abs(e)+1).join(t),pr=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),Dn=new Map,Yf=t=>"CDEFGAB".charAt(t),Jf=t=>t<0?kn("b",-t):kn("#",t),tm=t=>t[0]==="b"?-t.length:t.length;function Nt(t){const e=JSON.stringify(t),a=Dn.get(e);if(a)return a;const i=typeof t=="string"?nm(t):dr(t)?Nt(rm(t)):mr(t)?Nt(t.name):pr;return Dn.set(e,i),i}var em=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function am(t){const e=em.exec(t);return e?[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]:["","","",""]}function im(t){return Nt($f(t))}var sm=(t,e)=>(t%e+e)%e,Ji=[0,2,4,5,7,9,11];function nm(t){const e=am(t);if(e[0]===""||e[3]!=="")return pr;const a=e[0],i=e[1],s=e[2],n=(a.charCodeAt(0)+3)%7,o=tm(i),r=s.length?+s:void 0,h=vr({step:n,alt:o,oct:r}),c=a+i+s,d=a+i,u=(Ji[n]+o+120)%12,m=r===void 0?sm(Ji[n]+o,12)-12*99:Ji[n]+o+12*(r+1),v=m>=0&&m<=127?m:null,p=r===void 0?null:Math.pow(2,(m-69)/12)*440;return{empty:!1,acc:i,alt:o,chroma:u,coord:h,freq:p,height:m,letter:a,midi:v,name:c,oct:r,pc:d,step:n}}function rm(t){const{step:e,alt:a,oct:i}=t,s=Yf(e);if(!s)return"";const n=s+Jf(a);return i||i===0?n+i:n}function Ei(t,e){const a=Nt(t),i=Array.isArray(e)?e:wi(e).coord;if(a.empty||!i||i.length<2)return"";const s=a.coord,n=s.length===1?[s[0]+i[0]]:[s[0]+i[0],s[1]+i[1]];return im(n).name}function xr(t,e){const a=t.length;return i=>{if(!e)return"";const s=i<0?(a- -i%a)%a:i%a,n=Math.floor(i/a),o=Ei(e,[0,n]);return Ei(o,t[s])}}function om(t,e,a){return function(...i){return console.warn(`${t} is deprecated. Use ${e}.`),a.apply(this,i)}}function hm(t,e){const a=[];for(;e--;a[e]=e+t);return a}function lm(t,e){const a=[];for(;e--;a[e]=t-e);return a}function cm(t,e){return t<e?hm(t,e-t+1):lm(t,t-e+1)}function Wa(t,e){const a=e.length,i=(t%a+a)%a;return e.slice(i,a).concat(e.slice(0,i))}function um(t){return t.filter(e=>e===0||e)}var Ke={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},br=t=>Number(t).toString(2).padStart(12,"0"),Fn=t=>parseInt(t,2),fm=/^[01]{12}$/;function ms(t){return fm.test(t)}var mm=t=>typeof t=="number"&&t>=0&&t<=4095,dm=t=>t&&ms(t.chroma),jn={[Ke.chroma]:Ke};function Fe(t){const e=ms(t)?t:mm(t)?br(t):Array.isArray(t)?Pm(t):dm(t)?t.chroma:Ke.chroma;return jn[e]=jn[e]||bm(e)}var Mm=t=>Fe(t).chroma,ym=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function vm(t){const e=[];for(let a=0;a<12;a++)t.charAt(a)==="1"&&e.push(ym[a]);return e}function gm(t,e=!0){const i=Fe(t).chroma.split("");return um(i.map((s,n)=>{const o=Wa(n,i);return e&&o[0]==="0"?null:o.join("")}))}function Pr(t){const e=Fe(t).setNum;return a=>{const i=Fe(a).setNum;return e&&e!==i&&(i&e)===i}}function pm(t){const e=Fe(t).setNum;return a=>{const i=Fe(a).setNum;return e&&e!==i&&(i|e)===i}}function xm(t){const e=t.split("");return e.map((a,i)=>Wa(i,e).join(""))}function bm(t){const e=Fn(t),a=xm(t).map(Fn).filter(n=>n>=2048).sort()[0],i=br(a),s=vm(t);return{empty:!1,name:"",setNum:e,chroma:t,normalized:i,intervals:s}}function Pm(t){if(t.length===0)return Ke.chroma;let e;const a=[0,0,0,0,0,0,0,0,0,0,0,0];for(let i=0;i<t.length;i++)e=Nt(t[i]),e.empty&&(e=wi(t[i])),e.empty||(a[e.chroma]=1);return a.join("")}var _m=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7  ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 #4 #11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -7 m -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim  o"],["1P 3m 5d 7d","diminished seventh","dim7 7 o7"],["1P 3m 5d 7m","half-diminished","m7b5  -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],wm=_m;({...Ke});var ds=[],yi={};function Em(){return ds.slice()}function Am(t,e,a){const i=Nm(t),s={...Fe(t),name:a||"",quality:i,intervals:t,aliases:e};ds.push(s),s.name&&(yi[s.name]=s),yi[s.setNum]=s,yi[s.chroma]=s,s.aliases.forEach(n=>Sm(s,n))}function Sm(t,e){yi[e]=t}function Nm(t){const e=a=>t.indexOf(a)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}wm.forEach(([t,e,a])=>Am(t.split(" "),a.split(" "),e));ds.sort((t,e)=>t.setNum-e.setNum);var Cm=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],Tm=Cm,Im={...Ke,intervals:[],aliases:[]},Ms=[],Ra={};function Om(){return Ms.map(t=>t.name)}function _r(t){return Ra[t]||Im}function ys(){return Ms.slice()}function Rm(t,e,a=[]){const i={...Fe(t),name:e,intervals:t,aliases:a};return Ms.push(i),Ra[i.name]=i,Ra[i.setNum]=i,Ra[i.chroma]=i,i.aliases.forEach(s=>Lm(i,s)),i}function Lm(t,e){Ra[e]=t}Tm.forEach(([t,e,...a])=>Rm(t.split(" "),e,a));var km="C C# D D# E F F# G G# A A# B".split(" "),Dm="C Db D Eb E F Gb G Ab A Bb B".split(" ");function wr(t,e={}){if(isNaN(t)||t===-1/0||t===1/0)return"";t=Math.round(t);const i=(e.sharps===!0?km:Dm)[t%12];if(e.pitchClass)return i;const s=Math.floor(t/12)-1;return i+s}var Fm=t=>t.name,jm=t=>t.map(Nt).filter(e=>!e.empty),zn=Nt;function zm(t){return wr(t)}var Er=(t,e)=>t.height-e.height;function qm(t,e){return e=e||Er,jm(t).sort(e).map(Fm)}function Gm(t){return qm(t,Er).filter((e,a,i)=>a===0||e!==i[a-1])}function $m(t,e){const a=zn(t);if(a.empty)return"";const i=zn(e||wr(a.midi||a.chroma,{sharps:a.alt<0,pitchClass:!0}));if(i.empty||i.chroma!==a.chroma)return"";if(a.oct===void 0)return i.pc;const s=a.chroma-a.alt,n=i.chroma-i.alt,o=s>11||n<0?-1:s<0||n>11?1:0,r=a.oct+o;return i.pc+r}var vs=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],qn={...Ke,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},Bm=vs.map(Um),os={};Bm.forEach(t=>{os[t.name]=t,t.aliases.forEach(e=>{os[e]=t})});function Ar(t){return typeof t=="string"?os[t.toLowerCase()]||qn:t&&t.name?Ar(t.name):qn}function Um(t){const[e,a,i,s,n,o,r]=t,h=r?[r]:[],c=Number(a).toString(2);return{empty:!1,intervals:_r(s).intervals,modeNum:e,chroma:c,normalized:c,name:s,setNum:a,alt:i,triad:n,seventh:o,aliases:h}}function Sr(t){return(e,a)=>{const i=Ar(e);if(i.empty)return[];const s=Wa(i.modeNum,t),n=i.intervals.map(o=>Ei(a,o));return s.map((o,r)=>n[r]+o)}}Sr(vs.map(t=>t[4]));Sr(vs.map(t=>t[5]));var Hm={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function Nr(t){if(typeof t!="string")return["",""];const e=t.indexOf(" "),a=Nt(t.substring(0,e));if(a.empty){const s=Nt(t);return s.empty?["",t]:[s.name,""]}const i=t.substring(a.name.length+1).toLowerCase();return[a.name,i.length?i:""]}var Wm=Om;function me(t){const e=Array.isArray(t)?t:Nr(t),a=Nt(e[0]).name,i=_r(e[1]);if(i.empty)return Hm;const s=i.name,n=a?i.intervals.map(r=>Ei(a,r)):[],o=a?a+" "+s:s;return{...i,name:o,type:s,tonic:a,notes:n}}var Zm=om("Scale.scale","Scale.get",me);function Vm(t,e={}){const a=Mm(t),i=Nt(e.tonic??t[0]??""),s=i.chroma;if(s===void 0)return[];const n=a.split("");n[s]="1";const o=Wa(s,n).join(""),r=ys().find(c=>c.chroma===o),h=[];return r&&h.push(i.name+" "+r.name),e.match==="exact"||Cr(o).forEach(c=>{h.push(i.name+" "+c)}),h}function Qm(t){const e=me(t),a=Pr(e.chroma);return Em().filter(i=>a(i.chroma)).map(i=>i.aliases[0])}function Cr(t){const e=ms(t)?t:me(t).chroma,a=pm(e);return ys().filter(i=>a(i.chroma)).map(i=>i.name)}function Km(t){const e=Pr(me(t).chroma);return ys().filter(a=>e(a.chroma)).map(a=>a.name)}function Tr(t){const e=t.map(s=>Nt(s).pc).filter(s=>s),a=e[0],i=Gm(e);return Wa(i.indexOf(a),i)}function Xm(t){const e=me(t);if(e.empty)return[];const a=e.tonic?e.notes:e.intervals;return gm(e.chroma).map((i,s)=>{const n=me(i).name;return n?[a[s],n]:["",""]}).filter(i=>i[0])}function Ym(t){const e=Array.isArray(t)?Tr(t):me(t).notes,a=e.map(i=>Nt(i).chroma);return i=>{const s=Nt(typeof i=="number"?zm(i):i),n=s.height;if(n===void 0)return;const o=n%12,r=a.indexOf(o);if(r!==-1)return $m(s.name,e[r])}}function Jm(t){const e=Ym(t);return(a,i)=>{const s=Nt(a).height,n=Nt(i).height;return s===void 0||n===void 0?[]:cm(s,n).map(e).filter(o=>o)}}function td(t){const{intervals:e,tonic:a}=me(t),i=xr(e,a);return s=>s?i(s>0?s-1:s):""}function ed(t){const{intervals:e,tonic:a}=me(t);return xr(e,a)}var ad={degrees:td,detect:Vm,extended:Cr,get:me,modeNames:Xm,names:Wm,rangeOf:Jm,reduced:Km,scaleChords:Qm,scaleNotes:Tr,steps:ed,tokenize:Nr,scale:Zm};function id(){let t=new Mt;new Mt;let e=new Mt,a=new Mt,i=new Mt,s=new Mt,n=new Mt;new Mt;let o=new Mt,r=new Mt,h=new Mt,c=new Mt;new Mt;let d=new Mt;t.visible=!0,s.visible=!0,n.visible=!1,o.visible=!0,r.visible=!0,e.visible=!0,a.visible=!0,i.visible=!0,c.visible=!0,h.visible=!0;let u=new Mt,m=new Mt,v=new Mt;u.visible=!1,m.visible=!1,v.visible=!1;let p=new lh,b=0,w=1/18,A=0,C=0,S=0,I=0,F=0,j=0;const $=.05,B=.0075,O=new Jo(B,48),H=new wt({color:"#0000ff",wireframe:!0});let G=new th(O,H);const z={graticuleColor:"#2f2f2f0b",directionalLightColor:"#ffffff",backgroundColor:"#000000",polygonColor:"#FF1493",pyramidColorFM:"#FFFF00",pyramidColorCellular:"#FFFF00",mstFmColor:"#FF5F1F",boundingBoxColor:"#b80000",coastlineColor:"#303030",mstCellColor:"#FFFF00",matchingPyramidColor:"#FFFF00",nonMatchingPyramidColor:"#FF1493",waterColor:"#303030",accessibilityHexColor:"#310057",cellServiceNo:"#ff00ff",cellServiceYes:"#3b3b3b",fmRayColor:"#3b3b3b",cellRayColor:"#3b3b3b",elevationLegend:"#0062ff",accessibilityLegend:"#0dfa50"};function nt(){const l=document.getElementById("info-container"),f=document.getElementById("info-button");l.style.opacity="0",l.style.pointerEvents="none",f.style.opacity=0,f.style.transition="opacity 10ms ease-in-out",f.style.display="block",setTimeout(()=>{f.style.opacity=1},90)}document.getElementById("hide-legend").addEventListener("click",nt);function yt(){const l=document.getElementById("info-container"),f=document.getElementById("info-button");l.style.opacity="1",l.style.visibility="visible",l.style.pointerEvents="auto",f.style.display="none",l.style.display="block",l.classList.remove("hidden")}document.getElementById("info-container").addEventListener("transitionend",function(l){l.propertyName==="opacity"&&getComputedStyle(this).opacity==0&&(this.style.visibility="hidden")}),document.getElementById("info-button").addEventListener("click",function(){yt()});function Ct(){const l=document.getElementById("legend-controls");[{name:"switch1",layers:[{name:"fm propagation curve",color:z.polygonColor,switchState:1},{name:"cell service dead zone",color:z.cellServiceNo,switchState:2}]},{name:"switch2",layers:[{name:"elevation contours",color:z.elevationLegend,switchState:1},{name:"composite accessibility",color:z.accessibilityLegend,switchState:2}]}].forEach(M=>{const g=document.createElement("div");g.className="custom-radio-group",M.layers.forEach(x=>{const _=document.createElement("div");_.className="custom-radio-container";const P=document.createElement("input");P.type="radio",P.name=M.name,P.id=x.name,P.className="hidden-radio",P.checked=!1;const E=document.createElement("label");E.htmlFor=x.name,E.className="custom-radio-label";const N=document.createElement("span");N.className="custom-radio";const D=document.createElement("span");D.textContent=x.name,D.style.color=x.color,E.appendChild(N),E.appendChild(D),_.appendChild(P),_.appendChild(E),g.appendChild(_),P.addEventListener("change",function(){this.checked&&(pe(x.switchState,M.name),document.querySelectorAll(`[name=${M.name}]`).forEach(Q=>{Q.nextSibling.firstChild.classList.remove("checked"),Q.nextSibling.firstChild.style.color=""}),N.classList.add("checked"),N.style.color=x.color)})}),l.appendChild(g)})}const X="+proj=longlat +lat_0=40 +lon_0=-76.58333333333333 +k=0.9999375 +x_0=249999.9998983998 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs";St.defs("EPSG:2261",X);function J(l,f){if(!Number.isFinite(l)||!Number.isFinite(f))throw new Error(`Invalid coordinates: longitude (${l}), latitude (${f})`);const M=St("EPSG:2261").forward([l,f]);return(!Number.isFinite(M[0])||!Number.isFinite(M[1]))&&console.error(`Projection result is NaN for input: longitude (${l}), latitude (${f})`),M}St.defs("StatePlaneToLatLon",X);const Ut=St("EPSG:2261","WGS84");function xt(l,f){const[M,g]=Ut.inverse([l,f]);return{lon:M,lat:g}}const de=-5,Xe=5,Ci=-5,Za=5;J(Ci,de),J(Za,Xe);function Ee(l,f){const M=l.x-f.x,g=l.y-f.y;return Math.sqrt(M*M+g*g)}function Ti(l,f,M,g,x){return(l-f)*(x-g)/(M-f)+g}function Ii(l,f,M,g,x,_){const P=(l-f)/(M-f);return Math.pow(P,_)*(x-g)+g}function Va(l,f=10){const M=ad.rangeOf(l)("F2","F4");let g=-1;return function(){if(g===-1)g=Math.floor(Math.random()*M.length);else{const _=Math.floor(M.length*(f/100)),P=Math.max(0,g-_),N=Math.min(M.length-1,g+_)-P+1;g=P+Math.floor(Math.random()*N)}return M[g]}}Va("F minor pentatonic",25);const Oi=Va("D malkos raga",50);let rt,Me,$t,ma,je,Dt,ut,ze,da,qe,Ge,Qt,ye,$e,Bt,Ae,Ye,Ma=new mh,ya=ga();function va(){$e=new Mh().toDestination();let l=new yh(-5),f=ga(),M=new vh({threshold:-2,ratio:6,attack:.003,release:.25});Bt=new gh({decay:3,preDelay:.15}).connect($e),Bt.wet.value=.1,f.connect(Bt),Ye=new ph(12),Bt.connect(Ye),Ye.connect($e),$e.chain(Ma,M,l),l.toDestination(),Ae=new xh({frequency:.5,type:"sine",min:-1,max:1})}function ga(){const l=new dh({low:-48,mid:0,high:-48}),f=new he({type:"peaking",frequency:2110,Q:1,gain:15});f.connect(l.mid);const M=new he({type:"highpass",frequency:700,Q:.7});return M.connect(f),new he({type:"lowpass",frequency:3300,Q:.7}).connect(M),l}function Ri(){rt={droneSynth:Qa(),membraneSynth:ps(),noiseSynth:Li(),radioTuner:Ne(),noiseTuner:Ft()}}function Qa(){return Me=new bh({oscillator:{type:"sine"},envelope:{attack:1,decay:.4,sustain:1,release:1},detune:150,harmonicity:.5,volume:0}),ma=new he({type:"highpass",frequency:50,rolloff:-12,Q:4}),$t=new he({type:"lowpass",frequency:250,rolloff:-96,Q:0}),je=new he({type:"peaking",frequency:300,rolloff:-24,Q:4}),Me.connect(ma),ma.connect($t),$t.connect(je),je.connect(Bt),Me.triggerAttack("F2"),Me}let pa=0,Ka=new Set;const Se=new Map,Xa=20;function Ne(){if(!ya){console.error("outputEQ is not defined");return}return Dt=new nn({url:Te[0],loop:!0,grainSize:1,overlap:0,drift:0,playbackRate:1,detune:0,volume:Et(0)}).connect(Bt),Dt.autoStart=!0,Dt.onload=()=>{console.log("radioTuner sample loaded successfully")},Dt.onerror=l=>{console.error("Failed to load the radioTuner sample:",l)},Dt.fadeIn=.1,Dt.fadeOut=.1,Dt.connect(ya),Dt}function gs(){const l=Te[pa];l&&l.loaded?(Dt.buffer=l.buffer,Dt.start(Ce(We())),console.log("Playback started with loaded buffer.")):console.error("Attempted to play a sample that is not loaded yet.")}function y(l){pa=l,gs(),console.log(`Switched to sample: ${pa}`)}function L(l){if(!Se.has(l)){if(Se.size>=Xa){const M=Se.keys().next().value;Se.delete(M)}const f=K();Se.set(l,f)}return Se.get(l)}function K(){let l;do l=Math.floor(Math.random()*Te.length);while(Te[l]&&Te[l].buffer===Dt.buffer);return l}let at;async function Pt(){try{await Zs(),await ie(),console.log("All audio files loaded successfully.")}catch(l){console.error("Failed to load audio files:",l)}}async function ie(){try{at=await an.fromUrl("/remotesensing/assets/sounds/background/amRadioTuning.mp3"),console.log("Noise buffer loaded successfully.")}catch(l){console.error("Failed to load the noise buffer:",l)}}function Ft(){if(!at){console.error("Buffer is not loaded yet.");return}return ut=new nn({url:at,loop:!0,playbackRate:1.666,loopStart:Math.random(0),grainSize:.35,overlap:1.5,drift:.25,detune:.5,volume:Et(.33)}).connect(Bt),ut.start(),ut.onload=()=>{console.log("noisetuner sample loaded successfully"),ut.loopStart=Math.random()*ut.buffer.duration},ut.onerror=l=>{console.error("Failed to load the noiseTuner sample:",l)},ut.connect(Bt),ut}function ps(){return ze=new Ph({envelope:{attack:.005,decay:.05,sustain:.5,release:.005},pitchDecay:.5,volume:Et(1)}),da=new he({type:"highpass",frequency:400,Q:1}),ze.connect(da),da.connect(Bt),ze}function Li(){return qe=new _h({volume:-20,noise:{type:"pink"},envelope:{attack:.5,decay:0,sustain:1,release:.5}}),Ge=new he({type:"highpass",frequency:3e3,Q:0}),Qt=new he({type:"peaking",frequency:1e3,Q:5,gain:2}),ye=new he({type:"lowpass",frequency:1800,rolloff:-96,Q:0}),qe.connect(Ge),Ge.connect(Qt),Qt.connect(ye),ye.connect(Bt),qe.triggerAttack(),qe}let Be={analogChannel:{synths:["droneSynth","radioTuner","noiseTuner"],volume:-10,muted:!0},digitalChannel:{synths:["membraneSynth","droneSynth","noiseTuner"],volume:-10,muted:!0},elevationChannel:{synths:[""],volume:-10,muted:!0},accessChannel:{synths:["noiseSynth"],volume:-10,muted:!0}};function Kt(l,f){const M=Be[l],g=We()+.1;if(f.volume!==void 0&&!isNaN(f.volume)?(M.volume=f.volume,M.synths.forEach(x=>{const _=rt[x];_&&_.volume&&_.volume.setValueAtTime(f.volume,g)})):console.error("Invalid volume setting:",f.volume),f.muted!==void 0){M.muted=f.muted;const x=f.muted?-1/0:M.volume;isNaN(x)?console.error("Invalid mute volume:",x):M.synths.forEach(_=>{const P=rt[_];P&&P.volume&&P.volume.setValueAtTime(x,g)})}}function Ht(l){new wh(.1),Object.keys(Be).forEach(f=>{const M=f!==l;Kt(f,{muted:M,volume:M?-1/0:Be[f].volume})}),console.log(`Activated channel: ${l} with synths ${Be[l].synths}`)}let ve=We();const Xt=.025,Ue=.01;function Ce(){const l=We();return ve=Math.max(ve+Xt,l)+Math.random()*Ue,ve}function Ya(l,f,M){if(!l||l.loaded){console.error("Attempted to trigger an instrument that does not exist");return}const g=Ce();l.triggerAttackRelease(f,M,g)}function xs(l){const f=Ir(l.zoom);Bt.wet.rampTo(f,.5),Or(f)}function Ir(l){const f=tt.minZoom,M=tt.maxZoom,g=.05,x=1,P=(Math.max(f,Math.min(M,l))-f)/(M-f),N=Math.pow(1-P,3);return g+N*(x-g)}function Or(l){const g=-7-(l-.05)/.95*-8;$e.volume.rampTo(g,.5)}function bs(){Me.harmonicity.rampTo(1,1),Me.volume.rampTo(Et(.75),.75),$t.frequency.rampTo(450,1),$t.Q.rampTo(3,1),je.frequency.rampTo(100,3),je.Q.rampTo(20,1),qe.volume.rampTo(Et(.03),.75),Qt.frequency.rampTo(666,5),Qt.Q.rampTo(0,2),ut.volume.rampTo(Et(.53),.75),rt.radioTuner&&rt.radioTuner.volume.rampTo(Et(0),.5)}function Rr(l){const f=ti(65280),M=ti(16711935);if(l<=-60)return"#00ff00";const g=-30,_=(l-g)/(-1-g),P=_*_,E=Gs(f,M,P);return $s(...E)}let Je=15728895;function Lr(){const l=Math.round(Ma.getValue(),1);Je=Rr(l*1.5),so(Je)}setInterval(()=>{Lr()},10);let ot,U,Wt,tt,Ja;const kr=1e-5;let Dr=new He({color:16711680}),Fr=new He({color:255}),jr=new zt,zr=new zt,qr=new Oe(jr,Dr),Gr=new Oe(zr,Fr);function $r(){ot=new eh;let l=1,f=.25,M=2.5;U=new ah(-l,l,l,-l,f,M),U.up.set(0,0,1);const g=2,x=U.far;ot.fog=new ih(z.backgroundColor,g,x),Wt=new sh({canvas:document.querySelector("#canvas"),antialias:!1,precision:"lowp",powerPreference:"high-performance"}),Wt.setSize(window.innerWidth,window.innerHeight,!1),Wt.setPixelRatio(1),document.getElementById("gfx").appendChild(Wt.domElement),tt=new Sh(U,Wt.domElement),tt.screenSpacePanning=!1,tt.enablePan=!0,tt.enableRotate=!0,tt.enableDamping=!0,tt.dampingFactor=.05,tt.minPolarAngle=53.1301024/2*(Math.PI/180),tt.maxPolarAngle=35.264*(Math.PI/180),tt.maxDistance=1.5,tt.minDistance=.5,tt.minZoom=.5,tt.maxZoom=5,tt.addEventListener("change",()=>{xs(U)}),ot.add(qr),ot.add(Gr),U.updateProjectionMatrix(),Wt.setClearColor(z.backgroundColor),window.addEventListener("resize",Ps,!1),ki()}function Br(){tn(),sn.start("+0.02"),va(),Ri(),rt&&rt.droneSynth&&Ae.connect(rt.droneSynth.oscillator.frequency),Ae.start(),console.log("Synths initialized:",rt)}function Ur(l){if(U.isOrthographicCamera){let f=l/100;f=Math.max(tt.minZoom,Math.min(tt.maxZoom,f)),U.zoom=f,U.updateProjectionMatrix(),xs(U)}else console.log("unknown camera!")}function Hr(){const l=U.position.distanceTo(tt.target);function f(P,E){let N=.5;return Math.random()*(1.5-N)+N}const M=-Math.PI/5*f(),g=new V().subVectors(U.position,tt.target),x=new V(0,0,1),_=new Sa().setFromAxisAngle(x,M);g.applyQuaternion(_),U.position.copy(tt.target).add(g.setLength(l)),U.lookAt(tt.target),U.updateProjectionMatrix()}function Ps(){document.getElementById("three-container");const l=800,f=480;U.aspect=l/f,U.updateProjectionMatrix(),Wt.setSize(l,f,!1),Ja=.35;var M=Math.max(1,window.innerWidth*Ja),g=Math.max(1,window.innerHeight*Ja);const x=document.getElementById("canvas");x.style.width="100%",x.style.height="100%",x.style.imageRendering="pixelated",Wt&&U&&(Wt.setSize(M,g,!1),Wt.setPixelRatio(1),U.aspect=M/g,U.updateProjectionMatrix()),ai(),ki()}function ki(){if(U){const P=(window.innerWidth-600)/600;if(U.isPerspectiveCamera){let E=90+-30*Math.max(0,Math.min(1,P));U.fov=E}else if(U.isOrthographicCamera){let E=.5+1*Math.max(0,Math.min(1,P));U.fov=E}U.updateProjectionMatrix()}}ki();function Wr(l,f){l+=(l-F)*$,f+=(f-j)*$,F=l,j=f;const M=.005,g=.005;let x=new V(1,0,0).applyQuaternion(U.quaternion).normalize(),_=new V(0,0,1),P=new V().crossVectors(_,x).normalize(),E=x.multiplyScalar(l*M),N=P.multiplyScalar(f*g),D=new V().addVectors(E,N);U.position.add(D),tt.target.add(D),tt.update()}const Yt={accessibilityMesh:{group:h,enabled:!1,onIntersect:fo},cellTransmitterPoints:{group:r,enabled:!1,onIntersect:Zr},fmTransmitterPoints:{group:n,enabled:!1,onIntersect:eo},cameraCenter:{group:r,enabled:!0,onIntersect:()=>Os(U)}};function Zr(l,f=1){const M=l.point,g=Yr(M,f),x=l.object.userData.gridCode||"unknown";if(g.length>0){const _=g[0];Qr(M,_.position,f,_.uniqueCellid,x,_.distance,Je),Vr(Math.round(_.distance,0),x)}else console.log("No cell towers found or dead zone!"),Kr(f)}function Vr(l,f){const M=l/5280;let g=Math.max(0,Math.min(1,(M-.1)/(10-.1)));switch(f){case"0":rt.membraneSynth.set({volume:Et(0)}),rt.droneSynth.set({harmonicity:1+2*g}),rt.droneSynth.frequency.rampTo(110,1),$t.frequency.rampTo(700,1.5),$t.Q.rampTo(3,1),Qt.frequency.rampTo(7e3,1.5),ut&&(ut.playbackRate=.5,ut.grainSize=.1,ut.loopStart=120,ut.overlap=0,ut.detune=30,ut.reverse=!0,ut.volume.value=Et(1));break;case"1":rt.membraneSynth.set({detune:-1200*g,volume:Et(1)}),rt.droneSynth.set({harmonicity:1+2*g,volume:Et(.75-.5*g),frequency:110-g*100}),$t.frequency.rampTo(250+g,.5),$t.Q.rampTo(4,1),Qt.frequency.rampTo(Math.abs(5e3-g*1e3),.5),rt.noiseSynth.set({volume:Et(g)}),ut&&(ut.playbackRate=1+g,ut.volume.value=Et(Math.abs(g-.25)));break}}let ge=[],_s=null;function Qr(l,f,M,g,x,_,P){const E=new zt().setFromPoints([l,f]),N=new He({color:P}),D=new Oe(E,N);for(N.color.set(P),N.needsUpdate=!0,D.visible=x!=="0",ot.add(D),ge.push(D),x!=="0"&&_s!==g&&(Jr(),_s=g);ge.length>M;){const q=ge.shift();ot.remove(q),q.geometry&&q.geometry.dispose()}}function Kr(l){for(;ge.length>l;){const f=ge.shift();f&&(ot.remove(f),f.geometry&&f.geometry.dispose())}}function Xr(){ge.forEach(l=>{ot.remove(l),l.geometry&&l.geometry.dispose()}),ge=[]}function Yr(l,f=1){let M=[];const g=xt(l.x,l.y);return e.children.forEach(x=>{const _=xt(x.position.x,x.position.y,x.position.z),P=Ts(g,_);M.push({distance:P,uniqueCellid:x.userData.uniqueCellid,position:x.position.clone()})}),M.sort((x,_)=>x.distance-_.distance).slice(0,f)}function Jr(){const l=Oi();Ya(ze,l,"0.15")}function ws(){const l=ge.map((M,g)=>{const x=M.geometry.attributes.position.array.slice(0,3),_=M.geometry.attributes.position.array.slice(3,6),P=Math.sqrt(Math.pow(_[0]-x[0],2)+Math.pow(_[1]-x[1],2)+Math.pow(_[2]-x[2],2));return{index:g,distance:P}});return l.sort((M,g)=>M.distance-g.distance),l.map((M,g)=>({originalIndex:M.index,sortedIndex:g,distance:M.distance}))}function to(){ws().forEach(f=>{})}function eo(l){let f=new Set;l.forEach(M=>{const g=M.object,x=g.userData.uniqueId;if(!g.userData.vertices){console.error("Vertices not found for object",g);return}if(f.add(x),!Ka.has(x)){const N=L(x);y(N)}const{towers:P,found:E}=no(x);if(E)P.forEach(N=>{As(M.point,N.position,x,g,Je)});else{const N=ro(g);As(M.point,N,x,g,Je)}}),Ka=f,ao(),se.forEach((M,g)=>{f.has(g)||io(g)})}function ao(){let l=1/0,f=1,M=!1;se.forEach(g=>{const x=g.geometry.attributes.position.array,_=new V(x[0],x[1],x[2]),P=new V(x[3],x[4],x[5]),E=_.distanceTo(P);E<l&&(l=E,f=g.userData.nearestVertexDistance||1,M=!0)}),M?(Di(rt.droneSynth,$t,l,f),Di(rt.radioTuner,null,l,f),Di(rt.noiseTuner,null,l,f)):bs()}let Es=1;function Di(l,f,M,g){const x=Math.max(0,Math.min(1,(M/g-.01)/1.99)-.15),_=Et(Math.abs(1-x)+.01),P=Et(Math.abs(1-x)+.02),E=5500*(1-x),D=3*(1-x),q=Math.log(10)*_,Q=Math.log(10)*P;if(f&&f.frequency.rampTo(E,.5),l===rt.droneSynth)l.volume.rampTo(Et(x/2),.5),l.harmonicity.rampTo(1-x,.5),Ae.min=-D,Ae.max=D;else if(l===rt.radioTuner){l.volume.rampTo(q-.5,.45),x<.3?Es>=.3&&l.set({grainSize:1,playbackRate:1,overlap:1}):l.set({grainSize:Math.exp(1-x)/10,playbackRate:Math.abs(x),overlap:2,drift:Math.exp(1-x)/10});let Y=Et(1-Q);ut.volume.rampTo(Y-35,.5),rt.noiseSynth.volume.rampTo(Y-45,.5),Ge.frequency.rampTo(E,.5),Es=x}}function io(l){let f=se.get(l);f&&(ot.remove(f),f.geometry.dispose(),se.delete(l),se.size)}function so(l){se.forEach((f,M)=>{f.material.color.set(l),f.material.needsUpdate=!0}),ge.forEach(f=>{f.material.color.set(l),f.material.needsUpdate=!0})}function no(l){let f=[],M=!1;return[window.instancedPyramidMatching,window.instancedPyramidNonMatching].forEach(g=>{var _;const x=g.count;for(let P=0;P<x;P++)if(((_=g.userData[P])==null?void 0:_.uniqueId)===l){const E=new fh;g.getMatrixAt(P,E);const N=new V().setFromMatrixPosition(E);!isNaN(N.x)&&!isNaN(N.y)&&!isNaN(N.z)&&(f.push({uniqueId:l,position:N.clone()}),M=!0)}}),{towers:f,found:M}}function ro(l){const f=l.geometry.attributes.position.array;let M=new V(0,0,0),g=f.length/3;for(let x=0;x<f.length;x+=3)M.x+=f[x],M.y+=f[x+1],M.z+=f[x+2];return M.divideScalar(g),M}let se=new Map;function As(l,f,M,g,x){let _=se.get(M),P=new zt().setFromPoints([l,f]);_&&(ot.remove(_),_.geometry.dispose());let E=new He({color:x});_=new Oe(P,E);let N=oo(l,g);_.userData.nearestVertexDistance=N,_.material.color.set(x),_.material.needsUpdate=!0,ot.add(_),se.set(M,_)}function oo(l,f){let M=1/0;return f.userData.vertices?f.userData.vertices.forEach(g=>{const x=g.distanceTo(l);x<M&&(M=x)}):console.error("No vertices data found in mesh userData"),M}function Ss(l){{se.forEach((f,M)=>{ot.remove(f),f.geometry.dispose(),se.delete(M)});return}}let Ns=new V,Cs=new Sa;const ho=0,lo=0;function co(l){const f=Ns.distanceTo(l.position),M=Cs.angleTo(l.quaternion);return f>ho||M>lo?(Ns.copy(l.position),Cs.copy(l.quaternion),!0):!1}function uo(){if(co(U)){if(Yt.cellTransmitterPoints.enabled)ws(),to();else if(Yt.fmTransmitterPoints.enabled)return}}function fo(l){const f=l.point,M=l.object.userData.vertices,g=l.object.userData.gridCode||"unknown";if(M){const x=M.reduce((_,P)=>{const E=Math.hypot(P.x-f.x,P.y-f.y,P.z-f.z);return E<_.distance?{vertex:P,distance:E}:_},{vertex:null,distance:1/0});!isNaN(g)&&g>=0&&g<=5&&mo(x.distance,parseInt(g))}else console.log("No vertices data found in userData")}function mo(l,f){let M=12;if(f!==void 0&&f!=="unknown"&&!isNaN(f)&&f>=0&&f<=5){const g=f/5;M=Math.ceil(2+7*g)}Ye.bits.rampTo(M,.5)}function Mo(l,f,M=0){const g=f.getPolarAngle(),x=l.position.z-M,_=new V(0,0,-1);l.getWorldDirection(_),_.z=0,_.normalize();const P=Math.tan(g)*x,E=_.multiplyScalar(P);return new V(l.position.x+E.x,l.position.y+E.y,M)}function yo(l,f){Object.entries(Yt).forEach(([M,{group:g,enabled:x,onIntersect:_}])=>{if(x&&g){const P=new ch,E=Mo(l,tt);P.set(E,new V(0,0,-1)),P.params.Points.threshold=.175;const N=g.children.filter(q=>q.visible),D=P.intersectObjects(N,!0);D.length>0?(_(M==="fmTransmitterPoints"?D:D[0]),D.forEach(q=>{Os(q.point),G.position.set(q.point.x,q.point.y,q.point.z+.01),G.material.color.set(Je),G.parent||f.add(G)})):(M==="fmTransmitterPoints"&&(bs(),Ss()),G.parent&&f.remove(G))}})}function Ts(l,f){const g=l.lat*Math.PI/180,x=f.lat*Math.PI/180,_=(f.lat-l.lat)*Math.PI/180,P=(f.lon-l.lon)*Math.PI/180,E=Math.sin(_/2)*Math.sin(_/2)+Math.cos(g)*Math.cos(x)*Math.sin(P/2)*Math.sin(P/2);return 6371e3*(2*Math.atan2(Math.sqrt(E),Math.sqrt(1-E)))}function Is(l,f=!1){const M=Math.abs(l),g=Math.floor(M),x=(M-g)*60,_=Math.floor(x),P=((x-_)*60).toFixed(2),E=g.toString().padStart(2,"0"),N=_.toString().padStart(2,"0"),D=parseFloat(P).toFixed(2).toString().padStart(5,"0");let q="";return f?q=l>=0?"E":"W":q=l>=0?"N":"S",`${E} ${N}' ${D}" ${q}`}function Os(l){try{const f=St("EPSG:2261").inverse([l.x,l.y]),M=Is(f[1],!1),g=Is(f[0],!0),x=`${M}<br>${g}`;document.getElementById("latLonDisplay").innerHTML=x}catch{document.getElementById("latLonDisplay").textContent="Error in displaying coordinates."}}function Rs(){if(b+=p.getDelta(),b>w){if(tt.update(),yo(U,ot),U&&tt){const l=U.position.distanceTo(tt.target),f=kr,M=new V().subVectors(U.position,tt.target),g=new V(0,0,1),x=new Sa().setFromAxisAngle(g,f);M.applyQuaternion(x),U.position.copy(tt.target).add(M.setLength(l)),(S!==0||I!==0)&&(Wr(-S,-I),S=0,I=0),(A!==0||C!==0)&&(U.position.y+=C*.01,U.position.x+=A*.01,A=0,C=0),U.lookAt(tt.target),uo(),Ls(),sn.cancel(We()+.1),Wt.render(ot,U)}u.visible!==!1&&Fi(),b=b%w}requestAnimationFrame(Rs)}function Ls(){Fs.state==="suspended"&&Fs.resume().then(()=>{console.log("AudioContext unlocked!")}).catch(l=>{console.error("Error resuming audio context:",l)})}function vo(){en.state==="suspended"&&en.resume().then(()=>{console.log("AudioContext activated successfully")}).catch(l=>{console.log("Error activating AudioContext:",l)})}document.getElementById("audioControl").addEventListener("click",function(){vo(),tn()+.1});var ks=null,Ds=null,Fs=new(window.AudioContext||window.AudioContext);function js(){var l=new WebSocket("ws://localhost:8080");l.onopen=function(){console.log("Connected to WebSocket server")},l.onmessage=function(f){try{let M=JSON.parse(f.data);go(M)}catch(M){console.error("Error parsing WebSocket data:",M)}},l.onclose=function(f){console.log(`WebSocket connection closed: ${f.code} ${f.reason}`),setTimeout(js,5e3)},l.onerror=function(f){console.error("WebSocket error observed:",f),l.readyState===WebSocket.OPEN&&l.close()}}function go(l){let f=document.getElementById("gfx");if(document.body.style.cursor="none",setTimeout(()=>f.classList.remove("background"),1e3),(l.buttonPressedLeft||l.deltaLeft!==0)&&(document.getElementById("audioControl").click(),console.log("Triggered AudioContext unlock via button or encoder movement")),l.LEDpotValue!==void 0&&!ii){const M=Math.round(Ti(l.LEDpotValue,201,300,300,201)),g=document.getElementById("fm-channel-slider");g.value=M,ai(M),Gi(M)}if(l.zoomPotValue!==void 0&&!ii){const g=Math.round(Ii(l.zoomPotValue,0,1023,60,360,2));Ur(g)}l.deltaLeft!==void 0&&l.deltaRight!==void 0&&(S=l.deltaLeft,I=l.deltaRight),l.deltaLeftPressed!==void 0&&l.deltaRightPressed!==void 0&&(A=l.deltaLeftPressed,C=l.deltaRightPressed),l.switchState1!==void 0&&l.switchState1!==ks&&(ks=l.switchState1,pe(l.switchState1,"switch1")),l.switchState2!==void 0&&l.switchState2!==Ds&&(Ds=l.switchState2,pe(l.switchState2,"switch2"))}function po(l){switch(l.key){case"1":pe(1,"switch1");break;case"2":pe(2,"switch1");break;case"3":pe(1,"switch2");break;case"4":pe(2,"switch2");break}}function pe(l,f){document.getElementById("gfx");let M;if(f==="switch1"){u.visible=!1,v.visible=!1;let g=document.getElementById("fm-channel-controls");switch(M=l===1?"analogChannel":"digitalChannel",Yt.cellTransmitterPoints.enabled=!1,Yt.fmTransmitterPoints.enabled=!1,Ss(),Xr(),Object.keys(Ot).forEach(x=>{Ot[x].isDecaying=!0,Ot[x].decayRate=1,Fi()}),l){case 1:u.visible=!0,t.visible=!0,Yt.fmTransmitterPoints.enabled=!0,Yt.cellTransmitterPoints.enabled=!1,g.style.visibility="visible",rt.droneSynth.triggerAttack("F2",We()+.1),qi!==null&&ji(si,qi,s);break;case 2:qi=ei,v.visible=!0,u.visible=!1,t.visible=!1,Yt.cellTransmitterPoints.enabled=!0,Yt.fmTransmitterPoints.enabled=!1,M="digitalChannel",rt.droneSynth.triggerAttack("A3",We()+.1),g.style.visibility="hidden",Object.keys(Ot).forEach(x=>{Ot[x].isDecaying=!0,Ot[x].decayRate=1,Fi()});break}M?Ht(M):console.error("No active audio channel was set for "+f)}else if(f==="switch2"){switch(M=l===1?"elevationChannel":"accessChannel",l){case 1:i.visible=!0,m.visible=!1,Yt.accessibilityMesh.enabled=!1,M="elevationChannel";break;case 2:m.visible=!0,i.visible=!1,Yt.accessibilityMesh.enabled=!0,M="accessChannel";break;default:m.visible=!1,i.visible=!1;break}M?Ht(M):console.error("No active audio channel was set for "+f)}}async function zs(){console.log("initializing"),await Pt(),$r(),Br(),Ja=null,Ps();try{await zo(),Uo(),js(),Ls(),xo(),Hr()}catch(l){console.error("Initialization failed:",l)}}function xo(){const l=document.getElementById("gfx");Wt.render(ot,U),U.updateProjectionMatrix(),requestAnimationFrame(()=>{l.style.visibility="visible",l.style.opacity="1",l.style.pointerEvents="auto",Rs(),document.addEventListener("keydown",po,!1)})}document.readyState!=="loading"?(console.log("g2g"),zs()):document.addEventListener("DOMContentLoaded",function(){console.log("document was not ready, now initializing"),zs()});function qs(l){if(!l||l.type!=="FeatureCollection"||!Array.isArray(l.features))throw console.error("GeoJSON data is invalid or not a FeatureCollection:",l),new Error("GeoJSON data is invalid or not a FeatureCollection");let f=1/0,M=-1/0,g=1/0,x=-1/0;return l.features.forEach(_=>{const P=_.geometry,E=P.coordinates;switch(P.type){case"Polygon":E.forEach(N=>{N.forEach(D=>{const[q,Q]=J(D[0],D[1]);f=Math.min(f,q),M=Math.max(M,q),g=Math.min(g,Q),x=Math.max(x,Q)})});break;case"MultiPolygon":E.forEach(N=>{N.forEach(D=>{D.forEach(q=>{const[Q,Y]=J(q[0],q[1]);f=Math.min(f,Q),M=Math.max(M,Q),g=Math.min(g,Y),x=Math.max(x,Y)})})});break}}),{min:new V(f,g,-1/0),max:new V(M,x,1/0)}}function bo(l,f){l.addEventListener("change",()=>{const M=U.position.distanceTo(l.target);U.position.clamp(f.min,f.max),l.target.clamp(f.min,f.max);const g=new V().subVectors(U.position,l.target).normalize();U.position.copy(l.target).add(g.multiplyScalar(M))})}function Po(l){return new V((l.min.x+l.max.x)/2,(l.min.y+l.max.y)/2,0)}function _o(l){return new V(l.max.x-l.min.x,l.max.y-l.min.y,l.max.z-l.min.z)}const ne=35e-5;function wo(l,f,M){const g=[{stop:0,color:new be("#0000ff")},{stop:.2,color:new be("#007fff")},{stop:.4,color:new be("#00ff95")},{stop:.5,color:new be("#00ff00")},{stop:.6,color:new be("#bfff00")},{stop:.8,color:new be("#ffbf00")},{stop:1,color:new be("#ff0000")}],x=(l-f)/(M-f);let _=g[0],P=g[g.length-1];for(let N=0;N<g.length-1;N++)if(x>=g[N].stop&&x<=g[N+1].stop){_=g[N],P=g[N+1];break}return _.color.clone().lerp(P.color,(x-_.stop)/(P.stop-_.stop))}function Eo(l){if(!l||!l.features||l.features.length===0)return console.error("Invalid or empty GeoJSON data"),0;const f=l.features.map(x=>x.properties.contour),M=f.reduce((x,_)=>x+_,0),g=Math.round(M/f.length,0);return Math.min(...f),Math.max(...f),g}function Ao(l,f=100){return new Promise((M,g)=>{if(console.log("adding elevation"),!l||!l.features){g("Invalid GeoJSON data");return}const x=l.features.map(E=>E.properties.contour),_=Math.min(...x),P=Math.max(...x);l.features.forEach((E,N)=>{const D=E.properties.contour;if(D%f!==0)return;const q=E.geometry.coordinates,Q=wo(D,_,P);let Y=.2,W=.75,ht=.75;const pt=(D-_)/(P-_),lt=Y+(W-Y)*Math.pow(pt,ht);let _t=new He({color:Q,transparent:!0,alphaHash:!1,opacity:lt});const dt=(ct,Jt)=>{let et=[];if(ct.forEach(bt=>{if(!Array.isArray(bt)||bt.length!==2||bt.some(oe=>isNaN(oe))){console.error(`Feature ${N} has invalid coordinates`,bt);return}const[jt,re]=bt;try{const[oe,xa]=J(jt,re),Ui=Jt*ne;et.push(oe,xa,Ui)}catch(oe){console.error(`Feature ${N} error in toStatePlane:`,oe.message)}}),et.length>0){const bt=new zt;bt.setAttribute("position",new uh(et,3));const jt=new Oe(bt,_t);jt.computeLineDistances(),i.add(jt)}};E.geometry.type==="LineString"?dt(q,D):E.geometry.type==="MultiLineString"?q.forEach(ct=>dt(ct,D)):console.error(`Unsupported geometry type: ${E.geometry.type}`)});try{ot.add(i),M()}catch(E){g(`Error in addElevContourLines: ${E.message}`)}})}function So(l,f=1){return new Promise((M,g)=>{try{o.clear(),r.clear();const x={};for(let _=0;_<l.features.length;_+=f){const P=l.features[_],E=P.properties.grid_code,[N,D]=P.geometry.coordinates,[q,Q]=J(N,D),Y=P.properties.Z*(ne*1.025);x[E]||(x[E]=[]),x[E].push(new V(q,Q,Y))}Object.keys(x).forEach(_=>{const P=x[_],E=P.map(et=>new V(et.x,et.y,0));var N=_i.from(P.map(et=>[et.x,et.y])),D=[];const q=.15;for(let et=0;et<N.triangles.length;et+=3){const bt=P[N.triangles[et]],jt=P[N.triangles[et+1]],re=P[N.triangles[et+2]];Ee(bt,jt)<=q&&Ee(jt,re)<=q&&Ee(re,bt)<=q&&D.push(N.triangles[et],N.triangles[et+1],N.triangles[et+2])}var Q=new zt().setFromPoints(P);Q.setIndex(D),Q.computeVertexNormals();var Y=new zt().setFromPoints(E);Y.setIndex(D),Y.computeVertexNormals();let W,ht,pt;switch(_){case"0":W=new wt({color:z.cellServiceNo,transparent:!0,alphaHash:!0,opacity:.5,wireframe:!0,side:ee}),ht=new wt({color:0,transparent:!0,opacity:.85,alphaHash:!0,side:ee,wireframe:!1,visible:!0}),pt=new wt({color:16777215,transparent:!0,alphaHash:!0,opacity:.3,wireframe:!0,side:ee,visible:!1});break;case"1":W=new wt({color:z.cellServiceYes,transparent:!0,alphaHash:!0,opacity:.4,wireframe:!0,side:ee,visible:!0}),ht=new wt({color:0,transparent:!0,opacity:1,alphaHash:!0,side:ee,wireframe:!1,visible:!1}),pt=new wt({color:16777215,transparent:!0,alphaHash:!0,opacity:.3,wireframe:!0,side:ee,visible:!1});break;default:pt=new wt({color:16777215,transparent:!0,alphaHash:!0,opacity:.3,wireframe:!0,side:ee,visible:!1})}var lt=new xe(Q,ht),_t=new xe(Q,W),dt=new xe(Y,pt);lt.userData.gridCode=_,console.log("Setting gridCode userData for mesh:",_),_t.userData.gridCode=_,dt.userData.gridCode=_;var ct=new Mt;ct.add(_t),ct.add(lt);var Jt=new Mt;Jt.add(dt),o.add(ct),r.add(Jt)}),Object.keys(x).forEach(_=>{const P=x[_],E=new Ks({size:1,transparent:!1,visible:!0}),N=new zt().setFromPoints(P),D=new Xs(N,E);D.userData={gridCode:_,vertices:P};var q=new Mt;q.add(D)}),ot.add(o),ot.add(r),M({cellServiceMesh:o,cellServiceRayMesh:r})}catch(x){g(`Error in addCellServiceMesh: ${x.message}`)}})}function Gs(l,f,M){const g=l.slice();for(let x=0;x<3;x++)g[x]=Math.round(g[x]+M*(f[x]-l[x]));return g}function ti(l){var f=l>>16&255,M=l>>8&255,g=l&255;return[f,M,g]}function $s(l,f,M){return"#"+((1<<24)+(l<<16)+(f<<8)+M).toString(16).slice(1)}function No(l){const f=ti(2293877),M=ti(65280),g=l/8,x=Gs(f,M,g);return $s(...x)}function Co(l){return .1+.8*l/8}function To(l,f=1){return new Promise((M,g)=>{try{h.clear();const x={};for(let _=0;_<l.features.length;_+=f){const P=l.features[_],E=P.properties.grid_code,[N,D]=P.geometry.coordinates,[q,Q]=J(N,D),Y=P.properties.Z*ne;x[E]||(x[E]=[]),x[E].push(new V(q,Q,Y))}Object.keys(x).forEach(_=>{const P=x[_],E=new Ks({transparent:!1,visible:!1}),N=new zt().setFromPoints(P),D=new Xs(N,E);D.userData={gridCode:_,vertices:P};var q=new Mt;q.add(D),h.add(q)}),Object.keys(x).forEach(_=>{const P=x[_];var E=_i.from(P.map(ct=>[ct.x,ct.y])),N=[];const D=.15;for(let ct=0;ct<E.triangles.length;ct+=3){const Jt=P[E.triangles[ct]],et=P[E.triangles[ct+1]],bt=P[E.triangles[ct+2]];Ee(Jt,et)<=D&&Ee(et,bt)<=D&&Ee(bt,Jt)<=D&&N.push(E.triangles[ct],E.triangles[ct+1],E.triangles[ct+2])}var q=new zt().setFromPoints(P);q.setIndex(N),q.computeVertexNormals();const Q=No(parseInt(_)),Y=Co(parseInt(_));let W=new wt({color:Q,opacity:Y/1.5,transparent:!0,alphaHash:!0,side:ee,visible:!0});const ht=new wt({color:Q,opacity:Y*1.5,wireframe:!0,transparent:!0,alphaHash:!0,side:ee,visible:!0}),pt=new wt({color:Q,opacity:Y*1.5,wireframe:!0,transparent:!0,alphaHash:!0,side:ee,visible:!0});var lt=new xe(q,W),_t=new xe(q,ht);lt.userData={gridCode:_,vertices:P},_t.userData={gridCode:_,vertices:P};var dt=new Mt;dt.add(lt),dt.add(_t),h.add(dt)}),ot.add(h),M(h)}catch(x){console.error(`Error in adding accessibility mesh: ${x.message}`),g(x)}})}let Ot={};function Fi(){Object.keys(Ot).forEach(l=>{const f=Ot[l];f.isDecaying&&(f.opacity-=f.decayRate,f.opacity=Math.max(f.opacity,0),f.meshes.forEach(M=>{M.material.opacity=f.opacity,M.visible=f.opacity>0}),f.opacity<=0&&(f.meshes.forEach(M=>{ot.remove(M),M.geometry.dispose(),M.material.dispose()}),delete Ot[l]))})}function Io(l){let f=new V(0,0,0);return l.forEach(M=>{f.add(M)}),f.divideScalar(l.length),f}function Oo(l,f){let M=0;return l.forEach(g=>{const x=xt(g.x,g.y),_=xt(f.x,f.y),P=Ts({lat:x.lat,lon:x.lon},{lat:_.lat,lon:_.lon});M+=P}),M/l.length/1e3}function ji(l,f,M,g=1){return new Promise((x,_)=>{M.children.forEach(W=>{M.remove(W),W.geometry&&W.geometry.dispose(),W.lineMaterial&&W.lineMaterial.dispose()}),Object.keys(Ot).forEach(W=>{(W!==f.toString()||u.visible===!1)&&(Ot[W].isDecaying=!0,Ot[W].decayRate=.1)});const P=l.features.map(W=>{const ht=W.properties.key.split("_");return parseInt(ht[ht.length-1],10)}),E=1,N=Math.min(...P),D=.9,q=.3,Q=l.features.map(W=>{const ht=W.properties.key.split("_"),pt=parseInt(ht[ht.length-1],10);return pt<0?pt:null}).filter(W=>W!==null);Math.max(...Q),Math.min(...Q);const Y=D-q;l.features.forEach((W,ht)=>{if(ht%g!==0)return;const pt=W.properties.key.split("_")[0],lt=parseInt(W.properties.channel,10);if(lt!==f)return;const _t=W.properties.elevation_data;let dt=parseInt(W.properties.key.split("_").pop(),10),ct=D;dt<E&&(ct=q+Y*(dt-N)/(E-1-N));const Jt=new He({color:z.polygonColor,transparent:!0,alphaHash:!0,opacity:ct,visible:u.visible&&lt===f}),et=W.geometry.coordinates[0].map(Ie=>{const[ba,Wo]=J(Ie[0],Ie[1]),Zo=_t[Math.abs(dt)]*ne;return new V(ba,Wo,Zo)}),bt=new zt().setFromPoints(et),jt=new Oe(bt,Jt);jt.computeLineDistances();const re=[];et.forEach(Ie=>{re.push(Ie.x,Ie.y)});const oe=wf.triangulate(re,null,2),xa=Io(et),Ui=Oo(et,xa),Vs=new zt,ni=new Float32Array(oe.length*3);oe.forEach((Ie,ba)=>{ni[ba*3]=et[Ie].x,ni[ba*3+1]=et[Ie].y,ni[ba*3+2]=0}),Vs.setAttribute("position",new nh(ni,3));const Ho=new wt({color:z.polygonColor,side:ee,wireframe:!1,transparent:!0,opacity:ct,visible:u.visible&&lt===f}),Hi=new xe(Vs,Ho);Hi.userData={channelFilter:W.properties.channel,uniqueId:pt,contourIndex:dt,avgRadius:Ui,vertices:et};const Wi=W.properties.key.split("_")[0];(!Ot[Wi]||u.visible===!1)&&(Ot[Wi]={meshes:[],opacity:1,isDecaying:!1,decayRate:.1}),Ot[Wi].meshes.push(jt,Hi),M.add(jt),n.add(Hi)}),ot.add(M),ot.add(n),x()})}async function Bs(l,f,M){try{const E=new be(z.matchingPyramidColor),N=new be(z.nonMatchingPyramidColor),D=.8,q=.6,Q=new wt({color:E,transparent:!0,alphaHash:!0,opacity:D}),Y=new wt({color:N,transparent:!0,alphaHash:!0,opacity:q}),W=new Zi(.008,.035,4);W.rotateX(Math.PI/2);const ht=new Zi(.0056,.0245,4);ht.rotateX(Math.PI/2);const pt=l.features.length;window.instancedPyramidMatching&&t.remove(window.instancedPyramidMatching),window.instancedPyramidNonMatching&&t.remove(window.instancedPyramidNonMatching),window.instancedPyramidMatching=new Ys(W,Q,pt),window.instancedPyramidNonMatching=new Ys(ht,Y,pt);let lt=new rh;l.features.forEach((_t,dt)=>{const[ct,Jt]=_t.geometry.coordinates,et=_t.properties.elevation,[bt,jt]=J(ct,Jt),re=et*ne,oe=_t.properties.lms_application_id;if(bt===null||jt===null||isNaN(re))return;const xa=parseInt(_t.properties.channel,10)===f;lt.position.set(bt,jt,re),lt.scale.set(1,1,1),lt.updateMatrix(),xa?(window.instancedPyramidMatching.setMatrixAt(dt,lt.matrix),window.instancedPyramidMatching.userData[dt]={channel:parseInt(_t.properties.channel,10),uniqueId:oe},window.instancedPyramidNonMatching.setMatrixAt(dt,lt.matrix)):(lt.scale.set(0,0,0),lt.updateMatrix(),window.instancedPyramidMatching.setMatrixAt(dt,lt.matrix),lt.scale.set(1,1,1),lt.updateMatrix(),window.instancedPyramidNonMatching.setMatrixAt(dt,lt.matrix),window.instancedPyramidNonMatching.userData[dt]={channelFilter:f})}),window.instancedPyramidMatching.instanceMatrix.needsUpdate=!0,window.instancedPyramidNonMatching.instanceMatrix.needsUpdate=!0,t.add(window.instancedPyramidMatching),t.add(window.instancedPyramidNonMatching),ot.add(t)}catch(g){throw console.error("Error in addFMTowerPts:",g),g}}function Ro(l){return new Promise((f,M)=>{try{let _=new wt({color:z.pyramidColorCellular,wireframe:!0,transparent:!0,alphaHash:!0,opacity:.25});const P=[];if(l.features.forEach((E,N)=>{if(E.geometry.type==="Point"){const[D,q]=E.geometry.coordinates,Q=E.properties.Z||0;try{const[Y,W]=J(D,q),ht=Q*ne,pt=new Zi(.005,.03,4);pt.rotateX(Math.PI/2);const lt=new xe(pt,_);lt.position.set(Y,W,ht);const _t=`Tower-${N}`;lt.userData={position:new V(Y,W,ht),gridCode:E.properties.gridCode||"unknown",uniqueCellid:_t||"unknown"},e.add(lt);const dt="cell",ct=.03*ne;P.push(new V(Y,W,ht))}catch(Y){console.error("Error projecting point:",Y.message)}}else console.error(`Unsupported geometry type for points: ${E.geometry.type}`)}),P.length>0){const E=Do(P);Fo(E,"#FFFFFF",z.mstCellColor,75e-5,.003,a)}ot.add(e),ot.add(a),f()}catch(g){M(`Error in addCellTowerPts: ${g.message}`)}})}let zi=null,qi=null,Us=null,ei=null;function ai(l){const f=document.getElementById("fm-channel-slider"),M=document.getElementById("fm-frequency-display"),g=parseInt(f.min,10),x=parseInt(f.max,10),_=(l-g)/(x-g)*100,P=f.offsetWidth,E=M.offsetWidth;M.style.maxWidth=`${P/4}px`;const N=_/100*P-E/2+(f.getBoundingClientRect().left-M.offsetParent.getBoundingClientRect().left);M.style.left=`${N}px`}ai(parseInt(document.getElementById("fm-channel-slider").value,10)),document.getElementById("fm-channel-slider").addEventListener("input",function(){ai(parseInt(this.value,10))});let ii=!1;document.getElementById("fm-channel-slider").addEventListener("mousedown",function(){ii=!0}),document.addEventListener("mouseup",function(){ii=!1});let Hs={};function Gi(l){clearTimeout(Us),Us=setTimeout(()=>{if(zi===null||Math.abs(zi-l)>=2){ei=l;const f=document.getElementById("fm-channel-display"),M=document.getElementById("fm-frequency-display"),g=Hs[Math.round(l).toString()]||"Frequency not found";if(f.textContent=`FM channel: ${Math.round(l)}`,M.textContent=g,rt.radioTuner.loaded){const x=rt.radioTuner.buffer.duration,_=l/100*x,P=Ce();rt.radioTuner.start(P,_)}else console.log("radioTuner buffer is not loaded yet");si&&$i&&(ko(si,$i,l),zi=l)}},20)}function Lo(l){Hs=l;const f=document.getElementById("fm-channel-slider");f.addEventListener("input",function(){const g=Math.round(parseInt(this.value,10));Gi(g)});const M=Math.round(parseInt(f.value,10));Gi(M)}function ko(l,f,M){if(!l||!f){console.warn("GeoJSON data not available.");return}ji(l,M,s).catch(g=>console.error("Failed to update contour channel:",g)),Bs(f,M).catch(g=>console.error("Failed to update tower channel:",g))}function Do(l){const f=l.length,M=new Array(f),g=new Array(f).fill(!1),x=new Array(f).fill(1/0);x[0]=0;const _=new Array(f).fill(-1);for(let P=0;P<f-1;P++){let E=-1;for(let N=0;N<f;N++)!g[N]&&(E===-1||x[N]<x[E])&&(E=N);g[E]=!0;for(let N=0;N<f;N++){const D=l[E].distanceTo(l[N]);!g[N]&&D<x[N]&&(_[N]=E,x[N]=D)}}for(let P=1;P<f;P++)M[P-1]={from:l[_[P]],to:l[P]};return M}function Fo(l,f,M,g,x,_){l.forEach(P=>{const E=new oh;E.add(new hh(P.from,P.to));const N=new Js(E,1,g,8,!1),D=new wt({color:f}),q=new xe(N,D);_.add(q);const Q=new Js(E,1,x,8,!1),Y=new wt({color:M,transparent:!0,alphaHash:!0,opacity:.5}),W=new xe(Q,Y);_.add(W)})}function jo(l){return new Promise((f,M)=>{try{const g=new He({color:z.coastlineColor});l.features.forEach(x=>{x.geometry.type==="MultiLineString"?x.geometry.coordinates.forEach(_=>{const P=new zt,E=[];_.forEach(D=>{const[q,Q]=D,[Y,W]=J(q,Q),ht=ne*20;E.push(new V(Y,W,ht))}),P.setFromPoints(E);const N=new Oe(P,g);ot.add(N),d.add(N)}):x.geometry.type==="MultiPolygon"&&x.geometry.coordinates.forEach(_=>{_.forEach(P=>{const E=new zt,N=[];if(P.forEach(q=>{const[Q,Y]=q,[W,ht]=J(Q,Y),pt=ne*20;N.push(new V(W,ht,pt))}),P.length>2){const[q,Q]=P[0],[Y,W]=J(q,Q),ht=ne*20;N.push(new V(Y,W,ht))}E.setFromPoints(N);const D=new Oe(E,g);ot.add(D),d.add(D)})})}),ot.add(d),f()}catch(g){M(`Error in visualizeBoundingBoxGeoJSON: ${g.message}`)}})}let Te=[];async function zo(){console.log("attempting to load data...");const l=Zs(),f=qo();await Promise.all([f,l]),console.log("All data loaded successfully.")}async function qo(){const l=["/remotesensing/assets/data/elevation_contours_shaved.geojson","/remotesensing/assets/data/CellularTowers_FeaturesToJSON_HIFLD_AOI_20231204.geojson","/remotesensing/assets/data/ne_50m_coastline_aoiClip.geojson","/remotesensing/assets/data/fm_freq_dict.json","/remotesensing/assets/data/FM_transmitter_sites.geojson","/remotesensing/assets/data/fm_contours_shaved.geojson","/remotesensing/assets/data/NYS_fullElevDEM_boundingBox.geojson","/remotesensing/assets/data/cellService_contours_5KM_pts_20240407.geojson","/remotesensing/assets/data/accessService_contours_5KM_pts_20240407.geojson","/remotesensing/assets/data/study_area_admin0clip.geojson"];try{let f=0;const M=3,g=l.map(P=>fetch(P).then(E=>{if(!E.ok)throw new Error(`Network response was not ok for ${P}`);return E.json()}).then(E=>($o(P,E),Go(P)&&(f++,f===M)?"critical":"non-critical")).catch(E=>{throw console.error(`Error loading ${P}:`,E),E}));if((await Promise.allSettled(g)).filter(P=>P.value==="critical").length<M)throw new Error("Not all critical datasets were loaded successfully");console.log("All data loaded successfully.")}catch(f){console.error("Failed to load some GeoJSON data:",f)}}function Go(l){return l.includes("elevation")||l.includes("fm_contours")||l.includes("transmitter")}let si,$i,Bi,Ws;function $o(l,f){switch(l){case"/remotesensing/assets/data/elevation_contours_shaved.geojson":Eo(f),Ao(f);break;case"/remotesensing/assets/data/fm_contours_shaved.geojson":si=f,ji(f,ei,s),u.add(s),u.add(n);break;case"/remotesensing/assets/data/NYS_fullElevDEM_boundingBox.geojson":Bi=f,qs(f);break;case"/remotesensing/assets/data/ne_50m_coastline_aoiClip.geojson":jo(f);break;case"/remotesensing/assets/data/cellService_contours_5KM_pts_20240407.geojson":So(f),v.add(o),v.add(r);break;case"/remotesensing/assets/data/accessService_contours_5KM_pts_20240407.geojson":To(f),m.add(h);break;case"/remotesensing/assets/data/CellularTowers_FeaturesToJSON_HIFLD_AOI_20231204.geojson":Ro(f),v.add(e),v.add(a);break;case"/remotesensing/assets/data/FM_transmitter_sites.geojson":$i=f,Bs(f,ei),u.add(t);break;case"/remotesensing/assets/data/NYS_cellTower_viewshed_20231130.jpg":accessibilityRaster=f;break;case"/remotesensing/assets/data/study_area_admin0clip.geojson":Bi=f;break;case"/remotesensing/assets/data/fm_freq_dict.json":Ws=f;break;default:console.warn("Unrecognized URL:",l);break}}async function Zs(){try{const l=await fetch("/remotesensing/assets/sounds/sounds.json");if(!l.ok)throw new Error("Network response was not ok");const f=await l.json();await Promise.all(f.map(M=>Bo(M))),console.log(f),console.log("All samples loaded successfully.")}catch(l){console.error("Failed to fetch sample URLs:",l)}}async function Bo(l){try{const f=await an.fromUrl(l);Te.push({url:l,buffer:f,loaded:!0})}catch(f){console.error(`Error loading sample from ${l}:`,f)}}function Uo(){const l=qs(Bi);Po(l);const f=_o(l),M=Math.max(f.x,f.y),x=J(...[-74.68057752571633,42.79146513478376]),_=U.fov*(Math.PI/90);let P=Math.abs(M/2/Math.tan(_/2));P*=.4,U.position.set(x[0],x[1],P),tt.target.set(U.position.x,U.position.y,0),U.lookAt(tt.target),bo(tt,l),Lo(Ws),ot.add(u,v,m,i),Ct(),pe(1,"switch1"),pe(1,"switch2");const E=document.querySelector('input[name="switch1"][id="fm propagation curve"]'),N=document.querySelector('input[name="switch2"][id="elevation contours"]');E.checked=!0,E.nextSibling.firstChild.classList.add("checked"),E.nextSibling.firstChild.style.color=z.polygonColor,N.checked=!0,N.nextSibling.firstChild.classList.add("checked"),N.nextSibling.firstChild.style.color=z.elevationLegend,tt.update()}}setTimeout(id,1);const sd=document.getElementById("gfx");function nd(){sd.classList.remove("background")}nd();console.log("loaded")});export default rd();
